!function(){"use strict";var t=function(){};t.safeGet=function(t,e,n){for(var r=n,o=t,i=!0,s=e.split("."),a=0;a<s.length;a++){if("object"!=typeof o||!(s[a]in o)){i=!1;break}o=o[s[a]]}return i&&(r=o),r},t.safeSet=function(t,e,n){for(var r,o=t,i=e.split("."),s=0;s<i.length-1;s++){if("object"!=typeof o||i[s]in o){if("object"!=typeof o)throw new TypeError("Key already exists. key="+e+", existingKey="+r+", existingValue="+o)}else o[i[s]]={};r=i[s],o=o[i[s]]}if("object"!=typeof o)throw new TypeError("Key already exists. key="+e+", existingKey="+r+", existingValue="+o);return o[i[i.length-1]]=n,t},t.safeHas=function(t,e){for(var n=t,r=!0,o=e.split("."),i=0;i<o.length;i++){if("object"!=typeof n||!(o[i]in n)){r=!1;break}n=n[o[i]]}return r},t.concatPath=function(t){for(var e=t[0]||"",n=1;n<t.length;n++)t[n]&&("/"==e.slice(e.length-1)&&"/"==t[n].slice(0,1)?e+=t[n].slice(1):"/"==e.slice(e.length-1)||"/"==t[n].slice(0,1)?e+=t[n]:e?e+="/"+t[n]:e=t[n]);return e},t.deepMerge=function(e,n){return n&&Object.keys(n).forEach((function(r){Array.isArray(e[r])?e[r]=e[r].concat(n[r]):e.hasOwnProperty(r)&&"object"==typeof e[r]?t.deepMerge(e[r],n[r]):e[r]=n[r]})),e},t.getClassNameFromTagName=function(t){var e=t.split("-");return e[0].charAt(0).toUpperCase()+e[0].slice(1).toLowerCase()+e[1].charAt(0).toUpperCase()+e[1].slice(1).toLowerCase()},t.getTagNameFromClassName=function(e){var n,r=e,o=e.split("."),i=o[o.length-1];for(n=1;n<i.length&&!t.__isUpper(i.substring(n,n+1));n++);return n<i.length&&(r=i.substring(0,n).toLowerCase()+"-"+i.substring(n).toLowerCase()),r},t.getFilenameAndPathFromUrl=function(t){var e=t.lastIndexOf("/");return[t.substr(0,e),t.substr(e+1)]},t.__isUpper=function(t){return t==t.toUpperCase()&&t!=t.toLowerCase()};var e=function(){};function n(){return Reflect.construct(HTMLElement,[],this.constructor)}e.newComponent=function(n,r,o,i){i=i||t.getClassNameFromTagName(o);var s=Function("superClass","return function "+e.__validateClassName(i)+"(){ { return Reflect.construct(superClass, [], this.constructor); } }")(n);return e.inherit(s,n),(r=Object.assign({},r)).settings=r.settings?r.settings:{},r.settings.name=i,s.prototype._getSettings=function(){return r},o&&customElements.define(o.toLowerCase(),s),s},e.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e,Object.setPrototypeOf(t,e)},e.createObject=function(t){for(var n=[],r=arguments.length-1;r-- >0;)n[r]=arguments[r+1];var o=e.getClass(t);if(!o)throw new ReferenceError("Class '"+t+"' is not defined.");return new(Function.prototype.bind.apply(o,[null].concat(n)))},e.getClass=function(t){var n;try{n=Function("return ("+e.__validateClassName(t)+")")()}catch(t){if(!(t instanceof ReferenceError))throw t}return n},e.__validateClassName=function(t){if(!/^[a-zA-Z0-9\-\._]+$/.test(t))throw new TypeError("Class name '"+t+"' is not valid.");return t},e.inherit(n,HTMLElement),n.prototype.connectedCallback=function(){return this.isInitialized()?Promise.resolve():this.start()},n.prototype.disconnectedCallback=function(){return this._settings.get("settings.autoStop")?this.stop():Promise.resolve()},n.prototype.adoptedCallback=function(){},n.prototype.attributeChangedCallback=function(){},Object.defineProperty(n.prototype,"name",{get:function(){return this._name}}),Object.defineProperty(n.prototype,"uniqueId",{get:function(){return this._uniqueId}}),Object.defineProperty(n.prototype,"rootElement",{get:function(){return this._rootElement}}),n.prototype.start=function(e){var n=this;return e=t.deepMerge({settings:{autoSetup:!0,autoStop:!0,useGlobalSettings:!0},organizers:{SettingOrganizer:"",OrganizerOrganizer:"",StateOrganizer:""}},e),this._uniqueId=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16),this._name=this.constructor.name,this._rootElement=t.safeGet(e,"settings.rootElement")?document.querySelector(t.safeGet(e,"settings.rootElement")):this,Promise.resolve().then((function(){return n._injectSettings(e)})).then((function(t){return n.initOrganizers(t)})).then((function(){return n.changeState("starting")})).then((function(){return n.callOrganizers("beforeStart",n._settings.items)})).then((function(t){return e=t,n.trigger("beforeStart",n)})).then((function(){var t=n._settings.get("settings.autoSetupOnStart"),r=n._settings.get("settings.autoSetup");if(t||!1!==t&&r)return n.setup(e)})).then((function(){return n.callOrganizers("afterStart",n._settings.items)})).then((function(){return n.trigger("afterStart",n)})).then((function(){return n.changeState("started")})).then((function(){return e}))},n.prototype.stop=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.changeState("stopping")})).then((function(){return e.trigger("beforeStop",n,t)})).then((function(){return e.trigger("doStop",n,t)})).then((function(){return e.trigger("afterStop",n,t)})).then((function(){return e.changeState("stopped")}))},n.prototype.setup=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.trigger("beforeSetup",n,t)})).then((function(){return e.trigger("doSetup",n,t)})).then((function(){return e.trigger("afterSetup",n,t)})).then((function(){}))},n.prototype._injectSettings=function(t){return t},n.prototype._getSettings=function(){return{}},customElements.define("bm-component",n);var r=function(){};r.globalInit=function(t){},r.init=function(t,e,n){},r.organize=function(t,e,n){},r.clear=function(t){},r.isTarget=function(t,e,n){return e.targetEvents.indexOf(t)>-1},r.getEditor=function(){return""};var o=function(e){this._filter,this._options=Object.assign({},e),this.items=t.safeGet(e,"items"),this.filter=t.safeGet(e,"filter",(function(){return!0})),this.merger=t.safeGet(e,"merger",t.deepMerge)},i={items:{configurable:!0},filter:{configurable:!0},merger:{configurable:!0}};i.items.get=function(){return Object.assign({},this._items)},i.items.set=function(t){this._items=Object.assign({},t)},i.filter.get=function(){this._filter},i.filter.set=function(t){if("function"!=typeof t)throw TypeError("Filter is not a function. filter="+t);this._filter=t},i.merger.get=function(){this._merger},i.merger.set=function(t){if("function"!=typeof t)throw TypeError("Merger is not a function. filter="+t);this._merger=t},o.prototype.clear=function(){this._items={}},o.prototype.merge=function(t,e){if(t){e=e||this._merger;for(var n=Array.isArray(t)?t:[t],r=0;r<n.length;r++)e(this._items,n[r])}},o.prototype.get=function(e,n){return t.safeGet(this._items,e,n)},o.prototype.set=function(e,n){t.safeSet(this._items,e,n)},o.prototype.mergeSet=function(t,e){var n=this.get(t);"object"==typeof n?Object.assign(n,e):this.set(t,e)},o.prototype.remove=function(t){delete this._items[t]},o.prototype.has=function(e){return t.safeHas(this._items,e)},Object.defineProperties(o.prototype,i);var s=function(e){function n(t,n){e.call(this,t,n),this._targetWords={}}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.set=function(t,n){(n=Object.assign({},n)).name=n.name?n.name:t,n.targetWords=n.targetWords?n.targetWords:[],n.targetWords=Array.isArray(n.targetWords)?n.targetWords:[n.targetWords],n.targetEvents=n.targetEvents?n.targetEvents:[],n.targetEvents=Array.isArray(n.targetEvents)?n.targetEvents:[n.targetEvents],e.prototype.set.call(this,t,n),n.object.globalInit(n.targetClass);for(var r=0;r<n.targetWords.length;r++)this._targetWords[n.targetWords[r]]=n},n.prototype.getMerger=function(e){return t.safeGet(this._targetWords,e+".object.merger",t.deepmerge)},n.prototype.getOrganizerInfoByTargetWords=function(e){return t.safeGet(this._targetWords,e)},n}(o),a=function(){};a.ajaxRequest=function(e){return new Promise((function(n,r){var o=t.safeGet(e,"url"),i=t.safeGet(e,"method"),s=t.safeGet(e,"data",""),a=t.safeGet(e,"headers"),u=t.safeGet(e,"options"),c=new XMLHttpRequest;c.open(i,o,!0),u&&Object.keys(u).forEach((function(t){c[t]=u[t]})),a&&Object.keys(a).forEach((function(t){c.setRequestHeader(t,a[t])})),c.addEventListener("load",(function(){200==c.status||201==c.status?n(c):r(c)})),c.addEventListener("error",(function(){r(c)})),c.send(s)}))},a.loadScript=function(t){return new Promise((function(e,n){var r=t,o=document.createElement("script"),i=document.getElementsByTagName("script")[0];o.async=1,o.onload=o.onreadystatechange=function(t,n){(n||!o.readyState||/loaded|complete/.test(o.readyState))&&(o.onload=o.onreadystatechange=null,o=void 0,n||e())},o.src=r,i.parentNode.insertBefore(o,i)}))};var u=function(e){function n(n,r){e.call(this,n),this._chain=t.safeGet(n,"chain")}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={items:{configurable:!0}};return r.items.get=function(){return this._chain?Object.assign({},this._chain._items,this._items):Object.assign({},this._items)},r.items.set=function(t){this._items=Object.assign({},t)},n.prototype.chain=function(t){this._chain=t},n.prototype.get=function(t,e){return this._getChainedItem(this._chain,this,t,e)},n.prototype.mergeSet=function(t,e){var n=this._getLocal(t);"object"==typeof n?Object.assign(n,e):this.set(t,e)},n.prototype._getLocal=function(e,n){return t.safeGet(this._items,e,n)},n.prototype._getChainedItem=function(t,e,n,r){var o=r;return e&&e.has(n)?o=e._getLocal(n):t&&t.has(n)&&(o=t._getLocal(n)),o},Object.defineProperties(n.prototype,r),n}(o),c=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.globalInit=function(t){Object.defineProperty(n.prototype,"settings",{get:function(){return this._settings}}),r.__globalSettings=new u,Object.defineProperty(r,"globalSettings",{get:function(){return r.__globalSettings}})},r.init=function(t,e,n){e._settings=new u({items:n}),e.settings.merge(e._getSettings());var o=e.settings.get("settings.name");o&&(e._name=o),e.settings.get("settings.useGlobalSettings")&&e.settings.chain(r.globalSettings)},r.organize=function(t,e,n){return Promise.resolve().then((function(){return r.__loadExtraSettings(e,"setting")})).then((function(t){t&&e.settings.merge(t),r.__loadAttrSettings(e)})).then((function(){if(e.settings.get("settings.loadGlobalSettings"))return r.__globalSettings.merge(e.settings.items.globals),r._load(e).then((function(t){r.__globalSettings.merge(t)}))})).then((function(){return e.settings.items}))},r.isTarget=function(t,e,n){return"beforeStart"==t},r._loadSetting=function(e,n){var r,o=t.concatPath([n,e+".js"]);return a.ajaxRequest({url:o,method:"GET"}).then((function(t){try{r=JSON.parse(t.responseText)}catch(t){throw new SyntaxError("Illegal json string. url="+o)}return r}))},r._load=function(t,e){var n=e&&e.sender?e.sender:t;return t.trigger("doLoadStore",n)},r._save=function(t,e){var n=e&&e.sender?e.sender:t;return t.trigger("doSaveStore",n,{data:PreferenceOrganizer.__preferences.items})},r.__loadExtraSettings=function(e,n){var o,i;if(e.hasAttribute("bm-"+n+"ref")){var s=t.getFilenameAndPathFromUrl(e.getAttribute("bm-"+n+"ref"));i=s[0],o=s[1].slice(0,-3)}else i=e.hasAttribute("bm-"+n+"path")?e.getAttribute("bm-"+n+"path"):"",o=e.hasAttribute("bm-"+n+"name")?e.getAttribute("bm-"+n+"name"):"",i&&!o&&(o="settings");if(o||i)return r._loadSetting(o,i)},r.__loadAttrSettings=function(e){if(e.getAttribute("bm-autoload")){var n=t.getFilenameAndPathFromUrl(e.getAttribute("bm-autoload"));e.settings.set("system.appBaseUrl",""),e.settings.set("system.templatePath",n[0]),e.settings.set("system.componentPath",n[0]),e.settings.set("settings.path","")}e.hasAttribute("bm-path")&&e.settings.set("settings.path",e.getAttribute("bm-path"));var r=document.querySelector(e.settings.get("settings.rootNode"))?document.querySelector(e.settings.get("settings.rootNode")).getAttribute("bm-settings"):e.getAttribute("bm-settings");if(r){var o={settings:JSON.parse(r)};e.settings.merge(o)}},r}(r),g=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.globalInit=function(){Object.defineProperty(n.prototype,"organizers",{get:function(){return this._organizers}}),n.prototype.callOrganizers=function(t,e){return r._callOrganizers(this,t,e)},n.prototype.initOrganizers=function(t){return r._initOrganizers(this,t)},r.__organizers=new s,Object.defineProperty(r,"organizers",{get:function(){return r.__organizers}})},r.organize=function(e,n,o){var i={},s=Promise.resolve(),a=o.organizers;return a&&Object.keys(a).forEach((function(t){!n._organizers[t]&&r.__organizers.items[t]&&(i[t]=r.__organizers.items[t])})),Object.keys(o).forEach((function(t){var e=r.__organizers.getOrganizerInfoByTargetWords(t);e&&(n._organizers[e.name]||(i[e.name]=e.object))})),r._sortItems(i).forEach((function(e){s=s.then((function(){return n._organizers[e]=Object.assign({},r.__organizers.items[e],t.safeGet(o,"organizers."+e)),n._organizers[e].object.init("*",n,o)}))})),s.then((function(){return o}))},r.clear=function(t){t._organizers={}},r._initOrganizers=function(t,e){return t._organizers={},Promise.resolve().then((function(){return c.init("*",t,e)})).then((function(){return r.organize("*",t,e)}))},r._callOrganizers=function(t,e,n){return Promise.resolve().then((function(){return c.isTarget(e)?c.organize(e,t,n):n})).then((function(e){return r.organize("*",t,e)})).then((function(o){var i=Promise.resolve(n);return r._sortItems(t._organizers).forEach((function(n){t._organizers[n].object.isTarget(e,t._organizers[n],t)&&(i=i.then((function(r){return t._organizers[n].object.organize(e,t,r)})))})),i}))},r._sortItems=function(t){return Object.keys(t).sort((function(e,n){return t[e].order-t[n].order}))},r}(r),p=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.globalInit=function(){Object.defineProperty(n.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t}}),n.prototype.changeState=function(t){return e._changeState(this,t)},n.prototype.isInitialized=function(){return e._isInitialized(this)},n.prototype.waitFor=function(t,n){return e._waitFor(this,t,n)},n.prototype.suspend=function(t){return e._suspend(this,t)},e.__components=new o,e.__waitingList=new o,e.__waitingListIndexName=new Map,e.__waitingListIndexId=new Map,e.__waitingListIndexNone=[],n.prototype.resume=function(t){return e._resume(this,t)}},e.init=function(t,n,r){n._state="",e.__loadAttrSettings(n)},e.organize=function(t,n,r){var o=Promise.resolve(),i=r.waitFor;return i&&(o=e._waitFor(n,i)),o.then((function(){return r}))},e.clear=function(){this.__waitingList.clear()},e.isTarget=function(e,n,r){var o=!1;return"beforeStart"==e?r instanceof BITSMIST.v1.Pad||(o=!0):o=t.isTarget.call(this,e,n,r),o},e._waitFor=function(t,n,r){var o;r=r||1e4;var i={waiter:t,waitlist:n.slice()};return e.__isAllReady(i)?o=Promise.resolve():(o=new Promise((function(e,o){i.resolve=e,i.reject=o,setTimeout((function(){o("waitFor() timed out after "+r+" milliseconds waiting for "+JSON.stringify(n)+", name="+t.name+".")}),r)})),i.promise=o,e.__addToWaitingList(i,t)),o},e._waitForSingle=function(t,n,r){var o=e.__components.get(t.uniqueId),i={id:t.uniqueId,state:n};return e.__isReady(i,o)?Promise.resolve():e.waitFor(t,[i],r)},e._changeState=function(t,n){if(!e.__isTransitionable(t.state,n))throw Error("Illegal transition. name="+t.name+", fromState="+t.state+", toState="+n+", id="+t.id);t.state=n,e.__components.mergeSet(t.uniqueId,{object:t,state:n}),e.__processWaitingList(t,n)},e._suspend=function(t,e){var n={},r=new Promise((function(t,e){n.resolve=t,n.reject=e}));return n.promise=r,t._suspend[e]=n,r},e._resume=function(t,e){t._suspend[e].resolve()},e._isInitialized=function(t){var e=!1;return t.state&&"starting"!=t.state&&"stopping"!=t.state&&"stopped"!=t.state&&(e=!0),e},e.__isTransitionable=function(t,e){var n=!0;return t&&"ing"==t.slice(-3)&&("stopping"==t&&"stopped"!=e||"starting"==t&&"started"!=e||"opening"==t&&"opened"!=e&&"opening"!=e||"closing"==t&&"closed"!=e||"stopping"==t&&"stopped"!=e&&"closing"!=e)&&(n=!1),n},e.__processWaitingList=function(t,n){var r=e.__waitingListIndexName.get(t.name+"."+n);e.__processIndex(r);var o=e.__waitingListIndexId.get(t.uniqueId+"."+n);e.__processIndex(o),e.__processIndex(e.__waitingListIndexNone)},e.__processIndex=function(t){if(t)for(var n=0;n<t.length;n++){var r=t[n];r&&(e.__waitingList.get(r),e.__isAllReady(e.__waitingList.get(r))&&(e.__waitingList.get(r).resolve(),e.__waitingList.remove(r),t[n]=null))}},e.__addToWaitingList=function(t,n){var r=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16);e.__waitingList.set(r,t);for(var o=t.waitlist,i=0;i<o.length;i++)o[i].id?e.__addToIndex(e.__waitingListIndexId,o[i].id+"."+o[i].state,r):o[i].name?e.__addToIndex(e.__waitingListIndexName,o[i].name+"."+o[i].state,r):e.__waitingListIndexNone.push(r)},e.__addToIndex=function(t,e,n){t.get(e)||t.set(e,[]),t.get(e).push(n)},e.__getComponentInfo=function(t){var n;if(t.id)n=e.__components.get(t.id);else if(t.name)Object.keys(e.__components.items).forEach((function(r){t.name==e.__components.get(r).object.name&&(n=e.__components.get(r))}));else if(t.rootNode){var r=document.querySelector(t.rootNode);r&&(n=e.__components.get(r.uniqueId))}return n},e.__isAllReady=function(t){for(var n=!0,r=t.waitlist,o=0;o<r.length;o++){var i=!1,s=this.__getComponentInfo(r[o]);if(s&&e.__isReady(r[o],s)&&(i=!0),!i){n=!1;break}}return n},e.__isReady=function(t,n){t.state=t.state||"opened";var r=e.__isComponentMatch(n,t);return r&&(r=e.__isStateMatch(n.state,t.state)),r},e.__isComponentMatch=function(t,e){var n=!0;return e.component&&t.object!==e.component&&(n=!1),e.name&&t.object.name!=e.name&&(n=!1),e.id&&t.object.uniqueId!=e.id&&(n=!1),e.rootNode&&!document.querySelector(e.rootNode)&&(n=!1),n},e.__isStateMatch=function(t,e){var n=!0;switch(e){case"started":"opening"!=t&&"opened"!=t&&"closing"!=t&&"closed"!=t&&"started"!=t&&(n=!1);break;default:t!=e&&(n=!1)}return n},e.__loadAttrSettings=function(t){if(t.hasAttribute("bm-waitfor")){var e={name:t.getAttribute("bm-waitfor"),state:"started"};t.settings.merge({waitFor:[e]})}if(t.hasAttribute("bm-waitfornode")){var n={rootNode:t.getAttribute("bm-waitfornode"),state:"started"};t.settings.merge({waitFor:[n]})}},e}(r),l=function(e){function r(){e.apply(this,arguments)}return e&&(r.__proto__=e),r.prototype=Object.create(e&&e.prototype),r.prototype.constructor=r,r.globalInit=function(){n.prototype.initEvents=function(t,e,n){r._initEvents(this,t,e,n)},n.prototype.addEventHandler=function(t,e,n,o){r._addEventHandler(this,n,t,e,o)},n.prototype.trigger=function(t,e,n,o){return r._trigger(this,t,e,n,o)},n.prototype.triggerAsync=function(t,e,n,o){return r._triggerAsync(this,t,e,n,o)},n.prototype.getEventHandler=function(t){return r._getEventHandler(this,t)}},r.organize=function(t,e,n){var o=n.events;return o&&Object.keys(o).forEach((function(t){r._initEvents(e,t,o[t])})),n},r._addEventHandler=function(e,n,o,i,s){n=n||e;var a=r._getEventHandler(e,i);if("function"!=typeof a)throw TypeError("Event handler is not a function. componentName="+e.name+", eventName="+o);n.__bm_eventinfo||(n.__bm_eventinfo={component:e,listeners:{},promises:{},statuses:{}});var u=n.__bm_eventinfo.listeners;u[o]||(u[o]=[],n.addEventListener(o,r.__callEventHandler,i.listenerOptions)),u[o].push({handler:a,options:Object.assign({},i.options),bindTo:s,order:c});var c=t.safeGet(i,"order");u[o].sort((function(t,e){return t.order==e.order?0:t.order>e.order?1:-1}))},r._removeEventHandler=function(e,n,o,i){n=n||e;var s=r._getEventHandler(e,i);if("function"!=typeof s)throw TypeError("Event handler is not a function. componentName="+e.name+", eventName="+o);var a=t.safeGet(n,"__bm_eventinfo.listeners."+o);if(a){for(var u=-1,c=0;c<a.length;c++)if(a.handler==s){u=c;break}u>-1&&(n.__bm_eventinfo.listeners=array.splice(u,1))}},r._initEvents=function(t,e,n,o){o=o||t.rootElement,n=n||t.settings.get("events."+e);var i=r.__getTargetElements(t,o,e,n);n.handlers&&Object.keys(n.handlers).forEach((function(e){for(var o=Array.isArray(n.handlers[e])?n.handlers[e]:[n.handlers[e]],s=0;s<o.length;s++)for(var a=t.getEventHandler(o[s]),u=0;u<i.length;u++)r.__isHandlerInstalled(i[u],e,a,t)||t.addEventHandler(e,o[s],i[u])}))},r._trigger=function(e,n,r,o,i){(o=Object.assign({},o)).sender=r,i=i||e;var s=null;try{s=new CustomEvent(n,{detail:o})}catch(t){(s=document.createEvent("CustomEvent")).initCustomEvent(n,!1,!1,o)}return i.dispatchEvent(s),t.safeGet(i,"__bm_eventinfo.promises."+n)||Promise.resolve()},r._triggerAsync=function(t,e,n,o,i){return(o=o||{}).async=!0,r._trigger.call(t,t,e,n,o,i)},r._getEventHandler=function(t,e){var n="object"==typeof e?e.handler:e;return"string"==typeof n&&(n=t[n]),n},r.__getTargetElements=function(t,e,n,r){return r.rootNode?"this"==r.rootNode||r.rootNode==t.tagName.toLowerCase()?[e]:e.querySelectorAll(r.rootNode):"this"==n||n==t.tagName.toLowerCase()?[e]:e.querySelectorAll("#"+n)},r.__isHandlerInstalled=function(e,n,r){var o=!1,i=t.safeGet(e.__bm_eventinfo,"listeners."+n);if(i)for(var s=0;s<i.length;s++)if(i[s].handler===r){o=!0;break}return o},r.__callEventHandler=function(e){var n=this,o=t.safeGet(this,"__bm_eventinfo.listeners."+e.type),i=t.safeGet(e,"detail.sender",this),s=t.safeGet(this,"__bm_eventinfo.component");if("handling"==t.safeGet(this,"__bm_eventinfo.statuses."+e.type))throw new Error("Event handler is already running. name="+this.tagName+", eventName="+e.type);t.safeSet(this,"__bm_eventinfo.statuses."+e.type,"handling"),0==t.safeGet(e,"detail.async",!1)?this.__bm_eventinfo.promises[e.type]=r.__handle(e,i,s,o).then((function(r){return t.safeSet(n,"__bm_eventinfo.promises."+e.type,null),t.safeSet(n,"__bm_eventinfo.statuses."+e.type,""),r})):(this.__bm_eventinfo.promises[e.type]=r.__handleAsync(e,i,s,o),t.safeSet(this,"__bm_eventinfo.promises."+e.type,null),t.safeSet(this,"__bm_eventinfo.statuses."+e.type,""))},r.__handle=function(t,e,n,r){for(var o=Promise.resolve(),i=[],s=!1,a=function(a){var u={component:n,options:r[a].options?r[a].options:{}};o=o.then((function(o){i.push(o);var s=r[a].bindTo?r[a].bindTo:n;return r[a].handler.call(s,e,t,u)})),s=!(!r[a].options||!r[a].options.stopPropagation)||s},u=0;u<r.length;u++)a(u);return s&&t.stopPropagation(),o.then((function(t){return i.push(t),i}))},r.__handleAsync=function(t,e,n,r){for(var o=!1,i=0;i<r.length;i++){var s={component:n,options:r[i].options?r[i].options:{}},a=r[i].bindTo?r[i].bindTo:n;r[i].handler.call(a,e,t,s),o=!(!r[i].options||!r[i].options.stopPropagation)||o}return o&&t.stopPropagation(),Promise.resolve()},r}(r);function f(){return Reflect.construct(n,[],this.constructor)}e.inherit(f,n),customElements.define("bm-pad",f),f.prototype.open=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.changeState("opening")})).then((function(){return e.switchTemplate(e._settings.get("settings.templateName"))})).then((function(){return e.trigger("beforeOpen",n,t)})).then((function(){var n=e._settings.get("settings.autoSetupOnOpen"),r=e._settings.get("settings.autoSetup");if(n||!1!==n&&r)return e.setup(t)})).then((function(){if(e._settings.get("settings.autoRefresh"))return e.refresh(t)})).then((function(){return e.trigger("doOpen",n,t)})).then((function(){return e.trigger("afterOpen",n,t)})).then((function(){return e.changeState("opened")}))},f.prototype.openModal=function(t){var e=this;return new Promise((function(n,r){e._isModal=!0,e._modalResult={result:!1},e._modalPromise={resolve:n,reject:r},e.open(t)}))},f.prototype.close=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.changeState("closing")})).then((function(){return e.trigger("beforeClose",n,t)})).then((function(){return e.trigger("doClose",n,t)})).then((function(){return e.trigger("afterClose",n,t)})).then((function(){e._isModal&&e._modalPromise.resolve(e._modalResult)})).then((function(){return e.changeState("closed")}))},f.prototype.refresh=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.trigger("beforeRefresh",n,t)})).then((function(){if(e._settings.get("settings.autoFill"))return e.fill(t)})).then((function(){return e.trigger("doRefresh",n,t)})).then((function(){return e.trigger("afterRefresh",n,t)})).then((function(){}))},f.prototype.switchTemplate=function(e,n){var r=this,o=(n=Object.assign({},n)).sender?n.sender:this;return this.isActiveTemplate(e)?Promise.resolve():Promise.resolve().then((function(){return r.addTemplate(e,{rootNode:r._settings.get("settings.rootNode"),templateNode:r._settings.get("settings.templateNode")})})).then((function(){var e=t.concatPath([r._settings.get("system.appBaseUrl",""),r._settings.get("system.componentPath","")]),n=r._settings.get("system.splitComponent",!1);return r.loadTags(r,e,{splitComponent:n})})).then((function(){return r.callOrganizers("afterAppend",r._settings.items)})).then((function(){return r.trigger("afterAppend",o,n)})).then((function(){}))},f.prototype.fill=function(t){},f.prototype.start=function(e){var r=this;return e=t.deepMerge({settings:{autoSetupOnStart:!1,autoOpen:!0,autoClose:!0,autoRefresh:!0,autoFill:!0},organizers:{TemplateOrganizer:""}},e),Promise.resolve().then((function(){return n.prototype.start.call(r,e)})).then((function(t){if(e=t,r._settings.get("settings.autoOpen"))return r.open(e)}))};var m=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.globalInit=function(){f.prototype.addTemplate=function(t,e){return n._addTemplate(this,t,e)},f.prototype.cloneTemplate=function(t){return n._clone(this,t)},f.prototype.isActiveTemplate=function(t){return n._isActive(this,t)}},n.init=function(t,e,r){e._templates={},e.settings.set("settings.templateName",e.settings.get("settings.templateName",e.tagName.toLowerCase())),n.__loadAttrSettings(e)},n.organize=function(t,e,r){var o=r.templates;return o&&Object.keys(o).forEach((function(t){n.__getTemplateInfo(e,t).html=o[t]})),r},n.clear=function(t){t._templates={}},n.isTarget=function(t,n,r){var o=!1;return r instanceof BITSMIST.v1.Pad&&(o=e.isTarget.call(this,t,n,r)),o},n._isActive=function(t,e){var r=!1;return n.__getTemplateInfo(t,e).isAppended&&(r=!0),r},n._addTemplate=function(e,r,o){var i=n.__getTemplateInfo(e,r);if(i.isAppended)throw new ReferenceError("Template already appended. name="+e.name+", templateName="+r);return Promise.resolve().then((function(){var r=t.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.templatePath",""),e.settings.get("settings.path","")]);return n._loadTemplate(e,i,r)})).then((function(){return e.settings.get("settings.templateNode")&&n.__storeTemplateNode(e,i,e.settings.get("settings.templateNode")),n.__applyTemplate(e,i)})).then((function(){e._templates[e.settings.get("settings.templateName")]&&(e._templates[e.settings.get("settings.templateName")].isAppended=!1),e._templates[r].isAppended=!0,e.settings.set("settings.templateName",r)}))},n._loadTemplate=function(t,e,r){return n.__autoLoadTemplate(t,e,r)},n._clone=function(t,e){e=e||t._settings.get("settings.templateName");var n,r=t._templates[e];if(!r)throw new ReferenceError("Template not loaded. name="+t.name+", templateName="+e);if(r.node)n=document.importNode(r.node,!0);else{var o=document.createElement("div");o.innerHTML=r.html,n=o.firstElementChild}return n},n.__autoLoadTemplate=function(e,r,o){var i;if(r.html||r.node);else{var s=t.concatPath([o,r.name+".html"]);i=n.__loadTemplateFile(s).then((function(t){r.html=t}))}return Promise.all([i]).then((function(){if(!r.isLoaded)return e.trigger("afterLoadTemplate",e)})).then((function(){r.isLoaded=!0}))},n.__loadTemplateFile=function(t){return a.ajaxRequest({url:t,method:"GET"}).then((function(t){return t.responseText}))},n.__getTemplateInfo=function(t,e){return t._templates[e]||(t._templates[e]={},t._templates[e].name=e,t._templates[e].html="",t._templates[e].isAppended=!1,t._templates[e].isLoaded=!1),t._templates[e]},n.__storeTemplateNode=function(t,e,n){var r=document.querySelector(n);if(!r)throw new ReferenceError("Root node does not exist. name="+t.name+", rootNode="+n+", templateName="+e.name);r.insertAdjacentHTML("afterbegin",e.html);var o=r.children[0];e.node="content"in o?o.content:o},n.__applyTemplate=function(t,e){if(e.node){var r=n.clone(t,e.name);t.insertBefore(r,t.firstChild)}else t.innerHTML=e.html},n.__loadAttrSettings=function(t){},n}(r),d=function(n){function r(){n.apply(this,arguments)}return n&&(r.__proto__=n),r.prototype=Object.create(n&&n.prototype),r.prototype.constructor=r,r.globalInit=function(t){f.prototype.loadTags=r.loadTags,r.__classes=new o},r.init=function(t,e,n){Object.defineProperty(e,"components",{get:function(){return this._components}}),e.addComponent=function(t,e,n){return r._addComponent(this,t,e,n)},e._components={}},r.organize=function(t,e,n){var o=Promise.resolve(),i=n.molds;i&&Object.keys(i).forEach((function(t){o=o.then((function(){return r._addComponent(e,t,i[t],"opened")}))}));var s=n.components;return s&&Object.keys(s).forEach((function(t){o=o.then((function(){return r._addComponent(e,t,s[t])}))})),o.then((function(){return n}))},r.clear=function(t){Object.keys(t.components).forEach((function(e){t.components[e].parentNode.removeChild(t._components[e])})),t._components={}},r.isTarget=function(t,e,r){var o=!1;return"beforeStart"==t?r instanceof BITSMIST.v1.Pad||(o=!0):o=n.isTarget.call(this,t,e,r),o},r._addComponent=function(e,n,o,i){var s=t.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.componentPath",""),t.safeGet(o,"settings.path","")]),a=t.safeGet(o,"settings.className")||n,u=t.safeGet(o,"settings.tagName")||t.getTagNameFromClassName(a);return Promise.resolve().then((function(){var n={autoLoad:t.safeGet(o,"settings.autoLoad",e.settings.get("system.autoLoad",!0)),splitComponent:t.safeGet(o,"settings.splitComponent",e.settings.get("system.splitComponent",!1))};return r._loadComponent(a,s,o,n,u)})).then((function(){t.safeGet(o,"settings.rootNode")&&!e.components[n]&&(e.components[n]=r.__insertTag(e,u,o))})).then((function(){var r=t.safeGet(o,"settings.expose");if(r){var i=!0===r?n:r;Object.defineProperty(e.__proto__,i,{get:function(){return this.components[n]}})}})).then((function(){if(i||t.safeGet(o,"settings.sync")){var n=!0===(i=i||t.safeGet(o,"settings.sync"))?"started":i,r=a.split(".");return e.waitFor([{name:r[r.length-1],state:n}])}}))},r.loadTags=function(e,n,o,i){var s=[];return(i?document.querySelectorAll(i):e.querySelectorAll("[bm-autoload]:not([bm-autoloaded]),[bm-automorph]:not([bm-autoloaded])")).forEach((function(e){e.setAttribute("bm-autoloaded","");var i=e.getAttribute("bm-autoload"),a=e.getAttribute("bm-classname")||t.getClassNameFromTagName(e.tagName),u=e.getAttribute("bm-path")||"",c=!!e.hasAttribute("bm-split")||o.splitComponent,g={settings:{morph:!!e.hasAttribute("bm-automorph")&&(!e.getAttribute("bm-automorph")||e.getAttribute("bm-automorph"))}},p={splitComponent:c,autoLoad:!0};if(i){var l=t.getFilenameAndPathFromUrl(i);u=l[0],".js"==i.slice(-3).toLowerCase()?g.settings.fileName=l[1].substring(0,l[1].length-3):".html"==i.slice(-5).toLowerCase()&&(g.settings.morph=!0)}else u=t.concatPath([n,u]);s.push(r._loadComponent(a,u,g,p,e.tagName))})),Promise.all(s)},r._loadComponent=function(n,o,i,s,a){var u=t.safeGet(i,"settings.morph");if(u){var c=!0===u?BITSMIST.v1.Pad:e.getClass(u);customElements.get(a.toLowerCase())||e.newComponent(c,i,a,n)}else if(s.autoLoad)return r.__autoloadComponent(n,o,i,s)},r.__isLoadedClass=function(t){var n=!1;return("loaded"==r.__classes.get(t,{}).state||e.getClass(t))&&(n=!0),n},r.__autoloadComponent=function(e,n,o,i){var s,a=t.safeGet(o,"settings.tagName")||t.getTagNameFromClassName(e),u=t.safeGet(o,"settings.fileName",a);return r.__isLoadedClass(e)||customElements.get(a)?(r.__classes.mergeSet(e,{state:"loaded"}),s=Promise.resolve()):"loading"==r.__classes.get(e,{}).state?s=r.__classes.get(e).promise:(r.__classes.mergeSet(e,{state:"loading"}),s=r.__loadComponentScript(u,n,i).then((function(){r.__classes.mergeSet(e,{state:"loaded",promise:null})})),r.__classes.mergeSet(e,{promise:s})),s},r.__loadComponentScript=function(e,n,r){var o=t.concatPath([n,e+".js"]),i=t.concatPath([n,e+".settings.js"]);return Promise.resolve().then((function(){return a.loadScript(o)})).then((function(){if(r.splitComponent)return a.loadScript(i)})).then((function(){}))},r.__insertTag=function(e,n,r){var o,i=e._rootElement.querySelector(t.safeGet(r,"settings.rootNode"));if(!i)throw new ReferenceError("Root node does not exist. name="+e.name+", tagName="+n+", rootNode="+t.safeGet(r,"settings.rootNode"));var s=t.safeGet(r,"settings.tag")?t.safeGet(r,"settings.tag"):"<"+n+"></"+n+">";return t.safeGet(r,"settings.overwrite")?(i.outerHTML=s,o=i):(i.insertAdjacentHTML("afterbegin",s),o=i.children[0]),o._injectSettings=function(e){var n;return n=o._super.prototype._injectSettings?Object.assign({},o._super.prototype._injectSettings.call(this,e)):{},t.deepMerge(n,r)},o},r}(r),_=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.organize=function(t,e,r){return"loading"!==document.readyState?n._load.call(e,e):document.addEventListener("DOMContentLoaded",(function(){n._load.call(e,e)})),r},n._load=function(e){var n=t.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.componentPath","")]),r=e.settings.get("system.splitComponent",!1),o=e.getAttribute("bm-target");d.loadTags(document,n,{splitComponent:r},o)},n}(r);window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.Component=n,window.BITSMIST.v1.Organizer=r,window.BITSMIST.v1.OrganizerOrganizer=g,g.globalInit(),window.BITSMIST.v1.SettingOrganizer=c,c.globalInit(),g.organizers.set("StateOrganizer",{object:p,targetWords:"waitFor",targetEvents:["afterAppend"],order:200}),window.BITSMIST.v1.StateOrganizer=p,g.organizers.set("EventOrganizer",{object:l,targetWords:"events",targetEvents:["beforeStart","afterAppend"],order:300}),window.BITSMIST.v1.EventOrganizer=l,g.organizers.set("TemplateOrganizer",{object:m,targetWords:"templates",targetEvents:["beforeStart"],order:600}),window.BITSMIST.v1.TemplateOrganizer=m,g.organizers.set("AutoloadOrganizer",{object:_,targetWords:"autoloads",targetEvents:["beforeStart"],order:700}),window.BITSMIST.v1.AutoloadOrganizer=_,g.organizers.set("ComponentOrganizer",{object:d,targetWords:"components",targetEvents:["afterAppend"],order:800}),window.BITSMIST.v1.ComponentOrganizer=d,window.BITSMIST.v1.Pad=f,window.BITSMIST.v1.Store=o,window.BITSMIST.v1.OrganizerStore=s,window.BITSMIST.v1.ChainableStore=u,window.BITSMIST.v1.AjaxUtil=a,window.BITSMIST.v1.ClassUtil=e,window.BITSMIST.v1.Util=t,BITSMIST.v1.settings=c.globalSettings,e.newComponent(n,{settings:{name:"SettingManager",loadGlobalSettings:!0}},"bm-setting","SettingManager"),e.newComponent(n,{settings:{name:"TagLoader",autoSetup:!1},organizers:{AutoloadOrganizer:""}},"bm-tagloader","TagLoader"),document.addEventListener("DOMContentLoaded",(function(){if(BITSMIST.v1.settings.get("system.autoLoadOnStartup",!0)){var e=t.concatPath([BITSMIST.v1.settings.get("system.appBaseUrl",""),BITSMIST.v1.settings.get("system.componentPath","")]),n=BITSMIST.v1.settings.get("system.splitComponent",!1);d.loadTags(document,e,{splitComponent:n})}}))}();
