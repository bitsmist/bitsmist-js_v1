!function(){"use strict";function g(){}g.safeGet=function(t,e,n){for(var r=n,o=t,i=!0,a=e.split("."),s=0;s<a.length;s++){if(!("object"==typeof o&&a[s]in o)){i=!1;break}o=o[a[s]]}return i&&(r=o),r},g.safeSet=function(t,e,n){for(var r,o=t,i=e.split("."),a=0;a<i.length-1;a++){if("object"!=typeof o||i[a]in o){if("object"!=typeof o)throw new TypeError("Key already exists. key="+e+", existingKey="+r+", existingValue="+o)}else o[i[a]]={};r=i[a],o=o[i[a]]}if("object"!=typeof o)throw new TypeError("Key already exists. key="+e+", existingKey="+r+", existingValue="+o);return o[i[i.length-1]]=n,t},g.safeHas=function(t,e){for(var n=t,r=!0,o=e.split("."),i=0;i<o.length;i++){if(!("object"==typeof n&&o[i]in n)){r=!1;break}n=n[o[i]]}return r},g.concatPath=function(t){for(var e=t[0]||"",n=1;n<t.length;n++)t[n]&&("/"==e.slice(e.length-1)&&"/"==t[n].slice(0,1)?e+=t[n].slice(1):"/"==e.slice(e.length-1)||"/"==t[n].slice(0,1)?e+=t[n]:e?e+="/"+t[n]:e=t[n]);return e},g.deepMerge=function(e,n){return n&&Object.keys(n).forEach(function(t){Array.isArray(e[t])?e[t]=e[t].concat(n[t]):e.hasOwnProperty(t)&&"object"==typeof e[t]?g.deepMerge(e[t],n[t]):e[t]=n[t]}),e},g.getClassNameFromTagName=function(t){var e=t.split("-");return e[0].charAt(0).toUpperCase()+e[0].slice(1).toLowerCase()+e[1].charAt(0).toUpperCase()+e[1].slice(1).toLowerCase()},g.getTagNameFromClassName=function(t){var e,n,r,o=t.split(".");for(t=o[o.length-1],r=1;r<t.length&&!g.__isUpper(t.substring(r,r+1));r++);return e=t.substring(0,r),n=t.substring(r),e.toLowerCase()+"-"+n.toLowerCase()},g.getFilenameAndPathFromUrl=function(t){var e=t.lastIndexOf("/");return[t.substr(0,e),t.substr(e+1)]},g.__isUpper=function(t){return t==t.toUpperCase()&&t!=t.toLowerCase()};function a(){}function r(){return Reflect.construct(HTMLElement,[],this.constructor)}a.newComponent=function(t,e,n,r){r=r||g.getClassNameFromTagName(n);var o=Function("superClass","return function "+a.__validateClassName(r)+"(){ { return Reflect.construct(superClass, [], this.constructor); } }")(t);return a.inherit(o,t),(e=Object.assign({},e)).name=r,o.prototype._getSettings=function(){return e},n&&customElements.define(n.toLowerCase(),o),o},a.inherit=function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).prototype._super=e,Object.setPrototypeOf(t,e)},a.createObject=function(t){for(var e=[],n=arguments.length-1;0<n--;)e[n]=arguments[n+1];var r=a.getClass(t);if(!r)throw new ReferenceError("Class '"+t+"' is not defined.");return new(Function.prototype.bind.apply(r,[null].concat(e)))},a.getClass=function(t){var e;try{e=Function("return ("+a.__validateClassName(t)+")")()}catch(t){if(!(t instanceof ReferenceError))throw t}return e},a.__validateClassName=function(t){if(!/^[a-zA-Z0-9\-\._]+$/.test(t))throw new TypeError("Class name '"+t+"' is not valid.");return t},a.inherit(r,HTMLElement),r.prototype.connectedCallback=function(){return this.isInitialized()?Promise.resolve():this.start()},r.prototype.disconnectedCallback=function(){return this._settings.get("autoStop")?this.stop():Promise.resolve()},r.prototype.adoptedCallback=function(){},r.prototype.attributeChangedCallback=function(){},Object.defineProperty(r.prototype,"name",{get:function(){return this._name}}),Object.defineProperty(r.prototype,"uniqueId",{get:function(){return this._uniqueId}}),r.prototype.start=function(n){var r=this;return n=g.deepMerge({autoSetup:!0,autoStop:!0,useGlobalSettings:!0,organizers:{SettingOrganizer:"",OrganizerOrganizer:"",StateOrganizer:""}},n),this._uniqueId=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16),this._name=this.constructor.name,Promise.resolve().then(function(){return r._injectSettings(n)}).then(function(t){return r.initOrganizers(t)}).then(function(){return r.changeState("starting")}).then(function(){return r.callOrganizers("beforeStart",r._settings.items)}).then(function(t){return n=t,r.trigger("beforeStart",r)}).then(function(){var t=r._settings.get("autoSetupOnStart"),e=r._settings.get("autoSetup");if(t||!1!==t&&e)return r.setup(n)}).then(function(){return r.callOrganizers("afterStart",r._settings.items)}).then(function(){return r.trigger("afterStart",r)}).then(function(){return r.changeState("started")}).then(function(){return n})},r.prototype.stop=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.changeState("stopping")}).then(function(){return e.trigger("beforeStop",n,t)}).then(function(){return e.trigger("doStop",n,t)}).then(function(){return e.trigger("afterStop",n,t)}).then(function(){return e.changeState("stopped")})},r.prototype.setup=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.trigger("beforeSetup",n,t)}).then(function(){return e.trigger("doSetup",n,t)}).then(function(){return e.trigger("afterSetup",n,t)}).then(function(){})},r.prototype._injectSettings=function(t){return t},r.prototype._getSettings=function(){return{}},customElements.define("bm-component",r);function t(){}t.globalInit=function(){},t.init=function(){},t.organize=function(){},t.clear=function(){},t.isTarget=function(t,e){return-1<e.targetEvents.indexOf(t)};function s(t){this._chain=g.safeGet(t,"chain"),this._filter,this.items=g.safeGet(t,"items"),this.filter=g.safeGet(t,"filter",function(){return!0}),this.merger=g.safeGet(t,"merger",g.deepMerge)}var e={items:{configurable:!0},filter:{configurable:!0},merger:{configurable:!0}};e.items.get=function(){var t=this._chain?Object.assign({},this._chain._items,this._items):Object.assign({},this._items);return t},e.items.set=function(t){this._items=Object.assign({},t)},e.filter.get=function(){this._filter},e.filter.set=function(t){if("function"!=typeof t)throw TypeError("Filter is not a function. filter="+t);this._filter=t},e.merger.get=function(){this._merger},e.merger.set=function(t){if("function"!=typeof t)throw TypeError("Merger is not a function. filter="+t);this._merger=t},s.prototype.chain=function(t){this._chain=t},s.prototype.clear=function(){this._items={}},s.prototype.merge=function(t,e){if(t){e=e||this._merger;for(var n=Array.isArray(t)?t:[t],r=0;r<n.length;r++)e(this._items,n[r])}},s.prototype.get=function(t,e){return this._getChainedItem(this._chain,this,t,e)},s.prototype.set=function(t,e){g.safeSet(this._items,t,e)},s.prototype.setWithOrder=function(t,e){this.set(t,e)},s.prototype.mergeSet=function(t,e){var n=this._getLocal(t);"object"==typeof n?Object.assign(n,e):this.set(t,e)},s.prototype.remove=function(t){delete this._items[t]},s.prototype.has=function(t){return g.safeHas(this._items,t)},s.prototype._getLocal=function(t,e){return g.safeGet(this._items,t,e)},s.prototype._getChainedItem=function(t,e,n,r){var o=r;return e&&e.has(n)?o=e._getLocal(n):t&&t.has(n)&&(o=t._getLocal(n)),o},Object.defineProperties(s.prototype,e);function l(){}var n=function(r){function t(t,e){r.call(this,t,e),this._targetWords={}}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.set=function(t,e){(e=Object.assign({},e)).name=e.name?e.name:t,e.targetWords=e.targetWords?e.targetWords:[],e.targetWords=Array.isArray(e.targetWords)?e.targetWords:[e.targetWords],e.targetEvents=e.targetEvents?e.targetEvents:[],e.targetEvents=Array.isArray(e.targetEvents)?e.targetEvents:[e.targetEvents],r.prototype.set.call(this,t,e),e.object.globalInit(e.targetClass);for(var n=0;n<e.targetWords.length;n++)this._targetWords[e.targetWords[n]]=e},t.prototype.getMerger=function(t){return g.safeGet(this._targetWords,t+".object.merger",g.deepmerge)},t.prototype.getOrganizerInfoByTargetWords=function(t){return g.safeGet(this._targetWords,t)},t}(s);l.ajaxRequest=function(c){return new Promise(function(t,e){var n=g.safeGet(c,"url"),r=g.safeGet(c,"method"),o=g.safeGet(c,"data",""),i=g.safeGet(c,"headers"),a=g.safeGet(c,"options"),s=new XMLHttpRequest;s.open(r,n,!0),a&&Object.keys(a).forEach(function(t){s[t]=a[t]}),i&&Object.keys(i).forEach(function(t){s.setRequestHeader(t,i[t])}),s.addEventListener("load",function(){(200==s.status||201==s.status?t:e)(s)}),s.addEventListener("error",function(){e(s)}),s.send(o)})},l.loadScript=function(i){return new Promise(function(n,t){var e=i,r=document.createElement("script"),o=document.getElementsByTagName("script")[0];r.async=1,r.onload=r.onreadystatechange=function(t,e){!e&&r.readyState&&!/loaded|complete/.test(r.readyState)||(r.onload=r.onreadystatechange=null,r=void 0,e||n())},r.src=e,o.parentNode.insertBefore(r,o)})};var i=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),((i.prototype=Object.create(t&&t.prototype)).constructor=i).globalInit=function(){Object.defineProperty(r.prototype,"settings",{get:function(){return this._settings}}),i.__globalSettings=new s},i.init=function(t,e,n){e._settings=new s({items:n}),e.settings.merge(e._getSettings()),e.settings.get("name")&&(e._name=e.settings.get("name")),e.settings.get("useGlobalSettings")&&e.settings.chain(i.__globalSettings)},i.organize=function(t,e){return Promise.resolve().then(function(){return i.__loadExtraSettings(e,"setting")}).then(function(t){t&&e.settings.merge(t),i.__loadAttrSettings(e)}).then(function(){return e.settings.get("loadGlobalSettings")&&(i.__globalSettings.items=e.settings.items.settings),e.settings.items})},i.isTarget=function(t){return"beforeStart"==t},i._loadSetting=function(t,e){var n,r=g.concatPath([e,t+".js"]);return l.ajaxRequest({url:r,method:"GET"}).then(function(t){try{n=JSON.parse(t.responseText)}catch(t){throw new SyntaxError("Illegal json string. url="+r)}return n})},i.__loadExtraSettings=function(t,e){var n,r,o;if(t.hasAttribute("data-"+e+"href")?(r=(n=g.getFilenameAndPathFromUrl(t.getAttribute("data-"+e+"href")))[0],o=n[1].slice(0,-3)):(r=t.hasAttribute("data-"+e+"path")?t.getAttribute("data-"+e+"path"):"",o=t.hasAttribute("data-"+e+"name")?t.getAttribute("data-"+e+"name"):"",r&&!o&&(o="settings")),o||r)return i._loadSetting(o,r)},i.__loadAttrSettings=function(e){var t;e.hasAttribute("href")&&(t=g.getFilenameAndPathFromUrl(e.getAttribute("href")),e.settings.set("system.appBaseUrl",""),e.settings.set("system.templatePath",t[0]),e.settings.set("system.componentPath",t[0]),e.settings.set("path","")),e.hasAttribute("data-path")&&e.settings.set("path",e.getAttribute("data-path"));var n,r=document.querySelector(e.settings.get("rootNode"))?document.querySelector(e.settings.get("rootNode")).getAttribute("data-settings"):e.getAttribute("data-settings");r&&(n=JSON.parse(r),Object.keys(n).forEach(function(t){e.settings.set(t,n[t])}))},i}(t),o=function(t){function a(){t.apply(this,arguments)}return t&&(a.__proto__=t),((a.prototype=Object.create(t&&t.prototype)).constructor=a).globalInit=function(){Object.defineProperty(r.prototype,"organizers",{get:function(){return this._organizers}}),r.prototype.callOrganizers=function(t,e){return a.callOrganizers(this,t,e)},r.prototype.initOrganizers=function(t){return a.initOrganizers(this,t)},a.__organizers=new n,Object.defineProperty(a,"organizers",{get:function(){return a.__organizers}})},a.organize=function(t,n,e){var r={},o=Promise.resolve(),i=e.organizers;return i&&Object.keys(i).forEach(function(t){!n._organizers[t]&&a.__organizers.items[t]&&(r[t]=a.__organizers.items[t])}),Object.keys(e).forEach(function(t){var e=a.__organizers.getOrganizerInfoByTargetWords(t);e&&(n._organizers[e.name]||(r[e.name]=e.object))}),a._sortItems(r).forEach(function(t){o=o.then(function(){return n._organizers[t]=Object.assign({},a.__organizers.items[t],g.safeGet(e,"organizers."+t)),n._organizers[t].object.init("*",n,e)})}),o.then(function(){return e})},a.clear=function(t){t._organizers={}},a.initOrganizers=function(t,e){return t._organizers={},Promise.resolve().then(function(){return i.init("*",t,e)}).then(function(){return a.organize("*",t,e)})},a.callOrganizers=function(r,o,e){return Promise.resolve().then(function(){return i.isTarget(o)?i.organize(o,r,e):e}).then(function(t){return a.organize("*",r,t)}).then(function(t){var n=Promise.resolve(e);return a._sortItems(r._organizers).forEach(function(e){r._organizers[e].object.isTarget(o,r._organizers[e],r)&&(n=n.then(function(t){return r._organizers[e].object.organize(o,r,t)}))}),n})},a._sortItems=function(n){return Object.keys(n).sort(function(t,e){return n[t].order-n[e].order})},a}(t),c=function(o){function a(){o.apply(this,arguments)}return o&&(a.__proto__=o),((a.prototype=Object.create(o&&o.prototype)).constructor=a).globalInit=function(){Object.defineProperty(r.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t}}),r.prototype.changeState=function(t){return a._changeState(this,t)},r.prototype.isInitialized=function(){return a._isInitialized(this)},r.prototype.waitFor=function(t,e){return a._waitFor(this,t,e)},r.prototype.suspend=function(t){return a._suspend(this,t)},a.__components=new s,a.__waitingList=new s,a.__waitingListIndexName=new Map,a.__waitingListIndexId=new Map,a.__waitingListIndexNone=[],r.prototype.resume=function(t){return a._resume(this,t)}},a.init=function(t,e){e._state="",a.__loadAttrSettings(e)},a.organize=function(t,e,n){var r=Promise.resolve(),o=n.waitFor;return o&&(r=a._waitFor(e,o)),r.then(function(){return n})},a.clear=function(){this.__waitingList.clear()},a.isTarget=function(t,e,n){var r=!1;return"beforeStart"==t?n instanceof BITSMIST.v1.Pad||(r=!0):r=o.isTarget.call(this,t,e,n),r},a._waitFor=function(n,r,o){var t;o=o||1e4;var i={waiter:n,waitlist:r.slice()};return a.__isAllReady(i)?t=Promise.resolve():(t=new Promise(function(t,e){i.resolve=t,i.reject=e,setTimeout(function(){e("waitFor() timed out after "+o+" milliseconds waiting for "+JSON.stringify(r)+", name="+n.name+".")},o)}),i.promise=t,a.__addToWaitingList(i,n)),t},a._waitForSingle=function(t,e,n){var r=a.__components.get(t.uniqueId),o={id:t.uniqueId,state:e};return a.__isReady(o,r)?Promise.resolve():a.waitFor(t,[o],n)},a._changeState=function(t,e){if(!a.__isTransitionable(t.state,e))throw Error("Illegal transition. name="+t.name+", fromState="+t.state+", toState="+e+", id="+t.id);t.state=e,a.__components.mergeSet(t.uniqueId,{object:t,state:e}),a.__processWaitingList(t,e)},a._suspend=function(t,e){var n={},r=new Promise(function(t,e){n.resolve=t,n.reject=e});return n.promise=r,t._suspend[e]=n,r},a._resume=function(t,e){t._suspend[e].resolve()},a._isInitialized=function(t){var e=!1;return t.state&&"starting"!=t.state&&"stopping"!=t.state&&"stopped"!=t.state&&(e=!0),e},a.__isTransitionable=function(t,e){var n=!0;return t&&"ing"==t.slice(-3)&&("stopping"==t&&"stopped"!=e||"starting"==t&&"started"!=e||"opening"==t&&"opened"!=e&&"opening"!=e||"closeing"==t&&"closed"!=e||"stopping"==t&&"stopped"!=e&&"closing"!=e)&&(n=!1),n},a.__processWaitingList=function(t,e){var n=a.__waitingListIndexName.get(t.name+"."+e);a.__processIndex(n);var r=a.__waitingListIndexId.get(t.uniqueId+"."+e);a.__processIndex(r),a.__processIndex(a.__waitingListIndexNone)},a.__processIndex=function(t){if(t)for(var e=0;e<t.length;e++){var n=t[e];n&&(a.__waitingList.get(n),a.__isAllReady(a.__waitingList.get(n))&&(a.__waitingList.get(n).resolve(),a.__waitingList.remove(n),t[e]=null))}},a.__addToWaitingList=function(t){var e=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16);a.__waitingList.set(e,t);for(var n=t.waitlist,r=0;r<n.length;r++)n[r].id?a.__addToIndex(a.__waitingListIndexId,n[r].id+"."+n[r].state,e):n[r].name?a.__addToIndex(a.__waitingListIndexName,n[r].name+"."+n[r].state,e):a.__waitingListIndexNone.push(e)},a.__addToIndex=function(t,e,n){t.get(e)||t.set(e,[]),t.get(e).push(n)},a.__getComponentInfo=function(e){var n,t;return e.id?n=a.__components.get(e.id):e.name?Object.keys(a.__components.items).forEach(function(t){e.name==a.__components.get(t).object.name&&(n=a.__components.get(t))}):!e.rootNode||(t=document.querySelector(e.rootNode))&&(n=a.__components.get(t.uniqueId)),n},a.__isAllReady=function(t){for(var e=!0,n=t.waitlist,r=0;r<n.length;r++){var o=!1,i=this.__getComponentInfo(n[r]);if(i&&a.__isReady(n[r],i)&&(o=!0),!o){e=!1;break}}return e},a.__isReady=function(t,e){return t.state=t.state||"opened",a.__isComponentMatch(e,t)&&a.__isStateMatch(e.state,t.state)},a.__isComponentMatch=function(t,e){var n=!0;return e.component&&t.object!==e.component&&(n=!1),e.name&&t.object.name!=e.name&&(n=!1),e.id&&t.object.uniqueId!=e.id&&(n=!1),e.rootNode&&!document.querySelector(e.rootNode)&&(n=!1),n},a.__isStateMatch=function(t,e){var n=!0;switch(e){case"started":"opening"!=t&&"opened"!=t&&"closing"!=t&&"closed"!=t&&"started"!=t&&(n=!1);break;default:t!=e&&(n=!1)}return n},a.__loadAttrSettings=function(t){var e,n;t.hasAttribute("data-waitfor")&&(e={name:t.getAttribute("data-waitfor"),state:"started"},t.settings.merge({waitFor:[e]})),t.hasAttribute("data-waitfornode")&&(n={rootNode:t.getAttribute("data-waitfornode"),state:"started"},t.settings.merge({waitFor:[n]}))},a}(t),u=function(t){function u(){t.apply(this,arguments)}return t&&(u.__proto__=t),((u.prototype=Object.create(t&&t.prototype)).constructor=u).globalInit=function(){r.prototype.addEventHandler=function(t,e,n,r,o){u._addEventHandler(this,t,e,n,r,o)},r.prototype.trigger=function(t,e,n,r){return u._trigger(this,t,e,n,r)},r.prototype.triggerSync=function(t,e,n,r){return u._triggerSync(this,t,e,n,r)},r.prototype.setHtmlEventHandlers=function(t,e,n){u._setHtmlEventHandlers(this,t,e,n)},r.prototype.getEventHandler=function(t,e,n,r){return u._getEventHandler(this,t,e,n,r)}},u.organize=function(t,r,e){var o=e.events;return o&&Object.keys(o).forEach(function(t){for(var e=Array.isArray(o[t])?o[t]:[o[t]],n=0;n<e.length;n++)r.addEventHandler(r,t,e[n])}),e},u._addEventHandler=function(t,e,n,r,o,i){var a=u._getEventHandler(t,r,i);if("function"!=typeof a){var s=i?i.name:"";throw TypeError("Event handler is not a function. componentName="+t.name+", pluginName="+s+", eventName="+n)}e._bm_detail||(e._bm_detail={component:t,listeners:{},promises:{},statuses:{}});var c=e._bm_detail.listeners;c[n]||(c[n]=[],e.addEventListener(n,u.__callEventHandler)),c[n].push({handler:a,options:Object.assign({},o),bind:i,order:void 0});"object"==typeof r&&r.order&&r.order;c[n].sort(function(t,e){return t.order==e.order?0:t.order>e.order?1:-1})},u._trigger=function(t,e,n,r,o){(r=Object.assign({},r)).sender=n,o=o||t;var i=null;try{i=new CustomEvent(e,{detail:r})}catch(t){(i=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!1,r)}return o.dispatchEvent(i),g.safeGet(o,"_bm_detail.promises."+e)||Promise.resolve()},u._triggerSync=function(t,e,n,r,o){return(r=r||{}).async=!1,u._trigger.call(t,t,e,n,r,o)},u._setHtmlEventHandlers=function(n,t,r,e){e=e||n;for(var o=n.settings.get("elements."+t),i=o.rootNode?e.querySelectorAll(o.rootNode):e.querySelectorAll("#"+t),a=o.events,s=0;s<i.length;s++)!function(e){Object.keys(a).forEach(function(t){r=Object.assign({},a[t].options,r),u._addEventHandler(n,i[e],t,a[t],r)})}(s)},u._getEventHandler=function(t,e,n){n=n||t;var r="object"==typeof e?e.handler:e;return"string"==typeof r&&(r=n?n[r]:t[r]),r=r&&r.bind(n)},u.__callEventHandler=function(e){var n=this,t=g.safeGet(this,"_bm_detail.listeners."+e.type),r=g.safeGet(e,"detail.sender",this),o=g.safeGet(this,"_bm_detail.component");if("handling"==g.safeGet(this,"_bm_detail.statuses."+e.type))throw new Error("Event handler is already running. name="+this.tagName+", eventName="+e.type);g.safeSet(this,"_bm_detail.statuses."+e.type,"handling"),g.safeGet(e,"detail.async",!0)?this._bm_detail.promises[e.type]=u.__handleAsync(e,r,o,t).then(function(t){return g.safeSet(n,"_bm_detail.promises."+e.type,null),g.safeSet(n,"_bm_detail.statuses."+e.type,""),t}):(this._bm_detail.promises[e.type]=u.__handleSync(e,r,o,t),g.safeSet(this,"_bm_detail.promises."+e.type,null),g.safeSet(this,"_bm_detail.statuses."+e.type,""))},u.__handleAsync=function(r,o,t,i){for(var a=Promise.resolve(),s=[],c=!1,e=0;e<i.length;e++)!function(e){var n={target:t,options:i[e].options?i[e].options:{}};a=a.then(function(t){return t&&s.push(t),i[e].handler(o,r,n)}),c=!(!i[e].options||!i[e].options.stopPropagation)||c}(e);return c&&r.stopPropagation(),a.then(function(t){return t&&s.push(t),s})},u.__handleSync=function(t,e,n,r){for(var o=!1,i=0;i<r.length;i++){var a={target:n,options:r[i].options?r[i].options:{}};r[i].handler(e,t,a),o=!(!r[i].options||!r[i].options.stopPropagation)||o}return o&&t.stopPropagation(),Promise.resolve()},u}(t),p=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),((i.prototype=Object.create(t&&t.prototype)).constructor=i).organize=function(t,e,n){var r={afterStart:i.onDoOrganize,afterAppend:i.onDoOrganize,afterSpecLoad:i.onDoOrganize,beforeOpen:i.onDoOrganize,afterOpen:i.onDoOrganize,beforeClose:i.onDoOrganize,afterClose:i.onDoOrganize,doRefresh:i.onDoOrganize},o=n.attrs;return o&&Object.keys(o).forEach(function(t){r[t]&&e.addEventHandler(e,t,r[t],{attrs:o[t]},e)}),n},i.onDoOrganize=function(t,e,n){var r=n.target,o=n.options.attrs;return i._initAttr(r,o)},i._initAttr=function(n,r){return r&&Object.keys(r).forEach(function(e){switch(e){case"style":Object.keys(r[e]).forEach(function(t){n.style[t]=r[e][t]});break;default:n.setAttribute(e,r[e])}}),Promise.resolve()},i}(t);function f(){return Reflect.construct(r,[],this.constructor)}a.inherit(f,r),customElements.define("bm-pad",f),f.prototype.open=function(n){var r=this,t=(n=Object.assign({},n)).sender?n.sender:this;return Promise.resolve().then(function(){return r.changeState("opening")}).then(function(){return r.switchTemplate(r._settings.get("templateName"))}).then(function(){return r.trigger("beforeOpen",t,n)}).then(function(){var t=r._settings.get("autoSetupOnOpen"),e=r._settings.get("autoSetup");if(t||!1!==t&&e)return r.setup(n)}).then(function(){if(r._settings.get("autoRefresh"))return r.refresh(n)}).then(function(){return r.trigger("doOpen",t,n)}).then(function(){return r.trigger("afterOpen",t,n)}).then(function(){return r.changeState("opened")})},f.prototype.openModal=function(n){var r=this;return new Promise(function(t,e){r._isModal=!0,r._modalResult={result:!1},r._modalPromise={resolve:t,reject:e},r.open(n)})},f.prototype.close=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.changeState("closing")}).then(function(){return e.trigger("beforeClose",n,t)}).then(function(){return e.trigger("doClose",n,t)}).then(function(){return e.trigger("afterClose",n,t)}).then(function(){e._isModal&&e._modalPromise.resolve(e._modalResult)}).then(function(){return e.changeState("closed")})},f.prototype.refresh=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.trigger("beforeRefresh",n,t)}).then(function(){if(e._settings.get("autoFill"))return e.fill(t)}).then(function(){return e.trigger("doRefresh",n,t)}).then(function(){return e.trigger("afterRefresh",n,t)}).then(function(){})},f.prototype.switchTemplate=function(t,e){var n=this,r=(e=Object.assign({},e)).sender?e.sender:this;return this.isActiveTemplate(t)?Promise.resolve():Promise.resolve().then(function(){return n.addTemplate(t,{rootNode:n._settings.get("rootNode"),templateNode:n._settings.get("templateNode")})}).then(function(){var t=g.concatPath([n._settings.get("system.appBaseUrl",""),n._settings.get("system.componentPath","")]),e=n._settings.get("system.splitComponent",!1);return n.loadTags(n,t,{splitComponent:e})}).then(function(){return n.callOrganizers("afterAppend",n._settings.items)}).then(function(){return n.trigger("afterAppend",r,e)}).then(function(){})},f.prototype.fill=function(t){},f.prototype.start=function(e){var n=this;return e=g.deepMerge({autoSetupOnStart:!1,organizers:{TemplateOrganizer:""}},e),Promise.resolve().then(function(){return r.prototype.start.call(n,e)}).then(function(t){if(e=t,n._settings.get("autoOpen"))return n.open(e)})};var d=function(o){function i(){o.apply(this,arguments)}return o&&(i.__proto__=o),((i.prototype=Object.create(o&&o.prototype)).constructor=i).globalInit=function(){f.prototype.addTemplate=function(t,e){return i._addTemplate(this,t,e)},f.prototype.cloneTemplate=function(t){return i._clone(this,t)},f.prototype.isActiveTemplate=function(t){return i._isActive(this,t)}},i.init=function(t,e){e._templates={},e.settings.set("templateName",e.settings.get("templateName",e.tagName.toLowerCase())),e.settings.set("autoOpen",e.settings.get("autoOpen",!0)),e.settings.set("autoClose",e.settings.get("autoClose",!0)),i.__loadAttrSettings(e)},i.organize=function(t,e,n){var r=n.templates;return r&&Object.keys(r).forEach(function(t){i.__getTemplateInfo(e,t).html=r[t]}),n},i.clear=function(t){t._templates={}},i.isTarget=function(t,e,n){var r=!1;return n instanceof BITSMIST.v1.Pad&&(r=o.isTarget.call(this,t,e,n)),r},i._isActive=function(t,e){var n=!1;return i.__getTemplateInfo(t,e).isAppended&&(n=!0),n},i._addTemplate=function(e,t){var n=i.__getTemplateInfo(e,t);if(n.isAppended)throw new ReferenceError("Template already appended. name="+e.name+", templateName="+t);return Promise.resolve().then(function(){var t=g.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.templatePath",""),e.settings.get("path","")]);return i._loadTemplate(e,n,t)}).then(function(){return e.settings.get("templateNode")&&i.__storeTemplateNode(e,n,e.settings.get("templateNode")),i.__applyTemplate(e,n)}).then(function(){e._templates[e.settings.get("templateName")]&&(e._templates[e.settings.get("templateName")].isAppended=!1),e._templates[t].isAppended=!0,e.settings.set("templateName",t)})},i._loadTemplate=function(t,e,n){return i.__autoLoadTemplate(t,e,n)},i._clone=function(t,e){if(e=e||t._settings.get("templateName"),!t._templates[e])throw new ReferenceError("Template not loaded. name="+t.name+", templateName="+e);var n=t._templates[e].node?document.importNode(t._templates[e].node,!0):i.__dupElement(t,e);return n},i.__autoLoadTemplate=function(t,e,n){var r,o;return e.html||e.node||(r=g.concatPath([n,e.name+".html"]),o=i.__loadTemplateFile(r).then(function(t){e.html=t})),Promise.all([o]).then(function(){if(!e.isLoaded)return t.trigger("afterLoadTemplate",t)}).then(function(){e.isLoaded=!0})},i.__loadTemplateFile=function(t){return l.ajaxRequest({url:t,method:"GET"}).then(function(t){return t.responseText})},i.__getTemplateInfo=function(t,e){return t._templates[e]||(t._templates[e]={},t._templates[e].name=e,t._templates[e].html="",t._templates[e].isAppended=!1,t._templates[e].isLoaded=!1),t._templates[e]},i.__storeTemplateNode=function(t,e,n){var r=document.querySelector(n);if(!r)throw new ReferenceError("Root node does not exist. name="+t.name+", rootNode="+n+", templateName="+e.name);r.insertAdjacentHTML("afterbegin",e.html);var o=r.children[0];e.node="content"in o?o.content:o},i.__applyTemplate=function(t,e){var n;e.node?(n=i.clone(t,e.name),t.insertBefore(n,t.firstChild)):t.innerHTML=e.html},i.__dupElement=function(t,e){e=e||t.settings.get("templateName");var n=document.createElement("div");return n.innerHTML=t._templates[e].html,n.firstElementChild},i.__loadAttrSettings=function(){},i}(t),_=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),((r.prototype=Object.create(t&&t.prototype)).constructor=r).organize=function(t,e,n){return"loading"!==document.readyState?r.onDOMContentLoaded.call(e,e):document.addEventListener("DOMContentLoaded",function(){r.onDOMContentLoaded.call(e,e)}),n},r.onDOMContentLoaded=function(t){var e=g.concatPath([t.settings.get("system.appBaseUrl",""),t.settings.get("system.componentPath","")]),n=t.settings.get("system.splitComponent",!1),r=t.getAttribute("data-target");t.loadTags(document,e,{splitComponent:n},r)},r}(t),m=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).organize=function(t,e,n){var r=n.elements;return r&&Object.keys(r).forEach(function(t){e.setHtmlEventHandlers(t)}),n},e}(t),h=function(o){function p(){o.apply(this,arguments)}return o&&(p.__proto__=o),((p.prototype=Object.create(o&&o.prototype)).constructor=p).globalInit=function(){r.prototype.loadTags=function(t,e,n,r){return p._loadTags(this,t,e,n,r)},p.__classes=new s},p.init=function(t,e){Object.defineProperty(e,"components",{get:function(){return this._components}}),e.addComponent=function(t,e,n){return p._addComponent(this,t,e,n)},e._components={}},p.organize=function(t,e,n){var r=Promise.resolve(),o=n.molds;o&&Object.keys(o).forEach(function(t){r=r.then(function(){return p._addComponent(e,t,o[t],"opened")})});var i=n.components;return i&&Object.keys(i).forEach(function(t){r=r.then(function(){return p._addComponent(e,t,i[t])})}),r.then(function(){return n})},p.clear=function(e){Object.keys(e.components).forEach(function(t){e.components[t].parentNode.removeChild(e._components[t])}),e._components={}},p.isTarget=function(t,e,n){var r=!1;return"beforeStart"==t?n instanceof BITSMIST.v1.Pad||(r=!0):r=o.isTarget.call(this,t,e,n),r},p._addComponent=function(n,e,r,o){var i=g.concatPath([n.settings.get("system.appBaseUrl",""),n.settings.get("system.componentPath",""),"path"in r?r.path:""]),a="splitComponent"in r?r.splitComponent:n.settings.get("system.splitComponent",!1),s=r.className||e,c=r.tagName||g.getTagNameFromClassName(s||e);return Promise.resolve().then(function(){var t=Object.assign({},r,{splitComponent:a}),e=g.safeGet(t,"autoLoad",n.settings.get("system.autoLoad",!0));return p._loadComponent(s,i,t,c,e)}).then(function(){r.rootNode&&!n.components[e]&&(n.components[e]=p.__insertTag(c,r))}).then(function(){var t;r.expose&&(t=!0===r.expose?e:r.expose,Object.defineProperty(n.__proto__,t,{get:function(){return this.components[e]}}))}).then(function(){if(o||r.sync){var t=!0===(o=o||r.sync)?"started":o,e=s.split(".");return n.waitFor([{name:e[e.length-1],state:t}])}})},p._loadTags=function(t,e,s,c,n){var u=[];return(n?document.querySelectorAll(n):e.querySelectorAll("[data-autoload],[data-automorph]")).forEach(function(t){var e,n,r,o,i,a;t.getAttribute("href")?(e=t.getAttribute("href"),u.push(l.loadScript(e))):(n=t.hasAttribute("data-path")?t.getAttribute("data-path"):"",r=t.hasAttribute("data-classname")?t.getAttribute("data-classname"):g.getClassNameFromTagName(t.tagName),o=t.hasAttribute("data-split")?t.getAttribute("data-split"):c.splitComponent,i=!!t.hasAttribute("data-automorph")&&(!t.getAttribute("data-automorph")||t.getAttribute("data-automorph")),a=Object.assign({},c,{splitComponent:o,morph:i}),u.push(p._loadComponent(r,g.concatPath([s,n]),a,t.tagName,!0))),t.removeAttribute("data-autoload"),t.removeAttribute("data-automorph")}),Promise.all(u)},p._loadComponent=function(t,e,n,r,o){if(n.morph){var i=!0===n.morph?BITSMIST.v1.Pad:a.getClass(n.morph);a.newComponent(i,n,r)}else if(o)return p.__autoloadComponent(t,e,n)},p.__isLoadedClass=function(t){var e=!1;return"loaded"!=p.__classes.get(t,{}).state&&!a.getClass(t)||(e=!0),e},p.__autoloadComponent=function(t,e,n){var r,o=n.tagName||g.getTagNameFromClassName(t);return p.__isLoadedClass(t)||customElements.get(o)?(p.__classes.mergeSet(t,{state:"loaded"}),r=Promise.resolve()):"loading"==p.__classes.get(t,{}).state?r=p.__classes.get(t).promise:(p.__classes.mergeSet(t,{state:"loading"}),r=p.__loadComponentScript(o,e,n).then(function(){p.__classes.mergeSet(t,{state:"loaded",promise:null})}),p.__classes.mergeSet(t,{promise:r})),r},p.__loadComponentScript=function(t,e,n){n=n||{};var r=g.concatPath([e,t+".js"]),o=g.concatPath([e,t+".settings.js"]);return Promise.resolve().then(function(){return l.loadScript(r)}).then(function(){if(n.splitComponent)return l.loadScript(o)}).then(function(){})},p.__insertTag=function(t,e){var n=document.querySelector(e.rootNode);if(!n)throw a.setError(new ReferenceError,{message:"Root node does not exist when adding "+t+" to "+e.rootNode});var r,o=e.tag?e.tag:"<"+t+"></"+t+">";return(r=e.overwrite?(n.outerHTML=o,n):(n.insertAdjacentHTML("afterbegin",o),n.children[0]))._injectSettings=function(t){return t=r._super.prototype._injectSettings?Object.assign({},r._super.prototype._injectSettings.call(this,t)):{},g.deepMerge(t,e)},r},p}(t),y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.notify=function(e,n){for(var r=this,o=[],t=arguments.length-2;0<t--;)o[t]=arguments[t+2];var i=Promise.resolve();return this._sortItems().forEach(function(t){i=i.then(function(){return r._callHandler.apply(r,[e,n,r._items[t]].concat(o))})}),i},e.prototype.notifySync=function(e,n){for(var r=this,o=[],t=arguments.length-2;0<t--;)o[t]=arguments[t+2];this._sortItems().forEach(function(t){r._callHandler.apply(r,[e,n,r._items[t]].concat(o))})},e.prototype._callHandler=function(t,e,n){for(var r,o,i=[],a=arguments.length-3;0<a--;)i[a]=arguments[a+3];if((r=this)._filter.apply(r,[e,n].concat(i))&&"function"==typeof n.object[t])return(o=n.object[t]).call.apply(o,[n.object,e].concat(i))},e.prototype._sortItems=function(){var n=this;return Object.keys(this._items).sort(function(t,e){return n._items[t].order-n.items[e].order})},e}(s);function v(){return Reflect.construct(r,[],this.constructor)}a.inherit(v,r),customElements.define("bm-tagloader",v),v.prototype.start=function(t){return t=BITSMIST.v1.Util.deepMerge({name:"TagLoader",autoSetup:!1,organizers:{AutoloadOrganizer:""}},t),BITSMIST.v1.Component.prototype.start.call(this,t)},window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.Component=r,window.BITSMIST.v1.Organizer=t,(window.BITSMIST.v1.OrganizerOrganizer=o).globalInit(),(window.BITSMIST.v1.SettingOrganizer=i).globalInit(),o.organizers.set("StateOrganizer",{object:c,targetWords:"waitFor",targetEvents:["afterAppend"],order:200}),window.BITSMIST.v1.StateOrganizer=c,o.organizers.set("EventOrganizer",{object:u,targetWords:"events",targetEvents:["beforeStart"],order:300}),window.BITSMIST.v1.EventOrganizer=u,o.organizers.set("AttrOrganizer",{object:p,targetWords:"attrs",targetEvents:["beforeStart"],order:600}),window.BITSMIST.v1.AttrOrganizer=p,o.organizers.set("TemplateOrganizer",{object:d,targetWords:"templates",targetEvents:["beforeStart"],order:600}),window.BITSMIST.v1.TemplateOrganizer=d,o.organizers.set("AutoloadOrganizer",{object:_,targetWords:"autoloads",targetEvents:["beforeStart"],order:700}),window.BITSMIST.v1.AutoloadOrganizer=_,o.organizers.set("ElementOrganizer",{object:m,targetWords:"elements",targetEvents:["afterAppend"],order:700}),window.BITSMIST.v1.ElementOrganizer=m,o.organizers.set("ComponentOrganizer",{object:h,targetWords:"components",targetEvents:["afterAppend"],order:800}),window.BITSMIST.v1.ComponentOrganizer=h,window.BITSMIST.v1.Pad=f,window.BITSMIST.v1.Store=s,window.BITSMIST.v1.ObserverStore=y,window.BITSMIST.v1.TagLoader=v,window.BITSMIST.v1.AjaxUtil=l,window.BITSMIST.v1.ClassUtil=a,window.BITSMIST.v1.Util=g}();
