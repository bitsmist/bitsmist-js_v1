!function(){"use strict";function l(){}l.safeGet=function(t,e,n){for(var r=n,o=t,i=!0,s=e.split("."),a=0;a<s.length;a++){if(!("object"==typeof o&&s[a]in o)){i=!1;break}o=o[s[a]]}return i&&(r=o),r},l.safeSet=function(t,e,n){for(var r,o=t,i=e.split("."),s=0;s<i.length-1;s++){if("object"!=typeof o||i[s]in o){if("object"!=typeof o)throw new TypeError("Key already exists. key="+e+", existingKey="+r+", existingValue="+o)}else o[i[s]]={};r=i[s],o=o[i[s]]}if("object"!=typeof o)throw new TypeError("Key already exists. key="+e+", existingKey="+r+", existingValue="+o);return o[i[i.length-1]]=n,t},l.safeHas=function(t,e){for(var n=t,r=!0,o=e.split("."),i=0;i<o.length;i++){if(!("object"==typeof n&&o[i]in n)){r=!1;break}n=n[o[i]]}return r},l.concatPath=function(t){for(var e=t[0]||"",n=1;n<t.length;n++)t[n]&&("/"==e.slice(e.length-1)&&"/"==t[n].slice(0,1)?e+=t[n].slice(1):"/"==e.slice(e.length-1)||"/"==t[n].slice(0,1)?e+=t[n]:e?e+="/"+t[n]:e=t[n]);return e},l.deepMerge=function(e,n){return n&&Object.keys(n).forEach(function(t){Array.isArray(e[t])?e[t]=e[t].concat(n[t]):e.hasOwnProperty(t)&&"object"==typeof e[t]?l.deepMerge(e[t],n[t]):e[t]=n[t]}),e},l.getClassNameFromTagName=function(t){var e=t.split("-");return e[0].charAt(0).toUpperCase()+e[0].slice(1).toLowerCase()+e[1].charAt(0).toUpperCase()+e[1].slice(1).toLowerCase()},l.getTagNameFromClassName=function(t){var e,n,r,o=t.split(".");for(t=o[o.length-1],r=1;r<t.length&&!l.__isUpper(t.substring(r,r+1));r++);return e=t.substring(0,r),n=t.substring(r),e.toLowerCase()+"-"+n.toLowerCase()},l.getFilenameAndPathFromUrl=function(t){var e=t.lastIndexOf("/");return[t.substr(0,e),t.substr(e+1)]},l.__isUpper=function(t){return t==t.toUpperCase()&&t!=t.toLowerCase()};function c(){}function a(){return Reflect.construct(HTMLElement,[],this.constructor)}c.newComponent=function(t,e,n,r){r=r||l.getClassNameFromTagName(n);var o=Function("superClass","return function "+c.__validateClassName(r)+"(){ { return Reflect.construct(superClass, [], this.constructor); } }")(t);return c.inherit(o,t),(e=Object.assign({},e)).settings=e.settings?e.settings:{},e.settings.name=r,o.prototype._getSettings=function(){return e},n&&customElements.define(n.toLowerCase(),o),o},c.inherit=function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).prototype._super=e,Object.setPrototypeOf(t,e)},c.createObject=function(t){for(var e=[],n=arguments.length-1;0<n--;)e[n]=arguments[n+1];var r=c.getClass(t);if(!r)throw new ReferenceError("Class '"+t+"' is not defined.");return new(Function.prototype.bind.apply(r,[null].concat(e)))},c.getClass=function(t){var e;try{e=Function("return ("+c.__validateClassName(t)+")")()}catch(t){if(!(t instanceof ReferenceError))throw t}return e},c.__validateClassName=function(t){if(!/^[a-zA-Z0-9\-\._]+$/.test(t))throw new TypeError("Class name '"+t+"' is not valid.");return t},c.inherit(a,HTMLElement),a.prototype.connectedCallback=function(){return this.isInitialized()?Promise.resolve():this.start()},a.prototype.disconnectedCallback=function(){return this._settings.get("settings.autoStop")?this.stop():Promise.resolve()},a.prototype.adoptedCallback=function(){},a.prototype.attributeChangedCallback=function(){},Object.defineProperty(a.prototype,"name",{get:function(){return this._name}}),Object.defineProperty(a.prototype,"uniqueId",{get:function(){return this._uniqueId}}),Object.defineProperty(a.prototype,"rootElement",{get:function(){return this._rootElement}}),a.prototype.start=function(n){var r=this;return n=l.deepMerge({settings:{autoSetup:!0,autoStop:!0,useGlobalSettings:!0},organizers:{SettingOrganizer:"",OrganizerOrganizer:"",StateOrganizer:""}},n),this._uniqueId=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16),this._name=this.constructor.name,this._rootElement=l.safeGet(n,"settings.rootElement")?document.querySelector(l.safeGet(n,"settings.rootElement")):this,Promise.resolve().then(function(){return r._injectSettings(n)}).then(function(t){return r.initOrganizers(t)}).then(function(){return r.changeState("starting")}).then(function(){return r.callOrganizers("beforeStart",r._settings.items)}).then(function(t){return n=t,r.trigger("beforeStart",r)}).then(function(){var t=r._settings.get("settings.autoSetupOnStart"),e=r._settings.get("settings.autoSetup");if(t||!1!==t&&e)return r.setup(n)}).then(function(){return r.callOrganizers("afterStart",r._settings.items)}).then(function(){return r.trigger("afterStart",r)}).then(function(){return r.changeState("started")}).then(function(){return n})},a.prototype.stop=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.changeState("stopping")}).then(function(){return e.trigger("beforeStop",n,t)}).then(function(){return e.trigger("doStop",n,t)}).then(function(){return e.trigger("afterStop",n,t)}).then(function(){return e.changeState("stopped")})},a.prototype.setup=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.trigger("beforeSetup",n,t)}).then(function(){return e.trigger("doSetup",n,t)}).then(function(){return e.trigger("afterSetup",n,t)}).then(function(){})},a.prototype._injectSettings=function(t){return t},a.prototype._getSettings=function(){return{}},customElements.define("bm-component",a);function t(){}t.globalInit=function(){},t.init=function(){},t.organize=function(){},t.clear=function(){},t.isTarget=function(t,e){return-1<e.targetEvents.indexOf(t)},t.getEditor=function(){return""};function u(t){this._chain=l.safeGet(t,"chain"),this._filter,this.items=l.safeGet(t,"items"),this.filter=l.safeGet(t,"filter",function(){return!0}),this.merger=l.safeGet(t,"merger",l.deepMerge)}var e={items:{configurable:!0},filter:{configurable:!0},merger:{configurable:!0}};e.items.get=function(){var t=this._chain?Object.assign({},this._chain._items,this._items):Object.assign({},this._items);return t},e.items.set=function(t){this._items=Object.assign({},t)},e.filter.get=function(){this._filter},e.filter.set=function(t){if("function"!=typeof t)throw TypeError("Filter is not a function. filter="+t);this._filter=t},e.merger.get=function(){this._merger},e.merger.set=function(t){if("function"!=typeof t)throw TypeError("Merger is not a function. filter="+t);this._merger=t},u.prototype.chain=function(t){this._chain=t},u.prototype.clear=function(){this._items={}},u.prototype.merge=function(t,e){if(t){e=e||this._merger;for(var n=Array.isArray(t)?t:[t],r=0;r<n.length;r++)e(this._items,n[r])}},u.prototype.get=function(t,e){return this._getChainedItem(this._chain,this,t,e)},u.prototype.set=function(t,e){l.safeSet(this._items,t,e)},u.prototype.setWithOrder=function(t,e){this.set(t,e)},u.prototype.mergeSet=function(t,e){var n=this._getLocal(t);"object"==typeof n?Object.assign(n,e):this.set(t,e)},u.prototype.remove=function(t){delete this._items[t]},u.prototype.has=function(t){return l.safeHas(this._items,t)},u.prototype._getLocal=function(t,e){return l.safeGet(this._items,t,e)},u.prototype._getChainedItem=function(t,e,n,r){var o=r;return e&&e.has(n)?o=e._getLocal(n):t&&t.has(n)&&(o=t._getLocal(n)),o},Object.defineProperties(u.prototype,e);function f(){}var n=function(r){function t(t,e){r.call(this,t,e),this._targetWords={}}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.set=function(t,e){(e=Object.assign({},e)).name=e.name?e.name:t,e.targetWords=e.targetWords?e.targetWords:[],e.targetWords=Array.isArray(e.targetWords)?e.targetWords:[e.targetWords],e.targetEvents=e.targetEvents?e.targetEvents:[],e.targetEvents=Array.isArray(e.targetEvents)?e.targetEvents:[e.targetEvents],r.prototype.set.call(this,t,e),e.object.globalInit(e.targetClass);for(var n=0;n<e.targetWords.length;n++)this._targetWords[e.targetWords[n]]=e},t.prototype.getMerger=function(t){return l.safeGet(this._targetWords,t+".object.merger",l.deepmerge)},t.prototype.getOrganizerInfoByTargetWords=function(t){return l.safeGet(this._targetWords,t)},t}(u);f.ajaxRequest=function(c){return new Promise(function(t,e){var n=l.safeGet(c,"url"),r=l.safeGet(c,"method"),o=l.safeGet(c,"data",""),i=l.safeGet(c,"headers"),s=l.safeGet(c,"options"),a=new XMLHttpRequest;a.open(r,n,!0),s&&Object.keys(s).forEach(function(t){a[t]=s[t]}),i&&Object.keys(i).forEach(function(t){a.setRequestHeader(t,i[t])}),a.addEventListener("load",function(){(200==a.status||201==a.status?t:e)(a)}),a.addEventListener("error",function(){e(a)}),a.send(o)})},f.loadScript=function(i){return new Promise(function(n,t){var e=i,r=document.createElement("script"),o=document.getElementsByTagName("script")[0];r.async=1,r.onload=r.onreadystatechange=function(t,e){!e&&r.readyState&&!/loaded|complete/.test(r.readyState)||(r.onload=r.onreadystatechange=null,r=void 0,e||n())},r.src=e,o.parentNode.insertBefore(r,o)})};var i=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),((i.prototype=Object.create(t&&t.prototype)).constructor=i).globalInit=function(){Object.defineProperty(a.prototype,"settings",{get:function(){return this._settings}}),i.__globalSettings=new u},i.init=function(t,e,n){e._settings=new u({items:n}),e.settings.merge(e._getSettings());var r=e.settings.get("settings.name");r&&(e._name=r),e.settings.get("settings.useGlobalSettings")&&e.settings.chain(i.__globalSettings)},i.organize=function(t,e){return Promise.resolve().then(function(){return i.__loadExtraSettings(e,"setting")}).then(function(t){t&&e.settings.merge(t),i.__loadAttrSettings(e)}).then(function(){return e.settings.get("settings.loadGlobalSettings")&&(i.__globalSettings.items=e.settings.items.globals),e.settings.items})},i.isTarget=function(t){return"beforeStart"==t},i._loadSetting=function(t,e){var n,r=l.concatPath([e,t+".js"]);return f.ajaxRequest({url:r,method:"GET"}).then(function(t){try{n=JSON.parse(t.responseText)}catch(t){throw new SyntaxError("Illegal json string. url="+r)}return n})},i.__loadExtraSettings=function(t,e){var n,r,o;if(t.hasAttribute("data-"+e+"href")?(r=(n=l.getFilenameAndPathFromUrl(t.getAttribute("data-"+e+"href")))[0],o=n[1].slice(0,-3)):(r=t.hasAttribute("data-"+e+"path")?t.getAttribute("data-"+e+"path"):"",o=t.hasAttribute("data-"+e+"name")?t.getAttribute("data-"+e+"name"):"",r&&!o&&(o="settings")),o||r)return i._loadSetting(o,r)},i.__loadAttrSettings=function(t){var e;t.hasAttribute("href")&&(e=l.getFilenameAndPathFromUrl(t.getAttribute("href")),t.settings.set("system.appBaseUrl",""),t.settings.set("system.templatePath",e[0]),t.settings.set("system.componentPath",e[0]),t.settings.set("settings.path","")),t.hasAttribute("data-path")&&t.settings.set("settings.path",t.getAttribute("data-path"));var n,r=document.querySelector(t.settings.get("settings.rootNode"))?document.querySelector(t.settings.get("settings.rootNode")).getAttribute("data-settings"):t.getAttribute("data-settings");r&&(n={settings:JSON.parse(r)},t.settings.merge(n))},i}(t),r=function(t){function s(){t.apply(this,arguments)}return t&&(s.__proto__=t),((s.prototype=Object.create(t&&t.prototype)).constructor=s).globalInit=function(){Object.defineProperty(a.prototype,"organizers",{get:function(){return this._organizers}}),a.prototype.callOrganizers=function(t,e){return s._callOrganizers(this,t,e)},a.prototype.initOrganizers=function(t){return s._initOrganizers(this,t)},s.__organizers=new n,Object.defineProperty(s,"organizers",{get:function(){return s.__organizers}})},s.organize=function(t,n,e){var r={},o=Promise.resolve(),i=e.organizers;return i&&Object.keys(i).forEach(function(t){!n._organizers[t]&&s.__organizers.items[t]&&(r[t]=s.__organizers.items[t])}),Object.keys(e).forEach(function(t){var e=s.__organizers.getOrganizerInfoByTargetWords(t);e&&(n._organizers[e.name]||(r[e.name]=e.object))}),s._sortItems(r).forEach(function(t){o=o.then(function(){return n._organizers[t]=Object.assign({},s.__organizers.items[t],l.safeGet(e,"organizers."+t)),n._organizers[t].object.init("*",n,e)})}),o.then(function(){return e})},s.clear=function(t){t._organizers={}},s._initOrganizers=function(t,e){return t._organizers={},Promise.resolve().then(function(){return i.init("*",t,e)}).then(function(){return s.organize("*",t,e)})},s._callOrganizers=function(r,o,e){return Promise.resolve().then(function(){return i.isTarget(o)?i.organize(o,r,e):e}).then(function(t){return s.organize("*",r,t)}).then(function(t){var n=Promise.resolve(e);return s._sortItems(r._organizers).forEach(function(e){r._organizers[e].object.isTarget(o,r._organizers[e],r)&&(n=n.then(function(t){return r._organizers[e].object.organize(o,r,t)}))}),n})},s._sortItems=function(n){return Object.keys(n).sort(function(t,e){return n[t].order-n[e].order})},s}(t),o=function(o){function s(){o.apply(this,arguments)}return o&&(s.__proto__=o),((s.prototype=Object.create(o&&o.prototype)).constructor=s).globalInit=function(){Object.defineProperty(a.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t}}),a.prototype.changeState=function(t){return s._changeState(this,t)},a.prototype.isInitialized=function(){return s._isInitialized(this)},a.prototype.waitFor=function(t,e){return s._waitFor(this,t,e)},a.prototype.suspend=function(t){return s._suspend(this,t)},s.__components=new u,s.__waitingList=new u,s.__waitingListIndexName=new Map,s.__waitingListIndexId=new Map,s.__waitingListIndexNone=[],a.prototype.resume=function(t){return s._resume(this,t)}},s.init=function(t,e){e._state="",s.__loadAttrSettings(e)},s.organize=function(t,e,n){var r=Promise.resolve(),o=n.waitFor;return o&&(r=s._waitFor(e,o)),r.then(function(){return n})},s.clear=function(){this.__waitingList.clear()},s.isTarget=function(t,e,n){var r=!1;return"beforeStart"==t?n instanceof BITSMIST.v1.Pad||(r=!0):r=o.isTarget.call(this,t,e,n),r},s._waitFor=function(n,r,o){var t;o=o||1e4;var i={waiter:n,waitlist:r.slice()};return s.__isAllReady(i)?t=Promise.resolve():(t=new Promise(function(t,e){i.resolve=t,i.reject=e,setTimeout(function(){e("waitFor() timed out after "+o+" milliseconds waiting for "+JSON.stringify(r)+", name="+n.name+".")},o)}),i.promise=t,s.__addToWaitingList(i,n)),t},s._waitForSingle=function(t,e,n){var r=s.__components.get(t.uniqueId),o={id:t.uniqueId,state:e};return s.__isReady(o,r)?Promise.resolve():s.waitFor(t,[o],n)},s._changeState=function(t,e){if(!s.__isTransitionable(t.state,e))throw Error("Illegal transition. name="+t.name+", fromState="+t.state+", toState="+e+", id="+t.id);t.state=e,s.__components.mergeSet(t.uniqueId,{object:t,state:e}),s.__processWaitingList(t,e)},s._suspend=function(t,e){var n={},r=new Promise(function(t,e){n.resolve=t,n.reject=e});return n.promise=r,t._suspend[e]=n,r},s._resume=function(t,e){t._suspend[e].resolve()},s._isInitialized=function(t){var e=!1;return t.state&&"starting"!=t.state&&"stopping"!=t.state&&"stopped"!=t.state&&(e=!0),e},s.__isTransitionable=function(t,e){var n=!0;return t&&"ing"==t.slice(-3)&&("stopping"==t&&"stopped"!=e||"starting"==t&&"started"!=e||"opening"==t&&"opened"!=e&&"opening"!=e||"closeing"==t&&"closed"!=e||"stopping"==t&&"stopped"!=e&&"closing"!=e)&&(n=!1),n},s.__processWaitingList=function(t,e){var n=s.__waitingListIndexName.get(t.name+"."+e);s.__processIndex(n);var r=s.__waitingListIndexId.get(t.uniqueId+"."+e);s.__processIndex(r),s.__processIndex(s.__waitingListIndexNone)},s.__processIndex=function(t){if(t)for(var e=0;e<t.length;e++){var n=t[e];n&&(s.__waitingList.get(n),s.__isAllReady(s.__waitingList.get(n))&&(s.__waitingList.get(n).resolve(),s.__waitingList.remove(n),t[e]=null))}},s.__addToWaitingList=function(t){var e=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16);s.__waitingList.set(e,t);for(var n=t.waitlist,r=0;r<n.length;r++)n[r].id?s.__addToIndex(s.__waitingListIndexId,n[r].id+"."+n[r].state,e):n[r].name?s.__addToIndex(s.__waitingListIndexName,n[r].name+"."+n[r].state,e):s.__waitingListIndexNone.push(e)},s.__addToIndex=function(t,e,n){t.get(e)||t.set(e,[]),t.get(e).push(n)},s.__getComponentInfo=function(e){var n,t;return e.id?n=s.__components.get(e.id):e.name?Object.keys(s.__components.items).forEach(function(t){e.name==s.__components.get(t).object.name&&(n=s.__components.get(t))}):!e.rootNode||(t=document.querySelector(e.rootNode))&&(n=s.__components.get(t.uniqueId)),n},s.__isAllReady=function(t){for(var e=!0,n=t.waitlist,r=0;r<n.length;r++){var o=!1,i=this.__getComponentInfo(n[r]);if(i&&s.__isReady(n[r],i)&&(o=!0),!o){e=!1;break}}return e},s.__isReady=function(t,e){return t.state=t.state||"opened",s.__isComponentMatch(e,t)&&s.__isStateMatch(e.state,t.state)},s.__isComponentMatch=function(t,e){var n=!0;return e.component&&t.object!==e.component&&(n=!1),e.name&&t.object.name!=e.name&&(n=!1),e.id&&t.object.uniqueId!=e.id&&(n=!1),e.rootNode&&!document.querySelector(e.rootNode)&&(n=!1),n},s.__isStateMatch=function(t,e){var n=!0;switch(e){case"started":"opening"!=t&&"opened"!=t&&"closing"!=t&&"closed"!=t&&"started"!=t&&(n=!1);break;default:t!=e&&(n=!1)}return n},s.__loadAttrSettings=function(t){var e,n;t.hasAttribute("data-waitfor")&&(e={name:t.getAttribute("data-waitfor"),state:"started"},t.settings.merge({waitFor:[e]})),t.hasAttribute("data-waitfornode")&&(n={rootNode:t.getAttribute("data-waitfornode"),state:"started"},t.settings.merge({waitFor:[n]}))},s}(t),s=function(t){function u(){t.apply(this,arguments)}return t&&(u.__proto__=t),((u.prototype=Object.create(t&&t.prototype)).constructor=u).globalInit=function(){a.prototype.addEventHandler=function(t,e,n,r,o){u._addEventHandler(this,t,e,n,r,o)},a.prototype.trigger=function(t,e,n,r){return u._trigger(this,t,e,n,r)},a.prototype.triggerSync=function(t,e,n,r){return u._triggerSync(this,t,e,n,r)},a.prototype.getEventHandler=function(t,e,n,r){return u._getEventHandler(this,t,e,n,r)}},u.organize=function(t,r,e){var o=e.events;return o&&Object.keys(o).forEach(function(t){for(var e=Array.isArray(o[t])?o[t]:[o[t]],n=0;n<e.length;n++)r.addEventHandler(r,t,e[n])}),e},u._addEventHandler=function(t,e,n,r,o,i){var s=u._getEventHandler(t,r,i);if("function"!=typeof s){var a=i?i.name:"";throw TypeError("Event handler is not a function. componentName="+t.name+", pluginName="+a+", eventName="+n)}e._bm_detail||(e._bm_detail={component:t,listeners:{},promises:{},statuses:{}});var c=e._bm_detail.listeners;c[n]||(c[n]=[],e.addEventListener(n,u.__callEventHandler)),c[n].push({handler:s,options:Object.assign({},o),bind:i,order:void 0});"object"==typeof r&&r.order&&r.order;c[n].sort(function(t,e){return t.order==e.order?0:t.order>e.order?1:-1})},u._trigger=function(t,e,n,r,o){(r=Object.assign({},r)).sender=n,o=o||t;var i=null;try{i=new CustomEvent(e,{detail:r})}catch(t){(i=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!1,r)}return o.dispatchEvent(i),l.safeGet(o,"_bm_detail.promises."+e)||Promise.resolve()},u._triggerSync=function(t,e,n,r,o){return(r=r||{}).async=!1,u._trigger.call(t,t,e,n,r,o)},u._getEventHandler=function(t,e,n){n=n||t;var r="object"==typeof e?e.handler:e;return"string"==typeof r&&(r=n?n[r]:t[r]),r=r&&r.bind(n)},u.__callEventHandler=function(e){var n=this,t=l.safeGet(this,"_bm_detail.listeners."+e.type),r=l.safeGet(e,"detail.sender",this),o=l.safeGet(this,"_bm_detail.component");if("handling"==l.safeGet(this,"_bm_detail.statuses."+e.type))throw new Error("Event handler is already running. name="+this.tagName+", eventName="+e.type);l.safeSet(this,"_bm_detail.statuses."+e.type,"handling"),l.safeGet(e,"detail.async",!0)?this._bm_detail.promises[e.type]=u.__handleAsync(e,r,o,t).then(function(t){return l.safeSet(n,"_bm_detail.promises."+e.type,null),l.safeSet(n,"_bm_detail.statuses."+e.type,""),t}):(this._bm_detail.promises[e.type]=u.__handleSync(e,r,o,t),l.safeSet(this,"_bm_detail.promises."+e.type,null),l.safeSet(this,"_bm_detail.statuses."+e.type,""))},u.__handleAsync=function(r,o,t,i){for(var s=Promise.resolve(),a=[],c=!1,e=0;e<i.length;e++)!function(e){var n={target:t,options:i[e].options?i[e].options:{}};s=s.then(function(t){return t&&a.push(t),i[e].handler(o,r,n)}),c=!(!i[e].options||!i[e].options.stopPropagation)||c}(e);return c&&r.stopPropagation(),s.then(function(t){return t&&a.push(t),a})},u.__handleSync=function(t,e,n,r){for(var o=!1,i=0;i<r.length;i++){var s={target:n,options:r[i].options?r[i].options:{}};r[i].handler(e,t,s),o=!(!r[i].options||!r[i].options.stopPropagation)||o}return o&&t.stopPropagation(),Promise.resolve()},u}(t),g=function(t){function i(){t.apply(this,arguments)}return t&&(i.__proto__=t),((i.prototype=Object.create(t&&t.prototype)).constructor=i).organize=function(t,e,n){var r={afterStart:i.onDoOrganize,afterAppend:i.onDoOrganize,afterSpecLoad:i.onDoOrganize,beforeOpen:i.onDoOrganize,afterOpen:i.onDoOrganize,beforeClose:i.onDoOrganize,afterClose:i.onDoOrganize,doRefresh:i.onDoOrganize},o=n.attrs;return o&&Object.keys(o).forEach(function(t){r[t]&&e.addEventHandler(e,t,r[t],{attrs:o[t]},e)}),n},i.onDoOrganize=function(t,e,n){var r=n.target,o=n.options.attrs;return i._initAttr(r,o)},i._initAttr=function(n,r){return r&&Object.keys(r).forEach(function(e){switch(e){case"style":Object.keys(r[e]).forEach(function(t){n.style[t]=r[e][t]});break;default:n.setAttribute(e,r[e])}}),Promise.resolve()},i}(t);function d(){return Reflect.construct(a,[],this.constructor)}c.inherit(d,a),customElements.define("bm-pad",d),d.prototype.open=function(n){var r=this,t=(n=Object.assign({},n)).sender?n.sender:this;return Promise.resolve().then(function(){return r.changeState("opening")}).then(function(){return r.switchTemplate(r._settings.get("settings.templateName"))}).then(function(){return r.trigger("beforeOpen",t,n)}).then(function(){var t=r._settings.get("settings.autoSetupOnOpen"),e=r._settings.get("settings.autoSetup");if(t||!1!==t&&e)return r.setup(n)}).then(function(){if(r._settings.get("settings.autoRefresh"))return r.refresh(n)}).then(function(){return r.trigger("doOpen",t,n)}).then(function(){return r.trigger("afterOpen",t,n)}).then(function(){return r.changeState("opened")})},d.prototype.openModal=function(n){var r=this;return new Promise(function(t,e){r._isModal=!0,r._modalResult={result:!1},r._modalPromise={resolve:t,reject:e},r.open(n)})},d.prototype.close=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.changeState("closing")}).then(function(){return e.trigger("beforeClose",n,t)}).then(function(){return e.trigger("doClose",n,t)}).then(function(){return e.trigger("afterClose",n,t)}).then(function(){e._isModal&&e._modalPromise.resolve(e._modalResult)}).then(function(){return e.changeState("closed")})},d.prototype.refresh=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.trigger("beforeRefresh",n,t)}).then(function(){if(e._settings.get("settings.autoFill"))return e.fill(t)}).then(function(){return e.trigger("doRefresh",n,t)}).then(function(){return e.trigger("afterRefresh",n,t)}).then(function(){})},d.prototype.switchTemplate=function(t,e){var n=this,r=(e=Object.assign({},e)).sender?e.sender:this;return this.isActiveTemplate(t)?Promise.resolve():Promise.resolve().then(function(){return n.addTemplate(t,{rootNode:n._settings.get("settings.rootNode"),templateNode:n._settings.get("settings.templateNode")})}).then(function(){var t=l.concatPath([n._settings.get("system.appBaseUrl",""),n._settings.get("system.componentPath","")]),e=n._settings.get("system.splitComponent",!1);return n.loadTags(n,t,{splitComponent:e})}).then(function(){return n.callOrganizers("afterAppend",n._settings.items)}).then(function(){return n.trigger("afterAppend",r,e)}).then(function(){})},d.prototype.fill=function(t){},d.prototype.start=function(e){var n=this;return e=l.deepMerge({settings:{autoSetupOnStart:!1},organizers:{TemplateOrganizer:""}},e),Promise.resolve().then(function(){return a.prototype.start.call(n,e)}).then(function(t){if(e=t,n._settings.get("settings.autoOpen"))return n.open(e)})};var p=function(o){function i(){o.apply(this,arguments)}return o&&(i.__proto__=o),((i.prototype=Object.create(o&&o.prototype)).constructor=i).globalInit=function(){d.prototype.addTemplate=function(t,e){return i._addTemplate(this,t,e)},d.prototype.cloneTemplate=function(t){return i._clone(this,t)},d.prototype.isActiveTemplate=function(t){return i._isActive(this,t)}},i.init=function(t,e){e._templates={},e.settings.set("settings.templateName",e.settings.get("settings.templateName",e.tagName.toLowerCase())),e.settings.set("settings.autoOpen",e.settings.get("settings.autoOpen",!0)),e.settings.set("settings.autoClose",e.settings.get("settings.autoClose",!0)),i.__loadAttrSettings(e)},i.organize=function(t,e,n){var r=n.templates;return r&&Object.keys(r).forEach(function(t){i.__getTemplateInfo(e,t).html=r[t]}),n},i.clear=function(t){t._templates={}},i.isTarget=function(t,e,n){var r=!1;return n instanceof BITSMIST.v1.Pad&&(r=o.isTarget.call(this,t,e,n)),r},i._isActive=function(t,e){var n=!1;return i.__getTemplateInfo(t,e).isAppended&&(n=!0),n},i._addTemplate=function(e,t){var n=i.__getTemplateInfo(e,t);if(n.isAppended)throw new ReferenceError("Template already appended. name="+e.name+", templateName="+t);return Promise.resolve().then(function(){var t=l.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.templatePath",""),e.settings.get("settings.path","")]);return i._loadTemplate(e,n,t)}).then(function(){return e.settings.get("settings.templateNode")&&i.__storeTemplateNode(e,n,e.settings.get("settings.templateNode")),i.__applyTemplate(e,n)}).then(function(){e._templates[e.settings.get("settings.templateName")]&&(e._templates[e.settings.get("settings.templateName")].isAppended=!1),e._templates[t].isAppended=!0,e.settings.set("settings.templateName",t)})},i._loadTemplate=function(t,e,n){return i.__autoLoadTemplate(t,e,n)},i._clone=function(t,e){e=e||t._settings.get("settings.templateName");var n,r=t._templates[e];if(!r)throw new ReferenceError("Template not loaded. name="+t.name+", templateName="+e);return r.node?document.importNode(r.node,!0):((n=document.createElement("div")).innerHTML=r.html,n.firstElementChild)},i.__autoLoadTemplate=function(t,e,n){var r,o;return e.html||e.node||(r=l.concatPath([n,e.name+".html"]),o=i.__loadTemplateFile(r).then(function(t){e.html=t})),Promise.all([o]).then(function(){if(!e.isLoaded)return t.trigger("afterLoadTemplate",t)}).then(function(){e.isLoaded=!0})},i.__loadTemplateFile=function(t){return f.ajaxRequest({url:t,method:"GET"}).then(function(t){return t.responseText})},i.__getTemplateInfo=function(t,e){return t._templates[e]||(t._templates[e]={},t._templates[e].name=e,t._templates[e].html="",t._templates[e].isAppended=!1,t._templates[e].isLoaded=!1),t._templates[e]},i.__storeTemplateNode=function(t,e,n){var r=document.querySelector(n);if(!r)throw new ReferenceError("Root node does not exist. name="+t.name+", rootNode="+n+", templateName="+e.name);r.insertAdjacentHTML("afterbegin",e.html);var o=r.children[0];e.node="content"in o?o.content:o},i.__applyTemplate=function(t,e){var n;e.node?(n=i.clone(t,e.name),t.insertBefore(n,t.firstChild)):t.innerHTML=e.html},i.__loadAttrSettings=function(){},i}(t),_=function(o){function p(){o.apply(this,arguments)}return o&&(p.__proto__=o),((p.prototype=Object.create(o&&o.prototype)).constructor=p).globalInit=function(){d.prototype.loadTags=function(t,e,n,r){return p._loadTags(this,t,e,n,r)},p.__classes=new u},p.init=function(t,e){Object.defineProperty(e,"components",{get:function(){return this._components}}),e.addComponent=function(t,e,n){return p._addComponent(this,t,e,n)},e._components={}},p.organize=function(t,e,n){var r=Promise.resolve(),o=n.molds;o&&Object.keys(o).forEach(function(t){r=r.then(function(){return p._addComponent(e,t,o[t],"opened")})});var i=n.components;return i&&Object.keys(i).forEach(function(t){r=r.then(function(){return p._addComponent(e,t,i[t])})}),r.then(function(){return n})},p.clear=function(e){Object.keys(e.components).forEach(function(t){e.components[t].parentNode.removeChild(e._components[t])}),e._components={}},p.isTarget=function(t,e,n){var r=!1;return"beforeStart"==t?n instanceof BITSMIST.v1.Pad||(r=!0):r=o.isTarget.call(this,t,e,n),r},p._addComponent=function(n,r,o,i){var e=l.concatPath([n.settings.get("system.appBaseUrl",""),n.settings.get("system.componentPath",""),l.safeGet(o,"settings.path","")]),s=l.safeGet(o,"settings.className")||r,a=l.safeGet(o,"settings.tagName")||l.getTagNameFromClassName(s||r);return Promise.resolve().then(function(){var t=l.safeGet(o,"settings.autoLoad",n.settings.get("system.autoLoad",!0));return p._loadComponent(n,s,e,o,a,t)}).then(function(){l.safeGet(o,"settings.rootNode")&&!n.components[r]&&(n.components[r]=p.__insertTag(n,a,o))}).then(function(){var t,e=l.safeGet(o,"settings.expose");e&&(t=!0===e?r:e,Object.defineProperty(n.__proto__,t,{get:function(){return this.components[r]}}))}).then(function(){if(i||l.safeGet(o,"settings.sync")){var t=!0===(i=i||l.safeGet(o,"settings.sync"))?"started":i,e=s.split(".");return n.waitFor([{name:e[e.length-1],state:t}])}})},p._loadTags=function(a,t,c,u,e){var g=[];return(e?document.querySelectorAll(e):t.querySelectorAll("[data-autoload],[data-automorph]")).forEach(function(t){var e,n,r,o,i,s;t.getAttribute("href")?(e=t.getAttribute("href"),g.push(f.loadScript(e))):(n=t.hasAttribute("data-path")?t.getAttribute("data-path"):"",r=t.hasAttribute("data-classname")?t.getAttribute("data-classname"):l.getClassNameFromTagName(t.tagName),o=!!t.hasAttribute("data-split")||u.splitComponent,i=!!t.hasAttribute("data-automorph")&&(!t.getAttribute("data-automorph")||t.getAttribute("data-automorph")),(s={}).settings=u?Object.assign({},u):{},s.settings.splitComponent=o,s.settings.morph=i,g.push(p._loadComponent(a,r,l.concatPath([c,n]),s,t.tagName,!0))),t.removeAttribute("data-autoload"),t.removeAttribute("data-automorph")}),Promise.all(g)},p._loadComponent=function(t,e,n,r,o,i){var s=l.safeGet(r,"settings.morph");if(s){var a=!0===s?BITSMIST.v1.Pad:c.getClass(s);customElements.get(o.toLowerCase())||c.newComponent(a,r,o)}else if(i)return p.__autoloadComponent(t,e,n,r)},p.__isLoadedClass=function(t){var e=!1;return"loaded"!=p.__classes.get(t,{}).state&&!c.getClass(t)||(e=!0),e},p.__autoloadComponent=function(t,e,n,r){var o,i,s=l.safeGet(r,"settings.tagName")||l.getTagNameFromClassName(e);return p.__isLoadedClass(e)||customElements.get(s)?(p.__classes.mergeSet(e,{state:"loaded"}),i=Promise.resolve()):"loading"==p.__classes.get(e,{}).state?i=p.__classes.get(e).promise:(p.__classes.mergeSet(e,{state:"loading"}),o=l.safeGet(r,"settings.splitComponent",t.settings.get("system.splitComponent",!1)),i=p.__loadComponentScript(s,n,{splitComponent:o}).then(function(){p.__classes.mergeSet(e,{state:"loaded",promise:null})}),p.__classes.mergeSet(e,{promise:i})),i},p.__loadComponentScript=function(t,e,n){var r=l.concatPath([e,t+".js"]),o=l.concatPath([e,t+".settings.js"]);return Promise.resolve().then(function(){return f.loadScript(r)}).then(function(){if(l.safeGet(n,"splitComponent"))return f.loadScript(o)}).then(function(){})},p.__insertTag=function(t,e,n){var r=t._rootElement.querySelector(l.safeGet(n,"settings.rootNode"));if(!r)throw new ReferenceError("Root node does not exist. name="+t.name+", tagName="+e+", rootNode="+l.safeGet(n,"settings.rootNode"));var o,i=l.safeGet(n,"tag")?l.safeGet(n,"tag"):"<"+e+"></"+e+">";return(o=l.safeGet(n,"overwrite")?(r.outerHTML=i,r):(r.insertAdjacentHTML("afterbegin",i),r.children[0]))._injectSettings=function(t){var e=o._super.prototype._injectSettings?Object.assign({},o._super.prototype._injectSettings.call(this,t)):{};return l.deepMerge(e,n)},o},p}(t),m=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),((r.prototype=Object.create(t&&t.prototype)).constructor=r).organize=function(t,e,n){return"loading"!==document.readyState?r.onDOMContentLoaded.call(e,e):document.addEventListener("DOMContentLoaded",function(){r.onDOMContentLoaded.call(e,e)}),n},r.onDOMContentLoaded=function(t){var e=l.concatPath([t.settings.get("system.appBaseUrl",""),t.settings.get("system.componentPath","")]),n=t.settings.get("system.splitComponent",!1),r=t.getAttribute("data-target");_._loadTags(t,document,e,{splitComponent:n},r)},r}(t),h=function(t){function r(){t.apply(this,arguments)}return t&&(r.__proto__=t),((r.prototype=Object.create(t&&t.prototype)).constructor=r).globalInit=function(){a.prototype.initElements=function(t,e,n){r._initElements(this,t,e,n)}},r.organize=function(t,e,n){var r=n.elements;return r&&Object.keys(r).forEach(function(t){e.initElements(t)}),n},r._initElements=function(t,e,n,r){r=r||t.rootElement;var o=t.settings.get("elements."+e),i=o.rootNode?r.querySelectorAll(o.rootNode):r.querySelectorAll("#"+e);this.__initEvents(t,i,o.events,n)},r.__initEvents=function(n,r,o,i){for(var t=0;t<r.length;t++)!function(e){Object.keys(o).forEach(function(t){i=Object.assign({},o[t].options,i),n.addEventHandler(r[e],t,o[t],i)})}(t)},r}(t),y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.notify=function(e,n){for(var r=this,o=[],t=arguments.length-2;0<t--;)o[t]=arguments[t+2];var i=Promise.resolve();return this._sortItems().forEach(function(t){i=i.then(function(){return r._callHandler.apply(r,[e,n,r._items[t]].concat(o))})}),i},e.prototype.notifySync=function(e,n){for(var r=this,o=[],t=arguments.length-2;0<t--;)o[t]=arguments[t+2];this._sortItems().forEach(function(t){r._callHandler.apply(r,[e,n,r._items[t]].concat(o))})},e.prototype._callHandler=function(t,e,n){for(var r,o,i=[],s=arguments.length-3;0<s--;)i[s]=arguments[s+3];if((r=this)._filter.apply(r,[e,n].concat(i))&&"function"==typeof n.object[t])return(o=n.object[t]).call.apply(o,[n.object,e].concat(i))},e.prototype._sortItems=function(){var n=this;return Object.keys(this._items).sort(function(t,e){return n._items[t].order-n.items[e].order})},e}(u);function v(){return Reflect.construct(a,[],this.constructor)}c.inherit(v,a),customElements.define("bm-tagloader",v),v.prototype.start=function(t){return t=BITSMIST.v1.Util.deepMerge({settings:{name:"TagLoader",autoSetup:!1},organizers:{AutoloadOrganizer:""}},t),BITSMIST.v1.Component.prototype.start.call(this,t)},window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.Component=a,window.BITSMIST.v1.Organizer=t,(window.BITSMIST.v1.OrganizerOrganizer=r).globalInit(),(window.BITSMIST.v1.SettingOrganizer=i).globalInit(),r.organizers.set("StateOrganizer",{object:o,targetWords:"waitFor",targetEvents:["afterAppend"],order:200}),window.BITSMIST.v1.StateOrganizer=o,r.organizers.set("EventOrganizer",{object:s,targetWords:"events",targetEvents:["beforeStart"],order:300}),window.BITSMIST.v1.EventOrganizer=s,r.organizers.set("AttrOrganizer",{object:g,targetWords:"attrs",targetEvents:["beforeStart"],order:600}),window.BITSMIST.v1.AttrOrganizer=g,r.organizers.set("TemplateOrganizer",{object:p,targetWords:"templates",targetEvents:["beforeStart"],order:600}),window.BITSMIST.v1.TemplateOrganizer=p,r.organizers.set("AutoloadOrganizer",{object:m,targetWords:"autoloads",targetEvents:["beforeStart"],order:700}),window.BITSMIST.v1.AutoloadOrganizer=m,r.organizers.set("ElementOrganizer",{object:h,targetWords:"elements",targetEvents:["afterAppend"],order:700}),window.BITSMIST.v1.ElementOrganizer=h,r.organizers.set("ComponentOrganizer",{object:_,targetWords:"components",targetEvents:["afterAppend"],order:800}),window.BITSMIST.v1.ComponentOrganizer=_,window.BITSMIST.v1.Pad=d,window.BITSMIST.v1.Store=u,window.BITSMIST.v1.ObserverStore=y,window.BITSMIST.v1.TagLoader=v,window.BITSMIST.v1.AjaxUtil=f,window.BITSMIST.v1.ClassUtil=c,window.BITSMIST.v1.Util=l}();
