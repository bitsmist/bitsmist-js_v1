!function(){"use strict";class e{static safeGet(e,t,s){let r=e,n=!0,a=t.split(".");for(let e=0;e<a.length;e++){if(null===r||"object"!=typeof r||!(a[e]in r)){n=!1;break}r=r[a[e]]}return n?r:s}static safeSet(t,s,r){let n=s.split("."),a=e.__createIntermediateObject(t,n);return e.assert(null!==a&&"object"==typeof a,`Util.safeSet(): Can't create an intermediate object. Non-object value already exists. key=${s}, existingKey=${n.length>1?n[n.length-2]:""}, existingValue=${a}`,TypeError),a[n[n.length-1]]=r,t}static safeRemove(e,t){let s=!0,r=e,n=t.split(".");for(let e=0;e<n.length-1;e++){if(!(n[e]in r)){s=!1;break}r=r[n[e]]}return s&&delete r[n[n.length-1]],e}static safeMerge(t,s,r){let n=s.split("."),a=e.__createIntermediateObject(t,n);e.assert(a&&"object"==typeof a,`Util.safeSet(): Can't create an intermediate object. Non-object value already exists. key=${s}, existingKey=${n.length>1?n[n.length-2]:""}, existingValue=${a}`,TypeError);let i=n[n.length-1];return a[i]=e.deepMerge(a[i],r),t}static safeHas(e,t){let s=e,r=!0,n=t.split(".");for(let e=0;e<n.length;e++){if(!s||"object"!=typeof s||!(n[e]in s)){r=!1;break}s=s[n[e]]}return r}static safeEval(e,t,s){let r,n=[];s&&(r=Object.keys(s).join(","),Object.keys(s).forEach((e=>{n.push(s[e])})));let a=!1;try{a=Function(r,'"use strict";return ('+e+")").apply(t,n)}catch(e){}return a}static concatPath(e){let t=e[0]||"";for(let s=1;s<e.length;s++)e[s]&&("/"===t.slice(t.length-1)&&"/"===e[s].slice(0,1)?t+=e[s].slice(1):"/"===t.slice(t.length-1)||"/"===e[s].slice(0,1)?t+=e[s]:t?t+="/"+e[s]:t=e[s]);return t}static deepMerge(t,s){let r=t;return Array.isArray(t)?Array.isArray(s)?Array.prototype.push.apply(r,e.__cloneArr(s)):r.push(e.deepClone(s)):e.__isObject(t)&&e.__isMergeable(s)?Object.keys(s).forEach((n=>{r[n]=e.deepMerge(t[n],s[n])})):void 0===s||(r=e.deepClone(s)),r}static deepClone(t){return Array.isArray(t)?e.__cloneArr(t):e.__isObject(t)?e.__cloneObj(t):t}static getClassNameFromTagName(e){let t=e.split("-");return t[0].charAt(0).toUpperCase()+t[0].slice(1).toLowerCase()+t[1].charAt(0).toUpperCase()+t[1].slice(1).toLowerCase()}static getTagNameFromClassName(t){let s,r=t,n=t.split("."),a=n[n.length-1];for(s=1;s<a.length&&!e.__isUpper(a.substring(s,s+1));s++);return s<a.length&&(r=a.substring(0,s).toLowerCase()+"-"+a.substring(s).toLowerCase()),r}static parseURL(e){var t=RegExp("^(([^:/?#]+):)?(//([^/?#]*))?([^?#]*)(\\?([^#]*))?(#(.*))?"),s=e.match(t);let r={protocol:s[2],hostname:s[4],pathname:s[5],path:"",filename:"",filenameWithoutExtension:"",extension:"",query:s[7],hash:s[8]};r.path=(r.protocol?r.protocol+"://":"")+(r.hostname?r.hostname:"");let n=s[5].lastIndexOf("/");n>-1?(r.path+=s[5].substr(0,n+1),r.filename=s[5].substr(n+1)):r.filename=s[5];let a=r.filename.lastIndexOf(".");return a?(r.filenameWithoutExtension=r.filename.substr(0,a),r.extension=r.filename.substr(a+1)):r.filenameWithoutExtension=r.filename,r}static assert(e,t,s,r){if(!e){let e=new(s=s||Error)(t),r=e.stack.split("\n");throw r.splice(1,1),e.stack=r.join("\n"),e}}static warn(e,t,s,r){let n=!0;return e||(s=s||"warn",n=!1),n}static randomWait(e,t){let s=t?e:Math.floor(Math.random()*e);return new Promise(((e,t)=>{setTimeout((()=>{e()}),s)}))}static scopedSelectorAll(e,t){let s=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16);e.setAttribute("__bm_tempid",s);let r="[__bm_tempid='"+s+"'] ",n=r+t.replace(",",","+r),a=e.querySelectorAll(n),i=r+"[bm-powered] "+t.replace(",",", "+r+"[bm-powered] "),o=e.querySelectorAll(i),l=new Set(a);return new Set(o).forEach((e=>{l.delete(e)})),e.removeAttribute("__bm_tempid"),Array.from(l)}static __isUpper(e){return e===e.toUpperCase()&&e!==e.toLowerCase()}static __createIntermediateObject(t,s){let r=t;for(let t=0;t<s.length-1;t++)e.assert(null!==r&&"object"==typeof r,`Util.safeSet(): Can't create an intermediate object. Non-object value already exists. existingKey=${t>0?s[t-1]:""}, existingValue=${r}`,TypeError),s[t]in r||(r[s[t]]={}),r=r[s[t]];return r}static __cloneObj(t){let s={};return Object.keys(t).forEach((r=>{s[r]=e.deepClone(t[r])})),s}static __cloneArr(t){let s=[];for(let r=0;r<t.length;r++)s.push(e.deepClone(t[r]));return s}static __isObject(e){let t=typeof e,s=e&&e.constructor&&e.constructor.name;return null!==e&&"Object"===s&&"function"!==t}static __isMergeable(t){return e.__isObject(t)||Array.isArray(t)}}class t{static newComponent(s,r,n,a){n=n||BITSMIST.v1.Component;let i=Function("superClass","return function "+t.__validateClassName(s)+"(){ return Reflect.construct(superClass, [], this.constructor); }")(n);return t.inherit(i,n),(r=e.deepMerge({},r)).settings=r.settings?r.settings:{},r.settings.name=s,i.prototype._getSettings=function(){return e.deepMerge(n.prototype._getSettings(),r)},window[s]=i,a&&customElements.define(a.toLowerCase(),i),i}static inherit(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e}static createObject(s,...r){let n=t.getClass(s);return e.assert(n,`ClassUtil.createObject(): Class '${s}' is not defined.`,ReferenceError),new n(...r)}static getClass(e){let s;try{s=Function("return ("+t.__validateClassName(e)+")")()}catch(e){if(!(e instanceof ReferenceError))throw e}return s}static __validateClassName(t){let s=/^[a-zA-Z0-9\-\._]+$/.test(t);return e.assert(s,`ClassUtil.__validateClassName(): Class name '${t}' is not valid.`,TypeError),t}}class s{static globalInit(e){}static init(e,t,s){}static organize(e,t,s){}static unorganize(e,t,s){}static clear(e){}static isTarget(e,t,s){return t.targetEvents.indexOf("*")>-1||t.targetEvents.indexOf(e)>-1}static getEditor(){return""}}class r extends s{static globalInit(e){Object.defineProperty(e.prototype,"organizers",{get(){return this._organizers}}),e.prototype.addOrganizers=function(e){return r._addOrganizers(this,e)},e.prototype.initOrganizers=function(e){return r._initOrganizers(this,e)},e.prototype.callOrganizers=function(e,t){return r._callOrganizers(this,e,t)},e.prototype.clearOrganizers=function(e,t){return r._clearOrganizers(this,e,t)},r._organizers={},r._targetWords={},Object.defineProperty(r,"organizers",{get:()=>r._organizers})}static organize(e,t,s){return r._addOrganizers(t,s)}static clear(e){e._organizers={}}static register(t,s){let n=e.deepMerge({},s);n.name=s.name?s.name:t,n.targetWords=s.targetWords?s.targetWords:[],n.targetWords=Array.isArray(s.targetWords)?s.targetWords:[s.targetWords],n.targetEvents=s.targetEvents?s.targetEvents:[],n.targetEvents=Array.isArray(s.targetEvents)?s.targetEvents:[s.targetEvents],r._organizers[t]=n,n.object.globalInit(n.targetClassName);for(let e=0;e<n.targetWords.length;e++)r._targetWords[n.targetWords[e]]=n}static _addOrganizers(t,s){let n={},a=Promise.resolve(),i=s.organizers;return i&&Object.keys(i).forEach((s=>{e.safeGet(i[s],"settings.attach")&&!t._organizers[s]&&r._organizers[s]&&(n[s]=r._organizers[s])})),Object.keys(s).forEach((e=>{let s=r._targetWords[e];s&&(t._organizers[s.name]||(n[s.name]=s.object))})),r._sortItems(n).forEach((n=>{a=a.then((()=>(t._organizers[n]=e.deepMerge(e.deepClone(r._organizers[n]),e.safeGet(s,"organizers."+n)),t._organizers[n].object.init(t,s))))})),a}static _initOrganizers(e,t){return e._organizers={},r.organize("*",e,t)}static _callOrganizers(e,t,s){let n=Promise.resolve();return r._sortItems(e._organizers).forEach((r=>{e._organizers[r].object.isTarget(t,e._organizers[r],e)&&(n=n.then((()=>e._organizers[r].object.organize(t,e,s))))})),n}static _clearOrganizers(e,t,s){let n=Promise.resolve();return r._sortItems(e._organizers).forEach((r=>{e._organizers[r].object.isTarget(t,e._organizers[r],e)&&(n=n.then((()=>e._organizers[r].object.unorganize(t,e,s))))})),n}static _sortItems(e){return Object.keys(e).sort(((t,s)=>e[t].order-e[s].order))}}class n{static ajaxRequest(t){return new Promise(((s,r)=>{let n=e.safeGet(t,"url"),a=e.safeGet(t,"method"),i=e.safeGet(t,"data",""),o=e.safeGet(t,"headers"),l=e.safeGet(t,"options"),g=new XMLHttpRequest;g.open(a,n,!0),l&&Object.keys(l).forEach((e=>{g[e]=l[e]})),o&&Object.keys(o).forEach((e=>{g.setRequestHeader(e,o[e])})),g.addEventListener("load",(()=>{200===g.status||201===g.status?s(g):r(g)})),g.addEventListener("error",(()=>{r(g)})),g.send(i)}))}static loadScript(e){return new Promise(((t,s)=>{let r=document.createElement("script");r.src=e,r.async=!0,r.onload=()=>{t()},r.onerror=e=>{s(e)},document.getElementsByTagName("head")[0].appendChild(r)}))}}class a{constructor(t){this.options=t||{},this.items=e.safeGet(t,"items",{}),this.merger=e.safeGet(t,"merger",e.deepMerge)}get options(){return this._options}set options(t){this._options=e.deepMerge({},t)}get items(){return this.clone()}set items(t){this._items=e.deepMerge({},t)}get merger(){this._merger}set merger(t){e.assert("function"==typeof t,`Store.merger(setter): Merger is not a function. merger=${t}`,TypeError),this._merger=t}clear(){this._items={}}clone(){return e.deepMerge({},this._items)}merge(e,t){t=t||this._merger;let s=Array.isArray(e)?e:[e];for(let e=0;e<s.length;e++)this._items=t(this._items,s[e])}get(t,s){return e.safeGet(this._items,t,s)}set(t,s,r){if(r&&r.merge)return e.safeMerge(this._items,t,defaultValue);e.safeSet(this._items,t,s)}remove(t){e.safeRemove(this._items,t)}has(t){return e.safeHas(this._items,t)}}class i extends a{constructor(t){super(t),this._chain;let s=e.safeGet(this._options,"chain");s&&this.chain(s)}get localItems(){return a.prototype.clone.call(this)}clone(){return this._chain?e.deepMerge(this._chain.clone(),this._items):a.prototype.clone.call(this)}chain(t){e.assert(t instanceof i,'ChainableStore.chain(): "store" parameter must be a ChainableStore.',TypeError),this._chain=t}get(e,t){let s=t;return a.prototype.has.call(this,e)?s=a.prototype.get.call(this,e,t):this._chain&&(s=this._chain.get(e,t)),s}merge(e,t){this._options.writeThrough?this._chain.merge(e,t):a.prototype.merge.call(this,e,t)}set(t,s,r){e.safeGet(r,"writeThrough",this._options.writeThrough)?this._chain.set(t,s,r):a.prototype.set.call(this,t,s,r)}has(t){let s=e.safeHas(this._items,t);return!1===s&&this._chain&&(s=e.safeHas(this._chain._items,t)),s}}class o extends s{static globalInit(e){Object.defineProperty(e.prototype,"settings",{get(){return this._settings}}),o.__globalSettings=new i,Object.defineProperty(o,"globalSettings",{get:()=>o.__globalSettings})}static init(e,t){return e._settings=new i({items:t}),e._settings.merge(e._getSettings()),e._settings.get("settings.useGlobalSettings")&&e._settings.chain(o.globalSettings),Promise.resolve().then((()=>o._loadExternalSetting(e,"setting"))).then((()=>{o._loadAttrSettings(e)}))}static _loadExternalSetting(t,s){let r,n={};if(t.hasAttribute("bm-"+s+"ref")){let a=e.parseURL(t.getAttribute("bm-"+s+"ref"));r=a.filenameWithoutExtension,n.path=a.path,n.query=a.query}else{let e=t.hasAttribute("bm-"+s+"path")?t.getAttribute("bm-"+s+"path"):"";r=t.hasAttribute("bm-"+s+"name")?t.getAttribute("bm-"+s+"name"):"",e&&!r&&(r="settings"),n.path=e}if(r||n.path)return t.loadSetting(r,n)}static _loadAttrSettings(e){let t=document.querySelector(e._settings.get("settings.rootNode"))?document.querySelector(e._settings.get("settings.rootNode")).getAttribute("bm-settings"):e.getAttribute("bm-settings");if(t){let s={settings:JSON.parse(t)};e._settings.merge(s)}}}function l(){return Reflect.construct(HTMLElement,[],this.constructor)}t.inherit(l,HTMLElement),l.prototype.connectedCallback=function(){this._ready||(this._ready=Promise.resolve(),this.setAttribute("bm-powered",""),this._uniqueId=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16),this._name=this.constructor.name),this._ready=this._ready.then((()=>this.changeState("connected"))).then((()=>!this._initialized||this.settings.get("settings.autoRestart")?(this._initialized=!0,this.start()):this.changeState("ready")))},l.prototype.disconnectedCallback=function(){this._ready=this._ready.then((()=>{if(this.settings.get("settings.autoStop"))return this.stop()})).then((()=>this.changeState("disconnected")))},l.prototype.adoptedCallback=function(){},l.prototype.attributeChangedCallback=function(){},Object.defineProperty(l.prototype,"name",{get(){return this._name}}),Object.defineProperty(l.prototype,"uniqueId",{get(){return this._uniqueId}}),Object.defineProperty(l.prototype,"rootElement",{get(){return this._rootElement}}),l.prototype.start=function(t){return t=e.deepMerge({settings:{autoFetch:!0,autoFill:!0,autoRefresh:!0,autoRestart:!1,autoSetup:!0,autoStop:!0,hasTemplate:!0,useGlobalSettings:!0},organizers:{OrganizerOrganizer:{settings:{attach:!0}},SettingOrganizer:{settings:{attach:!0}},StateOrganizer:{settings:{attach:!0}},EventOrganizer:{settings:{attach:!0}},LoaderOrganizer:{settings:{attach:!0}},TemplateOrganizer:{settings:{attach:!0}}}},t),Promise.resolve().then((()=>this._injectSettings(t))).then((e=>o.init(this,e))).then((()=>(this._name=this.settings.get("settings.name",this._name),this._rootElement=this.settings.get("settings.rootElement",this),this.initOrganizers(this.settings.items)))).then((()=>this.changeState("starting"))).then((()=>this.callOrganizers("beforeStart",this.settings.items))).then((()=>this.trigger("beforeStart"))).then((()=>this.switchTemplate(this.settings.get("settings.templateName")))).then((()=>{if(this.settings.get("settings.autoRefresh"))return this.refresh()})).then((()=>this.trigger("doStart"))).then((()=>this.changeState("started"))).then((()=>this.callOrganizers("afterStart",this.settings.items))).then((()=>this.trigger("afterStart"))).then((()=>this.changeState("ready")))},l.prototype.stop=function(t){return t=e.deepMerge({},t),Promise.resolve().then((()=>this.changeState("stopping"))).then((()=>this.trigger("beforeStop",t))).then((()=>this.trigger("doStop",t))).then((()=>this.changeState("stopped"))).then((()=>this.trigger("afterStop",t)))},l.prototype.switchTemplate=function(t,s){return s=e.deepMerge({},s),this.activeTemplateName===t?Promise.resolve():Promise.resolve().then((()=>{if(this.settings.get("settings.hasTemplate"))return Promise.resolve().then((()=>this.addTemplate(t))).then((()=>this.applyTemplate(t))).then((()=>{}))})).then((()=>{if(this.settings.get("settings.autoSetup"))return this.setup(this.settings.items)})).then((()=>this.loadTags(this.rootElement))).then((()=>this.callOrganizers("afterAppend",this.settings.items))).then((()=>this.trigger("afterAppend",s)))},l.prototype.setup=function(t){return t=e.deepMerge({},t),Promise.resolve().then((()=>this.trigger("beforeSetup",t))).then((()=>this.trigger("doSetup",t))).then((()=>this.trigger("afterSetup",t))).then((()=>{}))},l.prototype.refresh=function(t){return t=e.deepMerge({},t),Promise.resolve().then((()=>this.trigger("beforeRefresh",t))).then((()=>this.trigger("doTarget",t))).then((()=>{if(e.safeGet(t,"autoFetch",this.settings.get("settings.autoFetch")))return this.fetch(t)})).then((()=>{if(e.safeGet(t,"autoFill",this.settings.get("settings.autoFill")))return this.fill(t)})).then((()=>this.trigger("doRefresh",t))).then((()=>this.trigger("afterRefresh",t))).then((()=>{}))},l.prototype.fetch=function(t){return t=e.deepMerge({},t),Promise.resolve().then((()=>this.trigger("beforeFetch",t))).then((()=>this.callOrganizers("doFetch",t))).then((()=>this.trigger("doFetch",t))).then((()=>this.trigger("afterFetch",t))).then((()=>{}))},l.prototype.fill=function(t){return t=e.deepMerge({},t),Promise.resolve().then((()=>this.trigger("beforeFill",t))).then((()=>this.trigger("doFill",t))).then((()=>this.trigger("afterFill",t)))},l.prototype.clear=function(e){},l.prototype.scopedSelectorAll=function(t){return e.scopedSelectorAll(this,t)},l.prototype._injectSettings=function(e){return e},l.prototype._getSettings=function(){return{}},customElements.define("bm-component",l);class g extends s{static globalInit(){Object.defineProperty(l.prototype,"state",{get(){return this._state},set(e){this._state=e}}),l.prototype.changeState=function(e){return g._changeState(this,e)},l.prototype.waitFor=function(e,t){return g._waitFor(this,e,t)},l.prototype.suspend=function(e){return g._suspend(this,e)},l.prototype.resume=function(e){return g._resume(this,e)},l.prototype.pause=function(e){return g._pause(this,e)},g.__suspends={},g.__components=new a,g.__waitingList=new a,g.__waitingListIndexName=new Map,g.__waitingListIndexId=new Map,g.__waitingListIndexNone=new Map,g.waitFor=function(e,t){return g._waitFor(null,e,t)}}static init(e,t){e._state="",e._suspends={},g.__loadAttrSettings(e)}static organize(e,t,s){let r=Promise.resolve(),n=s.waitFor;return n&&n[e]&&(r=g._waitFor(t,n[e])),r}static clear(){this.__waitingList.clear()}static globalSuspend(e){g.__suspends[e]=g._createSuspendInfo(e),g.__suspends[e].state="pending"}static globalResume(e){g.__suspends[e].resolve(),g.__suspends[e].state="resolved"}static _waitFor(e,t,s){let r,n=s&&s.timeout||BITSMIST.v1.settings.get("system.waitForTimeout",1e4),a={waiter:s&&s.waiter?s.waiter:e,waitlist:t.slice()};return g.__isAllReady(a)?r=Promise.resolve():(r=new Promise(((s,r)=>{a.resolve=s,a.reject=r,setTimeout((()=>{let s=e&&e.name||a.waiter&&a.waiter.tagName||"";r(`StateOrganizer._waitFor(): Timed out after ${n} milliseconds waiting for ${g.__dumpWaitlist(t)}, name=${s}.`)}),n)})),a.promise=r,g.__addToWaitingList(a,e)),r}static _waitForSingle(e,t,s){let r=g.__components.get(e.uniqueId),n={id:e.uniqueId,state:t};return g.__isReady(n,r)?Promise.resolve():g.waitFor(e,[n],s)}static _changeState(t,s){e.assert(g.__isTransitionable(t._state,s),`StateOrganizer._changeState(): Illegal transition. name=${t.name}, fromState=${t._state}, toState=${s}, id=${t.id}`,Error),t._state=s,g.__components.set(t.uniqueId,{object:t,state:s}),g.__processWaitingList(t,s)}static _suspend(e,t){e._suspends[t]=g._createSuspendInfo(),e._suspends[t].state="pending"}static _resume(e,t){e._suspends[t].resolve(),e._suspends[t].state="resolved"}static _pause(e,t){let s=[];return g.__suspends[t]&&"pending"===g.__suspends[t].state&&!e.settings.get("settings.ignoreGlobalSuspend")&&s.push(g.__suspends[t].promise),e._suspends[t]&&"pending"===e._suspends[t].state&&s.push(e._suspends[t].promise),Promise.all(s)}static __isTransitionable(e,t){let s=!0;return e&&"ing"===e.slice(-3)&&("stopping"===e&&"stopped"!==t||"starting"===e&&"started"!==t)&&(s=!1),s}static __processWaitingList(e,t){let s=g.__waitingListIndexName.get(e.name+"."+t);s&&s.length>0&&g.__processIndex(s);let r=g.__waitingListIndexId.get(e.uniqueId+"."+t);r&&r.length>0&&g.__processIndex(r);let n=g.__waitingListIndexNone.get("none");n&&n.length>0&&g.__processIndex(n)}static __processIndex(e){let t=[];for(let s=0;s<e.length;s++){let r=e[s];g.__waitingList.get(r),g.__isAllReady(g.__waitingList.get(r))&&(g.__waitingList.get(r).resolve(),g.__waitingList.remove(r),t.push(r))}for(let s=t.length-1;s>=0;s--)g.__removeFromIndex(e,t[s])}static __addToWaitingList(e){let t=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16);g.__waitingList.set(t,e);let s=e.waitlist;for(let e=0;e<s.length;e++)s[e].state=s[e].state||"ready",s[e].id?g.__addToIndex(g.__waitingListIndexId,s[e].id+"."+s[e].state,t):s[e].name?g.__addToIndex(g.__waitingListIndexName,s[e].name+"."+s[e].state,t):g.__addToIndex(g.__waitingListIndexNone,"none",t)}static __addToIndex(e,t,s){let r=e.get(t);r||(r=[],e.set(t,r)),-1===r.indexOf(s)&&r.push(s)}static __removeFromIndex(e,t){let s=e.indexOf(t);s>-1&&e.splice(s,1)}static __getComponentInfo(e){let t;if(e.id)t=g.__components.get(e.id);else if(e.name)Object.keys(g.__components.items).forEach((s=>{e.name===g.__components.get(s).object.name&&(t=g.__components.get(s))}));else if(e.rootNode){let s=document.querySelector(e.rootNode);s&&s.uniqueId&&(t=g.__components.get(s.uniqueId))}else if(e.object){let s=e.object;s.uniqueId&&(t=g.__components.get(s.uniqueId))}return t}static __isAllReady(e){let t=!0,s=e.waitlist;for(let e=0;e<s.length;e++){let r=!1,n=this.__getComponentInfo(s[e]);if(n&&g.__isReady(s[e],n)&&(r=!0),!r){t=!1;break}}return t}static __isReady(e,t){let s=g.__isComponentMatch(t,e);return s&&(s=g.__isStateMatch(t.state,e.state)),s}static __isComponentMatch(e,t){let s=!0;return t.component&&e.object!==t.component&&(s=!1),t.name&&e.object.name!==t.name&&(s=!1),t.id&&e.object.uniqueId!==t.id&&(s=!1),t.rootNode&&!document.querySelector(t.rootNode)&&(s=!1),s}static __isStateMatch(e,t){let s=!1;switch(e){case"ready":"ready"!==t&&"started"!==t&&"starting"!==t||(s=!0);break;case"started":"started"!==t&&"starting"!==t||(s=!0);break;case"stopped":"stopped"!==t&&"stopping"!==t||(s=!0);break;default:e===t&&(s=!0)}return s}static __loadAttrSettings(e){if(e.hasAttribute("bm-waitfor")){let t={name:e.getAttribute("bm-waitfor"),state:"started"};e.settings.merge({waitFor:[t]})}if(e.hasAttribute("bm-waitfornode")){let t={rootNode:e.getAttribute("bm-waitfornode"),state:"started"};e.settings.merge({waitFor:[t]})}}static __dumpWaitlist(e){let t="";for(let s=0;s<e.length;s++){t+="\n\t{"+(e[s].id?"id:"+e[s].id+",":"")+(e[s].name?"name:"+e[s].name+",":"")+(e[s].object?"element:"+e[s].object.tagName+",":"")+(e[s].rootNode?"node:"+e[s].rootNode+",":"")+(e[s].state?"state:"+e[s].state:"")+"},"}return"["+t+"\n]"}static _createSuspendInfo(){let e={},t=new Promise(((t,s)=>{e.resolve=t,e.reject=s,e.state="pending"}));return e.promise=t,e}}class d extends s{static globalInit(){Object.defineProperty(l.prototype,"templates",{get(){return this._templates}}),Object.defineProperty(l.prototype,"activeTemplateName",{get(){return this._activeTemplateName},set(e){this._activeTemplateName=e}}),l.prototype.addTemplate=function(e,t){return d._addTemplate(this,e,t)},l.prototype.applyTemplate=function(e){return d._applyTemplate(this,e)},l.prototype.cloneTemplate=function(e){return d._clone(this,e)}}static init(e,t){if(e._templates={},e._activeTemplateName="",!e.settings.get("settings.templateName")){let t=e.settings.get("loadings.fileName")||e.tagName.toLowerCase();e.settings.set("settings.templateName",t)}}static organize(e,t,s){let r=[],n=s.templates;return n&&Object.keys(n).forEach((s=>{if("beforeStart"===e)switch(n[s].type){case"html":case"url":r.push(d._addTemplate(t,s))}else if("afterAppend"===e&&"node"===n[s].type)r.push(d._addTemplate(t,s))})),Promise.all(r)}static clear(e){e._templates={}}static _addTemplate(e,t,s){return(e._templates[t]||d.__createTemplateInfo(e,t)).isLoaded?Promise.resolve():e.loadTemplate(t)}static _applyTemplate(t,s){if(t._activeTemplateName===s)return Promise.resolve();let r=t._templates[s];if(e.assert(r,`TemplateOrganizer._applyTemplate(): Template not loaded. name=${t.name}, templateName=${s}`,ReferenceError),r.node){let e=d.clone(t,r.name);t.insertBefore(e,t.firstChild)}else t.innerHTML=r.html;t._activeTemplateName=s}static _clone(t,s){s=s||t.settings.get("settings.templateName");let r,n=t._templates[s];if(e.assert(n,`TemplateOrganizer._addTemplate(): Template not loaded. name=${t.name}, templateName=${s}`,ReferenceError),n.node)r=document.importNode(n.node,!0);else{let e=document.createElement("div");e.innerHTML=n.html,r=e.firstElementChild}return r}static __createTemplateInfo(e,t){return e._templates[t]||(e._templates[t]={},e._templates[t].name=t,e._templates[t].html="",e._templates[t].isLoaded=!1),e._templates[t]}}class c extends s{static globalInit(){l.prototype.initEvents=function(e,t,s){c._initEvents(this,e,t,s)},l.prototype.addEventHandler=function(e,t,s,r){c._addEventHandler(this,s,e,t,r)},l.prototype.trigger=function(e,t,s){return c._trigger(this,e,t,s)},l.prototype.triggerAsync=function(e,t,s){return c._triggerAsync(this,e,t,s)},l.prototype.getEventHandler=function(e){return c._getEventHandler(this,e)},l.prototype.removeEventHandler=function(e,t,s){return c._removeEventHandler(this,s,e,t)}}static init(e,t){}static organize(e,t,s){let r=s.events;if(r){let s=c.__filterElements(t,r,e);Object.keys(s).forEach((e=>{c._initEvents(t,e,r[e])}))}}static unorganize(e,t,s){let r=s.events;r&&Object.keys(r).forEach((e=>{c._removeEvents(t,e,r[e])}))}static _addEventHandler(t,s,r,n,a){s=s||t;let i="object"==typeof n?e.deepClone(n):{},o=c._getEventHandler(t,n);e.assert(o,`EventOrganizer._addEventHandler(): handler not found. name=${t.name}, eventName=${r}`),s.__bm_eventinfo||(s.__bm_eventinfo={component:t,listeners:{},promises:{},statuses:{}});let l=s.__bm_eventinfo.listeners;l[r]||(l[r]=[],s.addEventListener(r,c.__callEventHandler,i.listnerOptions)),l[r].push({handler:o,options:i.options,bindTo:a}),e.safeGet(i,"order"),l[r].sort(((e,t)=>e.order===t.order?0:e.order>t.order?1:-1))}static _removeEventHandler(t,s,r,n){s=s||t;let a=c._getEventHandler(t,n);e.assert(a,`EventOrganizer._removeEventHandler(): handler not found. name=${t.name}, eventName=${r}`);let i=e.safeGet(s,"__bm_eventinfo.listeners."+r);if(i)for(let e=i.length-1;e>=0;e--)if(i[e].handler===a){i.splice(e,1);break}}static _initEvents(e,t,s,r){r=r||e,s=s||e.settings.get("events."+t);let n=c.__getTargetElements(e,r,t,s);Object.keys(s.handlers).forEach((t=>{let r=Array.isArray(s.handlers[t])?s.handlers[t]:[s.handlers[t]];for(let s=0;s<r.length;s++)for(let a=0;a<n.length;a++)e.addEventHandler(t,r[s],n[a])}))}static _removeEvents(e,t,s,r){r=r||e;let n=c.__getTargetElements(e,r,t,s);Object.keys(s.handlers).forEach((t=>{let r=Array.isArray(s.handlers[t])?s.handlers[t]:[s.handlers[t]];for(let s=0;s<r.length;s++)for(let a=0;a<n.length;a++)e.removeEventHandler(t,r[s],n[a])}))}static _trigger(t,s,r,n){(r=e.deepMerge({},r)).sender=r.sender||t,n=n||t;let a=null;try{a=new CustomEvent(s,{detail:r})}catch(e){a=document.createEvent("CustomEvent"),a.initCustomEvent(s,!1,!1,r)}return n.dispatchEvent(a),e.safeGet(n,"__bm_eventinfo.promises."+s)||Promise.resolve()}static _triggerAsync(e,t,s,r){return(s=s||{}).async=!0,c._trigger.call(e,e,t,s,r)}static _getEventHandler(e,t){return"object"==typeof t?t.handler:t}static __filterElements(e,t,s){let r;switch(s){case"beforeStart":r=Object.keys(t).filter((e=>c.__isTargetSelf(e,t[e])));break;case"afterAppend":r=Object.keys(t).filter((e=>!c.__isTargetSelf(e,t[e])));break;case"afterSpecLoad":r=Object.keys(t)}return r.reduce(((e,s)=>(e[s]=t[s],e)),{})}static __isTargetSelf(e,t){let s=!1;return("this"===e||t&&"this"===t.rootNode)&&(s=!0),s}static __getTargetElements(t,s,r,n){let a;return a=c.__isTargetSelf(r,n)?[s]:n&&n.rootNode?e.scopedSelectorAll(s,n.rootNode):e.scopedSelectorAll(s,"#"+r),a}static __isHandlerInstalled(t,s,r){let n=!1,a=e.safeGet(t.__bm_eventinfo,"listeners."+s);if(a)for(let e=0;e<a.length;e++)if(a[e].handler===r){n=!0;break}return n}static __callEventHandler(t){let s=e.safeGet(this,"__bm_eventinfo.listeners."+t.type),r=e.safeGet(t,"detail.sender",this),n=e.safeGet(this,"__bm_eventinfo.component");if(e.warn("handling"!==e.safeGet(this,"__bm_eventinfo.statuses."+t.type),`EventOrganizer.__callEventHandler(): Event handler is already running. name=${this.tagName}, eventName=${t.type}`),e.safeSet(this,"__bm_eventinfo.statuses."+t.type,"handling"),!1===e.safeGet(t,"detail.async",!1))this.__bm_eventinfo.promises[t.type]=c.__handle(t,r,n,s).then((()=>{e.safeSet(this,"__bm_eventinfo.promises."+t.type,null),e.safeSet(this,"__bm_eventinfo.statuses."+t.type,"")})).catch((s=>{throw e.safeSet(this,"__bm_eventinfo.promises."+t.type,null),e.safeSet(this,"__bm_eventinfo.statuses."+t.type,""),s}));else try{this.__bm_eventinfo.promises[t.type]=c.__handleAsync(t,r,n,s),e.safeSet(this,"__bm_eventinfo.promises."+t.type,null),e.safeSet(this,"__bm_eventinfo.statuses."+t.type,"")}catch(s){throw e.safeSet(this,"__bm_eventinfo.promises."+t.type,null),e.safeSet(this,"__bm_eventinfo.statuses."+t.type,""),s}}static __handle(t,s,r,n){let a=Promise.resolve(),i=!1;for(let o=0;o<n.length;o++){let l={component:r,options:n[o].options?n[o].options:{}};a=a.then((()=>{let a=n[o].handler;a="string"==typeof a?r[a]:a,e.assert("function"==typeof a,`EventOrganizer._addEventHandler(): Event handler is not a function. name=${r.name}, eventName=${t.type}`,TypeError);let i=n[o].bindTo?n[o].bindTo:r;return a.call(i,s,t,l)})),i=!(!n[o].options||!n[o].options.stopPropagation)||i}return i&&t.stopPropagation(),a}static __handleAsync(t,s,r,n){let a=!1;for(let i=0;i<n.length;i++){let o={component:r,options:n[i].options?n[i].options:{}},l=n[i].handler;l="string"==typeof l?r[l]:l,e.assert("function"==typeof l,`EventOrganizer._addEventHandler(): Event handler is not a function. name=${r.name}, eventName=${t.type}`,TypeError);let g=n[i].bindTo?n[i].bindTo:r;l.call(g,s,t,o),a=!(!n[i].options||!n[i].options.stopPropagation)||a}return a&&t.stopPropagation(),Promise.resolve()}}class p extends s{static globalInit(){BITSMIST.v1.Component.prototype.getLoader=function(...e){return p._getLoader(this,...e)},BITSMIST.v1.Component.prototype.loadTags=function(...e){return this.getLoader().loadTags(...e)},BITSMIST.v1.Component.prototype.loadComponent=function(...e){return this.getLoader().loadComponent(...e)},BITSMIST.v1.Component.prototype.loadTemplate=function(...e){return this.getLoader().loadTemplate(this,...e)},BITSMIST.v1.Component.prototype.loadSetting=function(...e){return this.getLoader().loadSetting(this,...e)},BITSMIST.v1.Component.prototype.loadSettingFile=function(...e){return this.getLoader().loadSettingFile(...e)},p._loaders={},Object.defineProperty(p,"loaders",{get:()=>p._loaders}),p._loaders.DefaultLoader=BITSMIST.v1.DefaultLoader,document.addEventListener("DOMContentLoaded",(()=>{if(BITSMIST.v1.settings.get("organizers.LoaderOrgaznier.settings.autoLoadOnStartup",!0)){let t=BITSMIST.v1.settings.get("system.loaderName","DefaultLoader"),s=p._loaders[t].object;e.assert(p._loaders[t],`Loader doesn't exist. loaderName=${t}`),s.loadTags(document.body,{waitForTags:!1})}}))}static init(e,t){Object.defineProperty(e,"components",{get(){return this._components}}),e.addComponent=function(e,t,s){return p._addComponent(this,e,t,s)},e._components={},e.getLoader().init(e)}static organize(e,t,s){let r=Promise.resolve(),n=s.molds;n&&Object.keys(n).forEach((e=>{r=r.then((()=>p._addComponent(t,e,n[e],!0)))}));let a=s.components;return a&&Object.keys(a).forEach((e=>{r=r.then((()=>p._addComponent(t,e,a[e])))})),r}static register(t,s){(s=e.deepMerge({},s)).name=s.name?s.name:t,p._loaders[t]=s}static _getLoader(t,s){return s=s||t.settings.get("settings.loaderName","DefaultLoader"),e.assert(p._loaders[s],`Loader doesn't exist. loaderName=${s}`),p._loaders[s].object}static _addComponent(t,s,r,n){let a,i=e.safeGet(r,"loadings.tag");if(i){let e=/([\w-]+)\s+\w+.*?>/;a=i.match(e)[1]}else a=e.safeGet(r,"loadings.tagName",e.getTagNameFromClassName(s)).toLowerCase();return Promise.resolve().then((()=>{let t=e.safeGet(r,"loadings.loaderName","DefaultLoader"),n=p._loaders[t].object;if(e.safeGet(r,"loadings.autoLoad")||e.safeGet(r,"loadings.autoMorph"))return n.loadComponent(a,s,r)})).then((()=>{e.assert(e.safeGet(r,"loadings.rootNode"),`Root node not specified. name=${t.name}, componentName=${s}`),t._components[s]||(t._components[s]=p.__insertTag(t,a,r))})).then((()=>{if(n||e.safeGet(r,"loadings.sync")){let a=!0===(n=n||e.safeGet(r,"loadings.sync"))?"ready":n;return t.waitFor([{name:s,state:a}])}}))}static __insertTag(t,s,r){let n,a=t.rootElement.querySelector(e.safeGet(r,"loadings.rootNode"));e.assert(a,`LoaderOrganizer.__insertTag(): Root node does not exist. name=${t.name}, tagName=${s}, rootNode=${e.safeGet(r,"loadings.rootNode")}`,ReferenceError);let i=e.safeGet(r,"loadings.tag")?e.safeGet(r,"loadings.tag"):"<"+s+"></"+s+">";return e.safeGet(r,"loadings.overwrite")?(a.outerHTML=i,n=a):(a.insertAdjacentHTML("afterbegin",i),n=a.children[0]),n._injectSettings=function(t){return e.deepMerge(t,r)},n}}class m{static init(e,t){e.settings.merge(this._loadAttrSettings(e))}static loadTags(t,s){let r=[];return e.scopedSelectorAll(t,"[bm-autoload]:not([bm-autoloading]):not([bm-powered]),[bm-automorph]:not([bm-autoloading]):not([bm-powered])").forEach((t=>{t.setAttribute("bm-autoloading","");let s=t.hasAttribute("bm-loadername")?p.getLoader(t.getAttribute("bm-loadername")).object:this,n=this._loadAttrSettings(t),a=e.getClassNameFromTagName(t.tagName);t._injectSettings=function(t){return e.deepMerge(t,n)},r.push(s.loadComponent(t.tagName.toLowerCase(),a,n).then((()=>{t.removeAttribute("bm-autoloading")})))})),Promise.all(r).then((()=>{if(e.safeGet(s,"waitForTags"))return m._waitForChildren(t)}))}static loadComponent(s,r,n,a){if(customElements.get(s))return Promise.resolve();a=e.deepMerge({},a);let i=e.safeGet(n,"loadings.autoLoad");if(i=!0===i?"":i,i){let t=e.parseURL(i);n.loadings.appBaseUrl="",n.loadings.componentPath="",n.loadings.templatePath="",n.loadings.path=t.path,n.loadings.fileName=t.filenameWithoutExtension,"html"===t.extension&&(n.loadings.autoMorph=!n.loadings.autoMorph||n.loadings.autoMorph),a.query=t.query}let o=e.safeGet(n,"loadings.autoMorph",r);o=!0===o?"BITSMIST.v1.Component":o;let l=e.safeGet(a,"path",e.concatPath([e.safeGet(n,"loadings.appBaseUrl",BITSMIST.v1.settings.get("system.appBaseUrl","")),e.safeGet(n,"loadings.componentPath",BITSMIST.v1.settings.get("system.componentPath","")),e.safeGet(n,"loadings.path","")])),g=e.safeGet(n,"loadings.fileName",s.toLowerCase());return a.splitComponent=e.safeGet(a,"splitComponent",e.safeGet(n,"loadings.splitComponent",BITSMIST.v1.settings.get("system.splitComponent",!1))),a.query=e.safeGet(a,"query",e.safeGet(n,"loadgings.query"),""),m._autoloadComponent(o,g,l,a).then((()=>{if(o!==r){let e=t.getClass(o);t.newComponent(r,n,e,s)}if(!customElements.get(s)){let e=t.getClass(r);customElements.define(s,e)}}))}static loadTemplate(t,s,r){let n,a=t._templates[s],i=t.settings.get("templates."+s,{});switch(i.type){case"html":a.html=i.html,n=Promise.resolve();break;case"node":a.html=t.querySelector(i.rootNode).innerHTML,n=Promise.resolve();break;default:let s=e.safeGet(r,"path",e.concatPath([t.settings.get("loadings.appBaseUrl",BITSMIST.v1.settings.get("system.appBaseUrl","")),t.settings.get("loadings.templatePath",BITSMIST.v1.settings.get("system.templatePath",t.settings.get("loadings.componentPath",BITSMIST.v1.settings.get("system.componentPath","")))),t.settings.get("loadings.path","")]));n=this._loadTemplateFile(a.name,s,r).then((e=>{a.html=e}))}return n.then((()=>{a.isLoaded=!0}))}static loadSetting(t,s,r){let n;return Promise.resolve().then((()=>(n=e.safeGet(r,"path",e.concatPath([t.settings.get("loadings.appBaseUrl",BITSMIST.v1.settings.get("system.appBaseUrl","")),t.settings.get("loadings.componentPath",BITSMIST.v1.settings.get("system.componentPath","")),t.settings.get("loadings.path","")])),this.loadSettingFile(s,n,Object.assign({type:"js",bindTo:t},r))))).then((e=>{e&&t.settings.merge(e)}))}static loadSettingFile(t,s,r){let a,i=e.safeGet(r,"type","js"),o=e.safeGet(r,"query"),l=e.concatPath([s,t+"."+i])+(o?"?"+o:"");return n.ajaxRequest({url:l,method:"GET"}).then((t=>{if("json"===i)try{a=JSON.parse(t.responseText)}catch(e){throw e instanceof SyntaxError?new SyntaxError(`Illegal json string. url=${l}, message=${e.message}`):e}else{let s=e.safeGet(r,"bindTo");a=Function('"use strict";return ('+t.responseText+")").call(s)}return a}))}static _waitForChildren(t){let s=[];return e.scopedSelectorAll(t,"[bm-powered],[bm-autoloading]").forEach((e=>{if(t!=e.rootElement&&!e.hasAttribute("bm-nowait")){let t={object:e,state:"ready"};s.push(t)}})),BITSMIST.v1.StateOrganizer.waitFor(s,{waiter:t})}static _isLoadedClass(e){let s=!1;return("loaded"===m._classes.get(e,{}).state||t.getClass(e))&&(s=!0),s}static _autoloadComponent(e,t,s,r){let n;return this._isLoadedClass(e)?(m._classes.set(e+".state","loaded"),n=Promise.resolve()):"loading"===m._classes.get(e,{}).state?n=m._classes.get(e).promise:(m._classes.set(e+".state","loading"),n=this._loadComponentFile(t,s,r).then((()=>{m._classes.set(e,{state:"loaded",promise:null})})),m._classes.set(e+".promise",n)),n}static _loadComponentFile(t,s,r){let a=e.safeGet(r,"query"),i=e.concatPath([s,t+".js"])+(a?"?"+a:""),o=e.concatPath([s,t+".settings.js"])+(a?"?"+a:"");return Promise.resolve().then((()=>n.loadScript(i))).then((()=>{if(r.splitComponent)return n.loadScript(o)})).then((()=>{}))}static _loadTemplateFile(t,s,r){let a=e.safeGet(r,"query"),i=e.concatPath([s,t])+".html"+(a?"?"+a:"");return n.ajaxRequest({url:i,method:"GET"}).then((e=>e.responseText))}static _loadAttrSettings(e){let t={loadings:{}};return e.hasAttribute("bm-split")&&(t.loadings.splitComponent=!0),e.hasAttribute("bm-path")&&(t.loadings.path=e.getAttribute("bm-path")),e.hasAttribute("bm-filename")&&(t.loadings.fileName=e.getAttribute("bm-filename")),e.hasAttribute("bm-automorph")&&(t.loadings.autoMorph=!e.getAttribute("bm-automorph")||e.getAttribute("bm-automorph")),e.hasAttribute("bm-autoload")&&(t.loadings.autoLoad=!e.getAttribute("bm-autoload")||e.getAttribute("bm-autoload")),t}}m._classes=new a,window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.Component=l,window.BITSMIST.v1.Organizer=s,window.BITSMIST.v1.OrganizerOrganizer=r,r.globalInit(l),window.BITSMIST.v1.SettingOrganizer=o,o.globalInit(l),window.BITSMIST.v1.settings=o.globalSettings,r.register("StateOrganizer",{object:g,targetWords:"waitFor",targetEvents:"*",order:100}),window.BITSMIST.v1.StateOrganizer=g,r.register("TemplateOrganizer",{object:d,targetWords:"templates",targetEvents:["beforeStart","afterAppend"],order:200}),window.BITSMIST.v1.TemplateOrganizer=d,r.register("EventOrganizer",{object:c,targetWords:"events",targetEvents:["beforeStart","afterAppend","afterSpecLoad"],order:210}),window.BITSMIST.v1.EventOrganizer=c,r.register("LoaderOrganizer",{object:p,targetWords:["molds","components"],targetEvents:["afterStart","afterSpecLoad"],order:400}),window.BITSMIST.v1.LoaderOrganizer=p,p.register("DefaultLoader",{object:m}),window.BITSMIST.v1.DefaultLoader=m,window.BITSMIST.v1.Store=a,window.BITSMIST.v1.ChainableStore=i,window.BITSMIST.v1.AjaxUtil=n,window.BITSMIST.v1.ClassUtil=t,window.BITSMIST.v1.Util=e}();
