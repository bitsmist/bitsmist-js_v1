!function(){"use strict";function u(){}u.safeGet=function(t,e,n){for(var r=n,o=t,i=!0,s=e.split("."),a=0;a<s.length;a++){if(!("object"==typeof o&&s[a]in o)){i=!1;break}o=o[s[a]]}return i&&(r=o),r},u.safeSet=function(t,e,n){for(var r,o=t,i=e.split("."),s=0;s<i.length-1;s++){if("object"!=typeof o||i[s]in o){if("object"!=typeof o)throw new TypeError("Key already exists. key="+e+", existingKey="+r+", existingValue="+o)}else o[i[s]]={};r=i[s],o=o[i[s]]}if("object"!=typeof o)throw new TypeError("Key already exists. key="+e+", existingKey="+r+", existingValue="+o);return o[i[i.length-1]]=n,t},u.safeHas=function(t,e){for(var n=t,r=!0,o=e.split("."),i=0;i<o.length;i++){if(!("object"==typeof n&&o[i]in n)){r=!1;break}n=n[o[i]]}return r},u.concatPath=function(t){for(var e=t[0]||"",n=1;n<t.length;n++)t[n]&&("/"==e.slice(e.length-1)&&"/"==t[n].slice(0,1)?e+=t[n].slice(1):"/"==e.slice(e.length-1)||"/"==t[n].slice(0,1)?e+=t[n]:e?e+="/"+t[n]:e=t[n]);return e},u.deepMerge=function(e,n){return n&&Object.keys(n).forEach(function(t){Array.isArray(e[t])?e[t]=e[t].concat(n[t]):e.hasOwnProperty(t)&&"object"==typeof e[t]?u.deepMerge(e[t],n[t]):e[t]=n[t]}),e},u.getClassNameFromTagName=function(t){var e=t.split("-");return e[0].charAt(0).toUpperCase()+e[0].slice(1).toLowerCase()+e[1].charAt(0).toUpperCase()+e[1].slice(1).toLowerCase()},u.getTagNameFromClassName=function(t){var e,n,r,o=t.split(".");for(t=o[o.length-1],r=1;r<t.length&&!u.__isUpper(t.substring(r,r+1));r++);return e=t.substring(0,r),n=t.substring(r),e.toLowerCase()+"-"+n.toLowerCase()},u.getFilenameAndPathFromUrl=function(t){var e=t.lastIndexOf("/");return[t.substr(0,e),t.substr(e+1)]},u.__isUpper=function(t){return t==t.toUpperCase()&&t!=t.toLowerCase()};function r(t){this._chain=u.safeGet(t,"chain"),this._filter,this.items=u.safeGet(t,"items"),this.filter=u.safeGet(t,"filter",function(){return!0}),this.merger=u.safeGet(t,"merger",u.deepMerge)}var t={items:{configurable:!0},filter:{configurable:!0},merger:{configurable:!0}};t.items.get=function(){var t=this._chain?Object.assign({},this._chain._items,this._items):Object.assign({},this._items);return t},t.items.set=function(t){this._items=Object.assign({},t)},t.filter.get=function(){this._filter},t.filter.set=function(t){if("function"!=typeof t)throw TypeError("Filter is not a function. filter="+t);this._filter=t},t.merger.get=function(){this._merger},t.merger.set=function(t){if("function"!=typeof t)throw TypeError("Merger is not a function. filter="+t);this._merger=t},r.prototype.chain=function(t){this._chain=t},r.prototype.clear=function(){this._items={}},r.prototype.merge=function(t,e){if(t){e=e||this._merger;for(var n=Array.isArray(t)?t:[t],r=0;r<n.length;r++)e(this._items,n[r])}},r.prototype.get=function(t,e){return this._getChainedItem(this._chain,this,t,e)},r.prototype.set=function(t,e){u.safeSet(this._items,t,e)},r.prototype.setWithOrder=function(t,e){this.set(t,e)},r.prototype.mergeSet=function(t,e){var n=this._getLocal(t);"object"==typeof n?Object.assign(n,e):this.set(t,e)},r.prototype.remove=function(t){delete this._items[t]},r.prototype.has=function(t){return u.safeHas(this._items,t)},r.prototype._getLocal=function(t,e){return u.safeGet(this._items,t,e)},r.prototype._getChainedItem=function(t,e,n,r){var o=r;return e&&e.has(n)?o=e._getLocal(n):t&&t.has(n)&&(o=t._getLocal(n)),o},Object.defineProperties(r.prototype,t);function e(){this._classes=new r,this._components=new r,this._preferences=new r,this._settings=new r,this._organizers=new n}var n=function(r){function t(t,e){r.call(this,t,e),this._targets={}}return r&&(t.__proto__=r),((t.prototype=Object.create(r&&r.prototype)).constructor=t).prototype.set=function(t,e){if(r.prototype.set.call(this,t,e),e.name||(e.name=t),"function"==typeof e.object.globalInit&&e.object.globalInit(),e.targets)if(Array.isArray(e.targets))for(var n=0;n<e.targets.length;n++)this._targets[e.targets[n]]=e;else this._targets[e.targets]=e},t.prototype.getMerger=function(t){return u.safeGet(this._targets,t+".object.merger",u.deepmerge)},t.prototype.getOrganizerInfoByTarget=function(t){return u.safeGet(this._targets,t)},t}(r),o={components:{configurable:!0},classes:{configurable:!0},organizers:{configurable:!0},settings:{configurable:!0},preferences:{configurable:!0}};o.components.get=function(){return this._components},o.classes.get=function(){return this._classes},o.organizers.get=function(){return this._organizers},o.settings.get=function(){return this._settings},o.preferences.get=function(){return this._preferences},Object.defineProperties(e.prototype,o);function c(){}var i=new e;function s(){return Reflect.construct(HTMLElement,[],this.constructor)}c.newComponent=function(t,e,n,r){r=r||u.getClassNameFromTagName(n);var o=Function("superClass","return function "+c.__validateClassName(r)+"(){ { return Reflect.construct(superClass, [], this.constructor); } }")(t);return c.inherit(o,t),(e=Object.assign({},e)).name=r,o.prototype._getSettings=function(){return e},n&&customElements.define(n.toLowerCase(),o),o},c.inherit=function(t,e){t.prototype=Object.create(e.prototype),(t.prototype.constructor=t).prototype._super=e,Object.setPrototypeOf(t,e)},c.createObject=function(t){for(var e=[],n=arguments.length-1;0<n--;)e[n]=arguments[n+1];var r=c.getClass(t);if(!r)throw new ReferenceError("Class '"+t+"' is not defined.");return new(Function.prototype.bind.apply(r,[null].concat(e)))},c.getClass=function(t){var e;try{e=Function("return ("+c.__validateClassName(t)+")")()}catch(t){if(!(t instanceof ReferenceError))throw t}return e},c.__validateClassName=function(t){if(!/^[a-zA-Z0-9\-\._]+$/.test(t))throw new TypeError("Class name '"+t+"' is not valid.");return t},c.inherit(s,HTMLElement),customElements.define("bm-component",s),s.prototype.connectedCallback=function(){return this.isInitialized()?Promise.resolve():this.start()},s.prototype.disconnectedCallback=function(){return this._settings.get("autoStop")?this.stop():Promise.resolve()},s.prototype.adoptedCallback=function(){},s.prototype.attributeChangedCallback=function(){},Object.defineProperty(s.prototype,"name",{get:function(){return this._name}}),Object.defineProperty(s.prototype,"uniqueId",{get:function(){return this._uniqueId}}),s.prototype.start=function(t){var r=this;return t=u.deepMerge({autoSetup:!0,autoStop:!0,organizers:{OrganizerOrganizer:"",SettingOrganizer:"",StateOrganizer:""}},t),this._uniqueId=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16),this._name=this.constructor.name,Promise.resolve().then(function(){return r._injectSettings(t)}).then(function(t){return r.initOrganizers(t)}).then(function(){return r.changeState("starting")}).then(function(){return r.callOrganizers("beforeStart")}).then(function(){return r.trigger("beforeStart",r)}).then(function(){var t=r._settings.get("autoSetupOnStart"),e=r._settings.get("autoSetup");if(t||!1!==t&&e){var n=Object.assign({},BITSMIST.v1.Globals.preferences.items);return r.setup({newPreferences:n})}}).then(function(){return r.trigger("afterStart",r)}).then(function(){return r.changeState("started")})},s.prototype.stop=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.changeState("stopping")}).then(function(){return e.trigger("beforeStop",n,t)}).then(function(){return e.trigger("doStop",n,t)}).then(function(){return e.trigger("afterStop",n,t)}).then(function(){return e.changeState("stopped")})},s.prototype.setup=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.trigger("beforeSetup",n,t)}).then(function(){return e.trigger("doSetup",n,t)}).then(function(){return e.trigger("afterSetup",n,t)})},s.prototype._injectSettings=function(t){return t},s.prototype._getSettings=function(){return{}};function a(){}a.ajaxRequest=function(c){return new Promise(function(t,e){var n=u.safeGet(c,"url"),r=u.safeGet(c,"method"),o=u.safeGet(c,"data",""),i=u.safeGet(c,"headers"),s=u.safeGet(c,"options"),a=new XMLHttpRequest;a.open(r,n,!0),s&&Object.keys(s).forEach(function(t){a[t]=s[t]}),i&&Object.keys(i).forEach(function(t){a.setRequestHeader(t,i[t])}),a.addEventListener("load",function(){(200==a.status||201==a.status?t:e)(a)}),a.addEventListener("error",function(){e(a)}),a.send(o)})},a.loadScript=function(i){return new Promise(function(n,t){var e=i,r=document.createElement("script"),o=document.getElementsByTagName("script")[0];r.async=1,r.onload=r.onreadystatechange=function(t,e){!e&&r.readyState&&!/loaded|complete/.test(r.readyState)||(r.onload=r.onreadystatechange=null,r=void 0,e||n())},r.src=e,o.parentNode.insertBefore(r,o)})};function l(){}l.globalInit=function(){Object.defineProperty(s.prototype,"settings",{get:function(){return this._settings},configurable:!0})},l.init=function(t,e,n){e._settings=new r({items:n}),e._settings.chain(BITSMIST.v1.Globals.settings),e._settings.merge(e._getSettings()),e._settings.get("name")&&(e._name=e._settings.get("name"))},l.organize=function(t,e){return Promise.resolve().then(function(){return l.__loadExtraSettings(e,"setting")}).then(function(t){t&&e._settings.merge(t)}).then(function(){l.__loadAttrSettings(e)})},l.clear=function(){},l.isTarget=function(t,e){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];return"*"!=t&&"beforeStart"!=t?!1:!0},l.loadSetting=function(t,e){var n,r=u.concatPath([e,t+".js"]);return a.ajaxRequest({url:r,method:"GET"}).then(function(t){try{n=JSON.parse(t.responseText)}catch(t){throw new SyntaxError("Illegal json string. url="+r)}return n})},l.__loadExtraSettings=function(t,e){var n,r,o;if(t.hasAttribute("data-"+e+"href")?(r=(n=u.getFilenameAndPathFromUrl(t.getAttribute("data-"+e+"href")))[0],o=n[1].slice(0,-3)):(r=t.hasAttribute("data-"+e+"path")?t.getAttribute("data-"+e+"path"):"",o=t.hasAttribute("data-"+e+"name")?t.getAttribute("data-"+e+"name"):"",r&&!o&&(o="settings")),o||r)return l.loadSetting(o,r)},l.__loadAttrSettings=function(e){var t;e.hasAttribute("href")&&(t=u.getFilenameAndPathFromUrl(e.getAttribute("href")),e._settings.set("system.appBaseUrl",""),e._settings.set("system.templatePath",t[0]),e._settings.set("system.componentPath",t[0]),e._settings.set("path","")),e.hasAttribute("data-path")&&e._settings.set("path",e.getAttribute("data-path"));var n,r=document.querySelector(e._settings.get("rootNode"))?document.querySelector(e._settings.get("rootNode")).getAttribute("data-settings"):e.getAttribute("data-settings");r&&(n=JSON.parse(r),Object.keys(n).forEach(function(t){e._settings.set(t,n[t])}))};function g(){}g.globalInit=function(){Object.defineProperty(s.prototype,"organizers",{get:function(){return this._organizers},configurable:!0}),s.prototype.addOrganizer=function(t){g.addOrganizer(this,organizername)},s.prototype.removeOrganizer=function(t){g.removeOrganizer(this,organizername)},s.prototype.clearOrganizers=function(){g.clear(this)},s.prototype.callOrganizers=function(t,e){return g.callOrganizers(this,t,e)},s.prototype.initOrganizers=function(t){return g.initOrganizers(this,t)},s.prototype.clearOrganizers=function(){return g.clear(this)}},g.organize=function(t,e,n){n=n||e._settings.items;var r=Promise.resolve(),o=n.organizers;return o&&Object.keys(o).forEach(function(t){r=r.then(function(){return g.__addOrganizer(e,t,n)})}),r},g.clear=function(t){t._organizers={}},g.isTarget=function(t,e){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];return"*"!=t&&"beforeStart"!=t&&"afterSpecLoad"!=t?!1:!0},g.initOrganizers=function(t,e){Promise.resolve();return t._organizers={},g.organize("*",t,e).then(function(){return g.__autoInsertOrganizers(t,t._settings.items)})},g.callOrganizers=function(e,n,r){var o=Promise.resolve();return g._sortItems(e._organizers).forEach(function(t){e._organizers[t].object.isTarget(n,e._organizers[t],e)&&(o=o.then(function(){return e._organizers[t].object.organize(n,e,r)}))}),o},g._sortItems=function(t){var n=BITSMIST.v1.Globals.organizers.items;return Object.keys(t).sort(function(t,e){return n[t].order-n[e].order})},g.__autoInsertOrganizers=function(n,r){var o=Promise.resolve();return Object.keys(r).forEach(function(t){var e=BITSMIST.v1.Globals.organizers.getOrganizerInfoByTarget(t);e&&(o=o.then(function(){return g.__addOrganizer(n,e.name,r)}))}),o},g.__addOrganizer=function(t,e,n){if(!t._organizers[e]&&(t._organizers[e]=BITSMIST.v1.Globals.organizers.items[e],"function"==typeof t._organizers[e].object.init))return t._organizers[e].object.init("*",t,n)};function p(){}p.globalInit=function(){Object.defineProperty(s.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t}}),s.prototype.changeState=function(t){return p.changeState(this,t)},s.prototype.isInitialized=function(){return p.isInitialized(this)},s.prototype.waitFor=function(t,e){return p.waitFor(this,t,e)},s.prototype.suspend=function(t){return p.suspend(this,t)},s.prototype.resume=function(t){return p.resume(this,t)}},p.init=function(t,e){e._state="",p.__loadAttrSettings(e)},p.organize=function(t,e){var n=Promise.resolve(),r=e.settings.get("waitFor");return r&&(n=p.waitFor(e,r)),n},p.clear=function(){this.__waitingList.clear()},p.isTarget=function(t,e){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];var o=!1,i=n[0];return"*"==t||"afterAppend"==t||"afterSpecLoad"==t?o=!0:"beforeStart"==t&&(i instanceof BITSMIST.v1.Pad||(o=!0)),o},p.waitFor=function(n,r,o){var t;o=o||1e4;var i={waiter:n,waitlist:r.slice()};return p.__isAllReady(i)?t=Promise.resolve():(t=new Promise(function(t,e){i.resolve=t,i.reject=e,setTimeout(function(){e("waitFor() timed out after "+o+" milliseconds waiting for "+JSON.stringify(r)+", name="+n.name+".")},o)}),i.promise=t,p.__addToWaitingList(i,n)),t},p.waitForSingle=function(t,e,n){var r=BITSMIST.v1.Globals.components.get(t.uniqueId),o={id:t.uniqueId,state:e};return p.__isReady(o,r)?Promise.resolve():p.waitFor(t,[o],n)},p.changeState=function(t,e){if(!p.__isTransitionable(t.state,e))throw Error("Illegal transition. name="+t.name+", fromState="+t.state+", toState="+e+", id="+t.id);t.state=e,BITSMIST.v1.Globals.components.mergeSet(t.uniqueId,{object:t,state:e}),p.__processWaitingList(t,e)},p.suspend=function(t,e){var n={},r=new Promise(function(t,e){n.resolve=t,n.reject=e});return n.promise=r,t._suspend[e]=n,r},p.resume=function(t,e){t._suspend[e].resolve()},p.isInitialized=function(t){var e=!1;return t.state&&"starting"!=t.state&&"stopping"!=t.state&&"stopped"!=t.state&&(e=!0),e},p.__isTransitionable=function(t,e){var n=!0;return t&&"ing"==t.slice(-3)&&("stopping"==t&&"stopped"!=e||"starting"==t&&"started"!=e||"opening"==t&&"opened"!=e&&"opening"!=e||"closeing"==t&&"closed"!=e||"stopping"==t&&"stopped"!=e&&"closing"!=e)&&(n=!1),n},p.__processWaitingList=function(t,e){var n=p.__waitingListIndexName.get(t.name+"."+e);p.__processIndex(n);var r=p.__waitingListIndexId.get(t.uniqueId+"."+e);p.__processIndex(r),p.__processIndex(p.__waitingListIndexNone)},p.__processIndex=function(t){if(t)for(var e=0;e<t.length;e++){var n=t[e];n&&(p.__waitingList.get(n),p.__isAllReady(p.__waitingList.get(n))&&(p.__waitingList.get(n).resolve(),p.__waitingList.remove(n),t[e]=null))}},p.__addToWaitingList=function(t){var e=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16);p.__waitingList.set(e,t);for(var n=t.waitlist,r=0;r<n.length;r++)n[r].id?p.__addToIndex(p.__waitingListIndexId,n[r].id+"."+n[r].state,e):n[r].name?p.__addToIndex(p.__waitingListIndexName,n[r].name+"."+n[r].state,e):p.__waitingListIndexNone.push(e)},p.__addToIndex=function(t,e,n){t.get(e)||t.set(e,[]),t.get(e).push(n)},p.__getComponentInfo=function(e){var n,t;return e.id?n=BITSMIST.v1.Globals.components.get(e.id):e.name?Object.keys(BITSMIST.v1.Globals.components.items).forEach(function(t){e.name==BITSMIST.v1.Globals.components.get(t).object.name&&(n=BITSMIST.v1.Globals.components.get(t))}):!e.rootNode||(t=document.querySelector(e.rootNode))&&(n=BITSMIST.v1.Globals.components.get(t.uniqueId)),n},p.__isAllReady=function(t){for(var e=!0,n=t.waitlist,r=0;r<n.length;r++){var o=!1,i=this.__getComponentInfo(n[r]);if(i&&p.__isReady(n[r],i)&&(o=!0),!o){e=!1;break}}return e},p.__isReady=function(t,e){return t.state=t.state||"opened",p.__isComponentMatch(e,t)&&p.__isStateMatch(e.state,t.state)},p.__isComponentMatch=function(t,e){var n=!0;return e.component&&t.object!==e.component&&(n=!1),e.name&&t.object.name!=e.name&&(n=!1),e.id&&t.object.uniqueId!=e.id&&(n=!1),e.rootNode&&!document.querySelector(e.rootNode)&&(n=!1),n},p.__isStateMatch=function(t,e){var n=!0;switch(e){case"started":"opening"!=t&&"opened"!=t&&"closing"!=t&&"closed"!=t&&"started"!=t&&(n=!1);break;default:t!=e&&(n=!1)}return n},p.__loadAttrSettings=function(t){var e,n;t.hasAttribute("data-waitfor")&&(e={name:t.getAttribute("data-waitfor"),state:"started"},t._settings.set("waitFor",[e])),t.hasAttribute("data-waitfornode")&&(n={rootNode:t.getAttribute("data-waitfornode"),state:"started"},t._settings.set("waitFor",[n]))},p.__waitingList=new r,p.__waitingListIndexName=new Map,p.__waitingListIndexId=new Map,p.__waitingListIndexNone=[];function f(){}function d(){return Reflect.construct(s,[],this.constructor)}f.onDoOrganize=function(t,e,n){var r=n.target,o=n.options.attrs;return f.initAttr(r,o)},f.organize=function(t,e){var n={afterStart:f.onDoOrganize,afterAppend:f.onDoOrganize,afterSpecLoad:f.onDoOrganize,beforeOpen:f.onDoOrganize,afterOpen:f.onDoOrganize,beforeClose:f.onDoOrganize,afterClose:f.onDoOrganize,doRefresh:f.onDoOrganize},r=e.settings.get("attrs");return r&&Object.keys(r).forEach(function(t){n[t]&&e.addEventHandler(e,t,n[t],{attrs:r[t]},e)}),Promise.resolve()},f.clear=function(){},f.initAttr=function(n,r){return r&&Object.keys(r).forEach(function(e){switch(e){case"style":Object.keys(r[e]).forEach(function(t){n.style[t]=r[e][t]});break;default:n.setAttribute(e,r[e])}}),Promise.resolve()},f.isTarget=function(t,e){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];return"*"!=t&&"beforeStart"!=t&&"afterSpecLoad"!=t?!1:!0},c.inherit(d,s),customElements.define("bm-pad",d),d.prototype.open=function(r){var o=this,t=(r=Object.assign({},r)).sender?r.sender:this;return Promise.resolve().then(function(){return o.changeState("opening")}).then(function(){return o.switchTemplate(o._settings.get("templateName"))}).then(function(){return o.trigger("beforeOpen",t,r)}).then(function(){var t=o._settings.get("autoSetupOnOpen"),e=o._settings.get("autoSetup");if(t||!1!==t&&e){var n=Object.assign({},BITSMIST.v1.Globals.preferences.items);return r.newPreferences=r.newPreferences?r.newPreferences:n,o.setup(r)}}).then(function(){if(o._settings.get("autoRefresh"))return o.refresh(r)}).then(function(){return o.trigger("doOpen",t,r)}).then(function(){return o.trigger("afterOpen",t,r)}).then(function(){return o.changeState("opened")})},d.prototype.openModal=function(n){var r=this;return new Promise(function(t,e){r._isModal=!0,r._modalResult={result:!1},r._modalPromise={resolve:t,reject:e},r.open(n)})},d.prototype.close=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.changeState("closing")}).then(function(){return e.trigger("beforeClose",n,t)}).then(function(){return e.trigger("doClose",n,t)}).then(function(){return e.trigger("afterClose",n,t)}).then(function(){e._isModal&&e._modalPromise.resolve(e._modalResult)}).then(function(){return e.changeState("closed")})},d.prototype.refresh=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then(function(){return e.trigger("beforeRefresh",n,t)}).then(function(){if(e._settings.get("autoFill"))return e.fill(t)}).then(function(){return e.trigger("doRefresh",n,t)}).then(function(){return e.trigger("afterRefresh",n,t)})},d.prototype.switchTemplate=function(t,e){var n=this,r=(e=Object.assign({},e)).sender?e.sender:this;return this.isActiveTemplate(t)?Promise.resolve():Promise.resolve().then(function(){return n.addTemplate(t,{rootNode:n._settings.get("rootNode"),templateNode:n._settings.get("templateNode")})}).then(function(){var t=u.concatPath([n._settings.get("system.appBaseUrl",""),n._settings.get("system.componentPath","")]),e=n._settings.get("system.splitComponent",!1);return n.loadTags(n,t,{splitComponent:e})}).then(function(){return n.callOrganizers("afterAppend")}).then(function(){return n.trigger("afterAppend",r,e)})},d.prototype.fill=function(t){},d.prototype.start=function(t){var e=this;return t=u.deepMerge({autoSetupOnStart:!1,organizers:{TemplateOrganizer:""}},t),Promise.resolve().then(function(){return s.prototype.start.call(e,t)}).then(function(){if(e._settings.get("autoOpen"))return e.open()})};function m(){}m.globalInit=function(){s.prototype.addComponent=function(t,e){return m.addComponent(this,t,e)},s.prototype.loadTags=function(t,e,n){return m.loadTags(t,e,n)}},m.init=function(t,e){e._components={}},m.organize=function(t,e,n){var r=Promise.resolve(),o=(n=n||e.settings.items).molds;o&&Object.keys(o).forEach(function(t){r=r.then(function(){return m.addComponent(e,t,o[t],"opened")})});var i=n.components;return i&&Object.keys(i).forEach(function(t){r=r.then(function(){return m.addComponent(e,t,i[t])})}),r},m.clear=function(e){Object.keys(e._components).forEach(function(t){e._components[t].parentNode.removeChild(e._components[t])}),e._components={}},m.isTarget=function(t,e){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];var o=!1,i=n[0];return"*"==t||"afterAppend"==t||"afterSpecLoad"==t?o=!0:"beforeStart"==t&&(i instanceof BITSMIST.v1.Pad||(o=!0)),o},m.addComponent=function(n,r,o,i){var t=u.concatPath([n._settings.get("system.appBaseUrl",""),n._settings.get("system.componentPath",""),"path"in o?o.path:""]),e="splitComponent"in o?o.splitComponent:n._settings.get("system.splitComponent",!1),s="className"in o?o.className:r,a=o.tagName||s&&c.getClass(s)&&c.getClass(s).tagName||u.getTagNameFromClassName(s||r);return Promise.resolve().then(function(){return s?m.loadComponent(s,t,{splitComponent:e}):(s=r,void c.newComponent(BITSMIST.v1.Pad,o,a,s))}).then(function(){if(o.rootNode&&!n._components[r]){var t=document.querySelector(o.rootNode);if(!t)throw new ReferenceError("Root node does not exist when adding component "+r+" to "+o.rootNode+". name="+n.name);var e=o.tag?o.tag:"<"+a+"></"+a+">";o.overwrite?(t.outerHTML=e,n._components[r]=t):(t.insertAdjacentHTML("afterbegin",e),n._components[r]=t.children[0]),n._components[r]._injectSettings=function(t){return t=Object.assign({},n._super.prototype._injectSettings.call(this,t)),u.deepMerge(t,o)}}}).then(function(){var t;o.expose&&(t=!0===o.expose?r:o.expose,Object.defineProperty(n.__proto__,t,{get:function(){return n._components[r]}}))}).then(function(){if(i||o.sync){var t=i||(!0===o.sync?"started":o.sync),e=s.split(".");return p.waitFor(n,[{name:e[e.length-1],state:t}])}})},m.loadComponent=function(t,e,n){return m.__autoloadComponent(t,e,n)},m.loadTags=function(t,o,i){var s=[];return t.querySelectorAll("[data-autoload]").forEach(function(t){var e,n,r;t.removeAttribute("data-autoload"),t.setAttribute("data-autoload-done",""),t.getAttribute("href")?(e=t.getAttribute("href"),s.push(a.loadScript(e))):(n=t.hasAttribute("data-path")?t.getAttribute("data-path"):"",(r=t.hasAttribute("data-classname")?t.getAttribute("data-classname"):u.getClassNameFromTagName(t.tagName))?(i.splitComponent=t.hasAttribute("data-split")?t.getAttribute("data-split"):i.splitComponent,s.push(m.loadComponent(r,u.concatPath([o,n]),i))):c.newComponent(BITSMIST.v1.Pad,{},t.tagName))}),Promise.all(s)},m.__isLoadedClass=function(t){var e=!1;return"loaded"!=BITSMIST.v1.Globals.classes.get(t,{}).state&&!c.getClass(t)||(e=!0),e},m.__autoloadComponent=function(t,e,n){var r,o=n.tagName||u.getTagNameFromClassName(t);return m.__isLoadedClass(t)||customElements.get(o)?(BITSMIST.v1.Globals.classes.mergeSet(t,{state:"loaded"}),r=Promise.resolve()):"loading"==BITSMIST.v1.Globals.classes.get(t,{}).state?r=BITSMIST.v1.Globals.classes.get(t).promise:(BITSMIST.v1.Globals.classes.mergeSet(t,{state:"loading"}),r=m.__loadComponentScript(o,e,n).then(function(){BITSMIST.v1.Globals.classes.mergeSet(t,{state:"loaded",promise:null})}),BITSMIST.v1.Globals.classes.mergeSet(t,{promise:r})),r},m.__loadComponentScript=function(t,e,n){n=n||{};var r=u.concatPath([e,t+".js"]),o=u.concatPath([e,t+".settings.js"]);return Promise.resolve().then(function(){return a.loadScript(r)}).then(function(){if(n.splitComponent)return a.loadScript(o)}).then(function(){})};function h(){}h.organize=function(t,e){var n=e.settings.get("elements");return n&&Object.keys(n).forEach(function(t){e.setHtmlEventHandlers(t)}),Promise.resolve()},h.clear=function(){},h.isTarget=function(t,e){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];return"*"!=t&&"afterAppend"!=t&&"afterSpecLoad"!=t?!1:!0};function _(){}_.globalInit=function(){s.prototype.addEventHandler=function(t,e,n,r,o){_.addEventHandler(this,t,e,n,r,o)},s.prototype.trigger=function(t,e,n,r){return _.trigger(this,t,e,n,r)},s.prototype.triggerSync=function(t,e,n,r){return _.triggerSync(this,t,e,n,r)},s.prototype.setHtmlEventHandlers=function(t,e,n){_.setHtmlEventHandlers(this,t,e,n)},s.prototype.getEventHandler=function(t,e,n,r){return _.getEventHandler(this,t,e,n,r)}},_.organize=function(t,r){var o=r.settings.get("events");return o&&Object.keys(o).forEach(function(t){for(var e=Array.isArray(o[t])?o[t]:[o[t]],n=0;n<e.length;n++)r.addEventHandler(r,t,e[n])}),Promise.resolve()},_.clear=function(){},_.isTarget=function(t,e){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];return"*"!=t&&"beforeStart"!=t?!1:!0},_.addEventHandler=function(t,e,n,r,o,i){var s=_.getEventHandler(t,r,i);if("function"!=typeof s){var a=i?i.name:"";throw TypeError("Event handler is not a function. componentName="+t.name+", pluginName="+a+", eventName="+n)}e._bm_detail||(e._bm_detail={component:t,listeners:{},promises:{},statuses:{}});var c=e._bm_detail.listeners;c[n]||(c[n]=[],e.addEventListener(n,_.__callEventHandler)),c[n].push({handler:s,options:Object.assign({},o),bind:i,order:void 0});"object"==typeof r&&r.order&&r.order;c[n].sort(function(t,e){return t.order==e.order?0:t.order>e.order?1:-1})},_.trigger=function(t,e,n,r,o){(r=Object.assign({},r)).eventName=e,r.sender=n,o=o||t;var i=null;try{i=new CustomEvent(e,{detail:r})}catch(t){(i=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!1,r)}return o.dispatchEvent(i),u.safeGet(o,"_bm_detail.promises."+e)||Promise.resolve()},_.triggerSync=function(t,e,n,r,o){return(r=r||{}).async=!1,_.trigger.call(t,t,e,n,r,o)},_.setHtmlEventHandlers=function(n,t,r,e){e=e||n;for(var o=n._settings.get("elements."+t),i=o.rootNode?e.querySelectorAll(o.rootNode):e.querySelectorAll("#"+t),s=o.events,a=0;a<i.length;a++)!function(e){Object.keys(s).forEach(function(t){r=Object.assign({},s[t].options,r),_.addEventHandler(n,i[e],t,s[t],r)})}(a)},_.getEventHandler=function(t,e,n){n=n||t;var r="object"==typeof e?e.handler:e;return"string"==typeof r&&(r=n?n[r]:t[r]),r=r&&r.bind(n)},_.__callEventHandler=function(t){var e=this,n=u.safeGet(this,"_bm_detail.listeners."+t.type),r=u.safeGet(t,"detail.sender",this),o=u.safeGet(this,"_bm_detail.component");if("handling"==u.safeGet(this,"_bm_detail.statuses."+t.type))throw new Error("Event handler is already running. name="+this.tagName+", eventName="+t.type);u.safeSet(this,"_bm_detail.statuses."+t.type,"handling"),u.safeGet(t,"detail.async",!0)?(this._bm_detail.promises[t.type]=_.__handleAsync(t,r,o,n),this._bm_detail.promises[t.type].then(function(){u.safeSet(e,"_bm_detail.promises."+t.type,null),u.safeSet(e,"_bm_detail.statuses."+t.type,"")})):(this._bm_detail.promises[t.type]=_.__handleSync(t,r,o,n),u.safeSet(this,"_bm_detail.promises."+t.type,null),u.safeSet(this,"_bm_detail.statuses."+t.type,""))},_.__handleAsync=function(r,o,t,i){for(var s=Promise.resolve(),a=[],c=!1,e=0;e<i.length;e++)!function(e){var n={target:t,options:i[e].options?i[e].options:{}};s=s.then(function(t){return t&&a.push(t),i[e].handler(o,r,n)}),c=!(!i[e].options||!i[e].options.stopPropagation)||c}(e);return c&&r.stopPropagation(),s.then(function(t){return t&&a.push(t),a})},_.__handleSync=function(t,e,n,r){for(var o=!1,i=0;i<r.length;i++){var s={target:n,options:r[i].options?r[i].options:{}};r[i].handler(e,t,s),o=!(!r[i].options||!r[i].options.stopPropagation)||o}return o&&t.stopPropagation(),Promise.resolve()};function v(){}v.onInitService=function(t,e,n){var r=n.options.settings,o=n.options.component,i=r.events[e.type].handler,s=r.events[e.type].args,a={};return r.className?a.name=r.className:r.rootNode&&(a.rootNode=r.rootNode),a.state="started",o.waitFor([a]).then(function(){var e;r.className?Object.keys(BITSMIST.v1.Globals.components.items).forEach(function(t){BITSMIST.v1.Globals.components.items[t].object.name==r.className&&(e=BITSMIST.v1.Globals.components.items[t].object)}):e=document.querySelector(services[serviceName].rootNode),e[i].apply(e,s)})},v.organize=function(t,n){var r=this,o=n.settings.get("services");return o&&Object.keys(o).forEach(function(e){Object.keys(o[e].events).forEach(function(t){n.addEventHandler(n,t,r.onInitService,{component:n,settings:o[e]})})}),Promise.resolve()},v.clear=function(){},v.isTarget=function(t,e){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];return"*"!=t&&"beforeStart"!=t?!1:!0};function y(){}y.globalInit=function(){d.prototype.addTemplate=function(t,e){return y.addTemplate(this,t,e)},d.prototype.cloneTemplate=function(t){return t=t||this._settings.get("templateName"),y.clone(this,t)},d.prototype.isActiveTemplate=function(t){return y.isActive(this,t)}},y.init=function(t,e){e._templates={},e.settings.set("templateName",e.settings.get("templateName",e.tagName.toLowerCase())),e.settings.set("autoOpen",e.settings.get("autoOpen",!0)),e.settings.set("autoClose",e.settings.get("autoClose",!0)),y.__loadAttrSettings(e)},y.organize=function(t,e){var n=e.settings.get("templates");return n&&Object.keys(n).forEach(function(t){y.__getTemplateInfo(e,t).html=n[t]}),Promise.resolve()},y.clear=function(t){t._templates={}},y.isTarget=function(t,e){for(var n=[],r=arguments.length-2;0<r--;)n[r]=arguments[r+2];var o=!1;return n[0]instanceof BITSMIST.v1.Pad&&("*"!=t&&"beforeStart"!=t||(o=!0)),o},y.isActive=function(t,e){var n=!1;return y.__getTemplateInfo(t,e).isAppended&&(n=!0),n},y.addTemplate=function(e,t){var n=y.__getTemplateInfo(e,t);if(n.isAppended)throw new ReferenceError("Template already appended. name="+e.name+", templateName="+t);return Promise.resolve().then(function(){var t=u.concatPath([e._settings.get("system.appBaseUrl",""),e._settings.get("system.templatePath",""),e._settings.get("path","")]);return y.loadTemplate(e,n,t)}).then(function(){return e._settings.get("templateNode")&&y.__storeTemplateNode(e,n,e._settings.get("templateNode")),y.__applyTemplate(e,n)}).then(function(){e._templates[e._settings.get("templateName")]&&(e._templates[e._settings.get("templateName")].isAppended=!1),e._templates[t].isAppended=!0,e._settings.set("templateName",t)})},y.loadTemplate=function(t,e,n){return y.__autoLoadTemplate(t,e,n)},y.clone=function(t,e){if(!t._templates[e])throw new ReferenceError("Template not loaded. name="+t.name+", templateName="+e);var n;return n=t._templates[e].node?document.importNode(t._templates[e].node,!0):y.__dupElement(t,e),n},y.__autoLoadTemplate=function(t,e,n){var r,o;return e.html||e.node||(r=u.concatPath([n,e.name+".html"]),o=y.__loadTemplateFile(r).then(function(t){e.html=t})),Promise.all([o]).then(function(){if(!e.isLoaded)return t.trigger("afterLoadTemplate",t)}).then(function(){e.isLoaded=!0})},y.__loadTemplateFile=function(t){return a.ajaxRequest({url:t,method:"GET"}).then(function(t){return t.responseText})},y.__getTemplateInfo=function(t,e){return t._templates[e]||(t._templates[e]={},t._templates[e].name=e,t._templates[e].html="",t._templates[e].isAppended=!1,t._templates[e].isLoaded=!1),t._templates[e]},y.__storeTemplateNode=function(t,e,n){var r=document.querySelector(n);if(!r)throw new ReferenceError("Root node does not exist. name="+t.name+", rootNode="+n+", templateName="+e.name);r.insertAdjacentHTML("afterbegin",e.html);var o=r.children[0];e.node="content"in o?o.content:o},y.__applyTemplate=function(t,e){var n;e.node?(n=this.clone(e.name),t.insertBefore(n,this.firstChild)):t.innerHTML=e.html},y.__dupElement=function(t,e){e=e||t._settings.get("templateName");var n=document.createElement("div");return n.innerHTML=t._templates[e].html,n.firstElementChild},y.__loadAttrSettings=function(){};var S=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),((e.prototype=Object.create(t&&t.prototype)).constructor=e).prototype.notify=function(e,n){for(var r=this,o=[],t=arguments.length-2;0<t--;)o[t]=arguments[t+2];var i=Promise.resolve();return this._sortItems().forEach(function(t){i=i.then(function(){return r._callHandler.apply(r,[e,n,r._items[t]].concat(o))})}),i},e.prototype.notifySync=function(e,n){for(var r=this,o=[],t=arguments.length-2;0<t--;)o[t]=arguments[t+2];this._sortItems().forEach(function(t){r._callHandler.apply(r,[e,n,r._items[t]].concat(o))})},e.prototype._callHandler=function(t,e,n){for(var r,o,i=[],s=arguments.length-3;0<s--;)i[s]=arguments[s+3];if((r=this)._filter.apply(r,[e,n].concat(i))&&"function"==typeof n.object[t])return(o=n.object[t]).call.apply(o,[n.object,e].concat(i))},e.prototype._sortItems=function(){var n=this;return Object.keys(this._items).sort(function(t,e){return n._items[t].order-n.items[e].order})},e}(r);function b(){return Reflect.construct(s,[],this.constructor)}c.inherit(b,s),customElements.define("bm-tagloader",b),b.prototype.onDOMContentLoaded=function(t,e){var n=u.concatPath([this._settings.get("system.appBaseUrl",""),this._settings.get("system.componentPath","")]),r=this._settings.get("system.splitComponent",!1);this.loadTags(document,n,{splitComponent:r})},b.prototype.start=function(t){var e=this;return t=BITSMIST.v1.Util.deepMerge({name:"TagLoader",autoSetup:!1},t),BITSMIST.v1.Component.prototype.start.call(this,t).then(function(){"loading"!==document.readyState?e.onDOMContentLoaded():window.addEventListener("DOMContentLoaded",e.onDOMContentLoaded.bind(e))})},window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.Globals=i,window.BITSMIST.v1.Component=s,i.organizers.set("SettingOrganizer",{object:l,order:100}),window.BITSMIST.v1.SettingOrganizer=l,i.organizers.set("OrganizerOrganizer",{object:g,targets:"organizers",order:110}),window.BITSMIST.v1.OrganizerOrganizer=g,i.organizers.set("StateOrganizer",{object:p,targets:"waitFor",order:120}),window.BITSMIST.v1.StateOrganizer=p,i.organizers.set("AttrOrganizer",{object:f,targets:"attrs",order:130}),window.BITSMIST.v1.AttrOrganizer=f,i.organizers.set("ComponentOrganizer",{object:m,targets:"components",order:140}),window.BITSMIST.v1.ComponentOrganizer=m,i.organizers.set("ElementOrganizer",{object:h,targets:"elements",order:150}),window.BITSMIST.v1.ElementOrganizer=h,i.organizers.set("EventOrganizer",{object:_,targets:"events",order:160}),window.BITSMIST.v1.EventOrganizer=_,i.organizers.set("ServiceOrganizer",{object:v,targets:"services",order:170}),window.BITSMIST.v1.ServiceOrganizer=v,i.organizers.set("TemplateOrganizer",{object:y,targets:"templates",order:180}),window.BITSMIST.v1.TemplateOrganizer=y,window.BITSMIST.v1.Pad=d,window.BITSMIST.v1.Store=r,window.BITSMIST.v1.ObserverStore=S,window.BITSMIST.v1.TagLoader=b,window.BITSMIST.v1.AjaxUtil=a,window.BITSMIST.v1.ClassUtil=c,window.BITSMIST.v1.Util=u}();
