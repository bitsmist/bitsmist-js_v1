!function(){"use strict";var u=function(){};u.safeGet=function(t,e,n){for(var n=n,o=t,r=!0,s=e.split("."),i=0;i<s.length;i++){if(!("object"==typeof o&&s[i]in o)){r=!1;break}o=o[s[i]]}return r&&(n=o),n},u.safeSet=function(t,e,n){for(var o,r=t,s=e.split("."),i=0;i<s.length-1;i++){if("object"!=typeof r||s[i]in r){if("object"!=typeof r)throw new TypeError("Key already exists. key="+e+", existingKey="+o+", existingValue="+r)}else r[s[i]]={};o=s[i],r=r[s[i]]}if("object"!=typeof r)throw new TypeError("Key already exists. key="+e+", existingKey="+o+", existingValue="+r);return r[s[s.length-1]]=n,t},u.safeHas=function(t,e){for(var n=t,o=!0,r=e.split("."),s=0;s<r.length;s++){if(!("object"==typeof n&&r[s]in n)){o=!1;break}n=n[r[s]]}return o},u.concatPath=function(t){for(var e=t[0],n=1;n<t.length;n++)t[n]&&("/"==e.slice(e.length-1)&&"/"==t[n].slice(0,1)?e+=t[n].slice(1):"/"==e.slice(e.length-1)||"/"==t[n].slice(0,1)?e+=t[n]:e?e+="/"+t[n]:e=t[n]);return e},u.deepMerge=function(e,n){var o=this;return Object.keys(n).forEach(function(t){!e.hasOwnProperty(t)||"object"!=typeof e[t]||e[t]instanceof Array?e[t]=n[t]:o.deepMerge(e[t],n[t])}),e},u.getClassNameFromTagName=function(t){t=t.split("-");return t[0].charAt(0).toUpperCase()+t[0].slice(1).toLowerCase()+t[1].charAt(0).toUpperCase()+t[1].slice(1).toLowerCase()},u.getTagNameFromClassName=function(t){for(var e,n,o=1;o<t.length&&!u.__isUpper(t.substring(o,o+1));o++);return e=t.substring(0,o),n=t.substring(o),e.toUpperCase()+"-"+n.toUpperCase()},u.getFilenameAndPathFromUrl=function(t){var e=t.lastIndexOf("/");return[t.substr(0,e),t.substr(e+1)]},u.__isUpper=function(t){return t==t.toUpperCase()&&t!=t.toLowerCase()};var n=function(t,e){this._chain=u.safeGet(t,"chain"),this._filter,this._items=u.safeGet(t,"items",{}),this.filter=t&&t.filter?t.filter:function(){return!0}},t={items:{configurable:!0},filter:{configurable:!0}};t.items.get=function(){var t=this._chain?Object.assign({},this._chain._items,this._items):Object.assign({},this._items);return t},t.items.set=function(t){this._items=t},t.filter.get=function(){this._filter},t.filter.set=function(t){if("function"!=typeof t)throw TypeError("Filter is not a function. filter="+t);this._filter=t},n.prototype.chain=function(t){this._chain=t},n.prototype.clear=function(){this._items={}},n.prototype.merge=function(t){if(t)for(var e=Array.isArray(t)?t:[t],n=0;n<e.length;n++)u.deepMerge(this._items,e[n])},n.prototype.get=function(t,e){return this._getChainedItem(this._chain,this,t,e)},n.prototype.set=function(t,e){u.safeSet(this._items,t,e)},n.prototype.mergeSet=function(t,e){var n=this._getLocal(t);"object"==typeof n?Object.assign(n,e):this.set(t,e)},n.prototype.remove=function(t){delete this._items[t]},n.prototype.has=function(t){return u.safeHas(this._items,t)},n.prototype.notify=function(e,n){for(var o=this,r=[],t=arguments.length-2;0<t--;)r[t]=arguments[t+2];var s=Promise.resolve();return Object.keys(this._items).forEach(function(t){s=s.then(function(){return o._callHandler.apply(o,[e,n,o._items[t]].concat(r))})}),s},n.prototype.notifySync=function(e,n){for(var o=this,r=[],t=arguments.length-2;0<t--;)r[t]=arguments[t+2];Object.keys(this._items).forEach(function(t){o._callHandler.apply(o,[e,n,o._items[t]].concat(r))})},n.prototype._getLocal=function(t,e){return u.safeGet(this._items,t,e)},n.prototype._getChainedItem=function(t,e,n,o){return e&&e.has(n)?o=e._getLocal(n):t&&t.has(n)&&(o=t._getLocal(n)),o},n.prototype._callHandler=function(t,e,n){for(var o=[],r=arguments.length-3;0<r--;)o[r]=arguments[r+3];if(this._filter(e,n)){if("function"==typeof n.object[t])return(e=n.object[t]).call.apply(e,[n.object].concat(o));throw TypeError("Notification handler is not a function. name="+n.object.name+", type="+t)}},Object.defineProperties(n.prototype,t);var e=function(){this._classes=new n,this._components=new n,this._organizers=new n({filter:function(t,e){return e.object.isTarget(t)}}),this._preferences=new n,this._settings=new n},o={components:{configurable:!0},classes:{configurable:!0},organizers:{configurable:!0},settings:{configurable:!0},preferences:{configurable:!0}};function c(){}o.components.get=function(){return this._components},o.classes.get=function(){return this._classes},o.organizers.get=function(){return this._organizers},o.settings.get=function(){return this._settings},o.preferences.get=function(){return this._preferences},Object.defineProperties(e.prototype,o);var r=new e;function s(){}function i(){}function l(){}c.newComponent=function(e,t,n,o){e=e||BITSMIST.v1.Component,o=o||u.getClassNameFromTagName(n);function r(t){return Reflect.construct(e,[t],this.constructor)}return c.inherit(r,e),t.name=o,r.prototype._getSettings=function(){return t},n&&customElements.define(n.toLowerCase(),r),window[o]=r},c.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,Object.setPrototypeOf(t,e)},c.createObject=function(t){for(var e=[],n=arguments.length-1;0<n--;)e[n]=arguments[n+1];var o=c.getClass(t);if(!o)throw new ReferenceError("Class '"+t+"' is not defined.");return new(Function.prototype.bind.apply(o,[null].concat(e)))},c.getClass=function(t){var e;try{e=Function("return ("+t+")")()}catch(t){if(!(t instanceof ReferenceError))throw t}return e},s.organize=function(e,t){var n=Promise.resolve(),o=t.components;return o&&Object.keys(o).forEach(function(t){n=n.then(function(){return s.addComponent(e,t,o[t])})}),n},s.clear=function(e){Object.keys(e._components).forEach(function(t){e._components[t].parentNode.removeChild(e._components[t])}),e._components={}},s.isTarget=function(t){return"*"!=t&&"afterAppend"!=t&&"afterSpecLoad"!=t?!1:!0},s.addComponent=function(n,o,r){n._components||(n._components={});var e=u.concatPath([n._settings.get("system.appBaseUrl",""),n._settings.get("system.componentPath",""),"path"in r?r.path:""]),s="splitComponent"in r?r.splitComponent:n._settings.get("system.splitComponent",!1),i="className"in r?r.className:o;return Promise.resolve().then(function(){if(i)return n.loadComponent(i,e,{splitComponent:s});var t=r.tagName||u.getTagNameFromClassName(o);i=o,c.newComponent(BITSMIST.v1.Pad,{},t,i)}).then(function(){if(r.rootNode&&!n._components[o]){var t=document.querySelector(r.rootNode);if(!t)throw new ReferenceError("Root node does not exist when adding component "+o+" to "+r.rootNode+". name="+n.name);var e=r.tagName||c.getClass(i).tagName||u.getTagNameFromClassName(i),e=r.tag||(e?"<"+e+" data-path='"+r.path+"'></"+e+">":"");if(!e)throw new ReferenceError("Tag name for '"+o+"' is not defined. name="+n.name);t.insertAdjacentHTML("afterbegin",e),n._components[o]=t.children[0]}})},i.addEventHandler=function(t,e,n,o,r){var s=this.getEventHandler(n,r);if("function"!=typeof s){var i=r?r.name:"";throw TypeError("Event handler is not a function. componentName="+this.name+", pluginName="+i+", eventName="+e)}t._bm_detail||(t._bm_detail={component:this,listeners:{},promises:{},statuses:{}});i=t._bm_detail.listeners;i[e]||(i[e]=[],t.addEventListener(e,this.__callEventHandler)),i[e].push({handler:s,options:o,bind:r,order:void 0});"object"==typeof n&&n.order&&n.order;i[e].sort(function(t,e){return t.order==e.order?0:t.order>e.order?1:-1})},i.trigger=function(e,t,n,o){(n=Object.assign({},n)).eventName=e,n.sender=t,o=o||this;var r=null;try{r=new CustomEvent(e,{detail:n})}catch(t){(r=document.createEvent("CustomEvent")).initCustomEvent(e,!1,!1,n)}return o.dispatchEvent(r),u.safeGet(o,"_bm_detail.promises."+e)||Promise.resolve()},i.triggerSync=function(t,e,n,o){return(n=n||{}).async=!1,i.trigger.call(this,t,e,n,o)},i.setHtmlEventHandlers=function(t,n,e){var o=this;e=e||this;for(var r=this._settings.get("elements."+t),s=r.rootNode?e.querySelectorAll(r.rootNode):e.querySelectorAll("#"+t),i=r.events,a=0;a<s.length;a++)!function(e){Object.keys(i).forEach(function(t){n=Object.assign({},i[t].options,n),o.addEventHandler(s[e],t,i[t],n)})}(a)},i.getEventHandler=function(t,e,n){e=e||this;t="object"==typeof t?t.handler:t;return"string"==typeof t&&(t=(e||this)[t]),t=t&&t.bind(e)},i.__callEventHandler=function(t){var e=this,n=u.safeGet(this,"_bm_detail.listeners."+t.type),o=u.safeGet(t,"detail.sender",this),r=u.safeGet(this,"_bm_detail.component");if("handling"==u.safeGet(this,"_bm_detail.statuses."+t.type))throw new Error("Event handler is already running. name="+this.tagName+", eventName="+t.type);u.safeSet(this,"_bm_detail.statuses."+t.type,"handling"),u.safeGet(t,"detail.async",!0)?(this._bm_detail.promises[t.type]=i.__handleAsync(t,o,r,n),this._bm_detail.promises[t.type].then(function(){u.safeSet(e,"_bm_detail.promises."+t.type,null),u.safeSet(e,"_bm_detail.statuses."+t.type,"")})):(this._bm_detail.promises[t.type]=i.__handleSync(t,o,r,n),u.safeSet(this,"_bm_detail.promises."+t.type,null),u.safeSet(this,"_bm_detail.statuses."+t.type,""))},i.__handleAsync=function(o,r,t,s){for(var i=Promise.resolve(),a=[],c=!1,e=0;e<s.length;e++)!function(e){var n={target:t,options:s[e].options||{}};i=i.then(function(t){return t&&a.push(t),s[e].handler(r,o,n)}),c=!(!s[e].options||!s[e].options.stopPropagation)||c}(e);return c&&o.stopPropagation(),i.then(function(t){return t&&a.push(t),a})},i.__handleSync=function(t,e,n,o){for(var r=!1,s=0;s<o.length;s++){var i={target:n,options:o[s].options||{}};o[s].handler(e,t,i),r=!(!o[s].options||!o[s].options.stopPropagation)||r}return r&&t.stopPropagation(),Promise.resolve()},l.ajaxRequest=function(c){return new Promise(function(t,e){var n=u.safeGet(c,"url"),o=u.safeGet(c,"method"),r=u.safeGet(c,"data",""),s=u.safeGet(c,"headers"),i=u.safeGet(c,"options"),a=new XMLHttpRequest;a.open(o,n,!0),i&&Object.keys(i).forEach(function(t){a[t]=i[t]}),s&&Object.keys(s).forEach(function(t){a.setRequestHeader(t,s[t])}),a.addEventListener("load",function(){(200==a.status||201==a.status?t:e)(a)}),a.addEventListener("error",function(){e(a)}),a.send(r)})},l.loadScript=function(s){return new Promise(function(n,t){var e=s,o=document.createElement("script"),r=document.getElementsByTagName("script")[0];o.async=1,o.onload=o.onreadystatechange=function(t,e){!e&&o.readyState&&!/loaded|complete/.test(o.readyState)||(o.onload=o.onreadystatechange=null,o=void 0,e||n())},o.src=e,r.parentNode.insertBefore(o,r)})};var a=function(){};a.createComponent=function(t,e,n,o){var r="className"in(e=Object.assign({},e))?e.className:t;return this.__autoloadComponent(r,n,o).then(function(){return c.createObject(r,e)})},a.loadComponent=function(t,e,n){return this.__autoloadComponent(t,e,n)},a.loadSetting=function(t,e){var n,o=u.concatPath([e,t+".js"]);return l.ajaxRequest({url:o,method:"GET"}).then(function(t){try{n=JSON.parse(t.responseText)}catch(t){throw new SyntaxError("Illegal json string. url="+o)}return n})},a.loadSpec=function(t,e){var n,o=u.concatPath([e,t+".js"]),t=[];return t.push(this.__loadSpecFile(o)),Promise.all(t).then(function(t){try{n=JSON.parse(t[0])}catch(t){throw new SyntaxError("Illegal json string. url="+o)}return n})},a.loadTags=function(t,r,s){var i=this,a=[];return t.querySelectorAll("[data-autoload]").forEach(function(t){var e,n,o;t.getAttribute("href")?(e=t.getAttribute("href"),a.push(l.loadScript(e))):(o=t.hasAttribute("data-classhref")?(n=(o=u.getFilenameAndPathFromUrl(t.getAttribute("data-classhref")))[0],o[1].slice(0,-3)):(n=t.getAttribute("data-classpath"),t.getAttribute("data-classname")||u.getClassNameFromTagName(t.tagName)),n?(s.splitComponent=t.hasAttribute("data-split")?t.getAttribute("data-split"):s.splitComponent,a.push(i.loadComponent(o,u.concatPath([r,n]),s))):c.newComponent(BITSMIST.v1.Pad,{},t.tagName))}),Promise.all(a)},a.loadTemplate=function(t,e){return this.__autoLoadTemplate(t,e)},a.__isLoadedClass=function(t){var e=!1;return"loaded"!=BITSMIST.v1.Globals.classes.get(t,{}).status&&!c.getClass(t)||(e=!0),e},a.__autoloadComponent=function(n,o,r){var t,s=this;return this.__isLoadedClass(n)?(BITSMIST.v1.Globals.classes.mergeSet(n,{status:"loaded"}),t=Promise.resolve()):"loading"==BITSMIST.v1.Globals.classes.get(n,{}).status?t=BITSMIST.v1.Globals.classes.get(n).promise:(BITSMIST.v1.Globals.classes.mergeSet(n,{status:"loading"}),t=new Promise(function(t,e){s.__loadComponentScript(n,o,r).then(function(){BITSMIST.v1.Globals.classes.mergeSet(n,{status:"loaded"}),t()})}),BITSMIST.v1.Globals.classes.mergeSet(n,{promise:t})),t},a.__loadComponentScript=function(t,e,n){n=n||{};var o=u.concatPath([e,t+".js"]),r=u.concatPath([e,t+".settings.js"]);return Promise.resolve().then(function(){return l.loadScript(o)}).then(function(){if(n.splitComponent)return l.loadScript(r)}).then(function(){})},a.__loadSpecFile=function(t,e){return l.ajaxRequest({url:t,method:"GET"}).then(function(t){return t.responseText}).catch(function(t){if(e)return e})},a.__autoLoadTemplate=function(e,t){var n,o=this;return!e.name||e.html||(n=u.concatPath([t,e.name+".html"]),n=this.__loadTemplateFile(n).then(function(t){e.html=t})),Promise.all([n]).then(function(){if(!e.isLoaded)return o.trigger("afterLoadTemplate",o)}).then(function(){e.isLoaded=!0})},a.__loadTemplateFile=function(t){return l.ajaxRequest({url:t,method:"GET"}).then(function(t){return t.responseText})};var p=function(){};function f(t){var e=Reflect.construct(HTMLElement,[],this.constructor);e._status="",e._uniqueId=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16);return t=Object.assign({},{autoOpen:!0,autoClose:!0,autoSetup:!0,autoStop:!0},t,e._getSettings()),e._settings=new n({items:t}),e._settings.chain(BITSMIST.v1.Globals.settings),e._settings.set("name",u.safeGet(t,"name",e.constructor.name)),BITSMIST.v1.Globals.organizers.notifySync("organize","afterInitComponent",e,e._settings.items),p.changeStatus(e,"instantiated"),e.triggerSync("afterInitComponent",e),e}function h(){}function g(t){t=Reflect.construct(f,[t],this.constructor);return t._settings.set("templateName",t._settings.get("templateName",t.name)),t._isModal=!1,t._modalOptions,t._modalPromise,t._modalResult,t._shadowRoot,t._templates=t._templates||{},t.trigger("afterInitPad",t),t}function m(t){t=Object.assign({},t,{name:"TagLoader",autoSetup:!1});t=Reflect.construct(f,[t],this.constructor);return window.addEventListener("DOMContentLoaded",t.onDOMContentLoaded.bind(t)),t}p.organize=function(t,e){var n=Promise.resolve(),e=e.waitFor;return e&&(n=p.waitFor(t,e)),n},p.clear=function(){this.__waitingList.clear()},p.isTarget=function(t){return"*"!=t&&"afterAppend"!=t&&"afterSpecLoad"!=t?!1:!0},p.waitFor=function(n,o,r){var t;r=r||1e4;var s={waiter:n,waitlist:o};return p.__isAllReady(s)?t=Promise.resolve():(t=new Promise(function(t,e){s.resolve=t,s.reject=e,setTimeout(function(){e("waitFor() timed out after "+r+" milliseconds waiting for "+JSON.stringify(o)+", name="+n.name+".")},r)}),s.promise=t,p.__addToWaitingList(s,n,status)),t},p.waitForSingle=function(t,e,n){var o=BITSMIST.v1.Globals.components.get(t.uniqueId),e={id:t.uniqueId,status:e};return p.__isReady(e,o)?Promise.resolve():p.waitFor(t,[e],n)},p.changeStatus=function(t,e){if(!p.__isTransitionable(t.status,e))throw Error("Illegal transition. name="+t.name+", fromStatus="+t.status+", toStatus="+e);t.status=e,BITSMIST.v1.Globals.components.mergeSet(t.uniqueId,{object:t,status:e}),p.__processWaitingList(t,e)},p.__isTransitionable=function(t,e){var n=!0;return t&&"ing"==t.slice(-3)&&(""==t&&"instantiated"!=e||"stopping"==t&&"stopped"!=e||"starting"==t&&"started"!=e||"opening"==t&&"opened"!=e&&"opening"!=e||"closeing"==t&&"closed"!=e||"stopping"==t&&"stopped"!=e&&"closing"!=e||"opening"==e&&"connected"!=t)&&(n=!1),n},p.__processWaitingList=function(t,e){var n=p.__waitingListIndexName.get(t.name+"."+e);p.__processIndex(n);e=p.__waitingListIndexId.get(t.uniqueId+"."+e);p.__processIndex(e),p.__processIndex(p.__waitingListIndexNone)},p.__processIndex=function(t){if(t)for(var e=0;e<t.length;e++){var n=t[e];n&&(p.__waitingList.get(n),p.__isAllReady(p.__waitingList.get(n))&&(p.__waitingList.get(n).resolve(),p.__waitingList.remove(n),t[e]=null))}},p.__addToWaitingList=function(t,e,n){var o=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16);p.__waitingList.set(o,t);for(var r=t.waitlist,s=0;s<r.length;s++)r[s].id?p.__addToIndex(p.__waitingListIndexId,r[s].id+"."+r[s].status,o):r[s].name?p.__addToIndex(p.__waitingListIndexName,r[s].name+"."+r[s].status,o):p.__waitingListIndexNone.push(o)},p.__addToIndex=function(t,e,n){t.get(e)||t.set(e,[]),t.get(e).push(n)},p.__getComponentInfo=function(e){var n,t;return e.id?n=BITSMIST.v1.Globals.components.get(e.id):e.name?Object.keys(BITSMIST.v1.Globals.components.items).forEach(function(t){e.name==BITSMIST.v1.Globals.components.get(t).object.name&&(n=BITSMIST.v1.Globals.components.get(t))}):!e.rootNode||(t=document.querySelector(e.rootNode))&&(n=BITSMIST.v1.Globals.components.get(t.uniqueId)),n},p.__isAllReady=function(t){for(var e=!0,n=t.waitlist,o=0;o<n.length;o++){var r=!1,s=this.__getComponentInfo(n[o]);if(s&&p.__isReady(n[o],s)&&(r=!0),!r){e=!1;break}}return e},p.__isReady=function(t,e){return t.status=t.status||"opened",p.__isComponentMatch(e,t)&&p.__isStatusMatch(e.status,t.status)},p.__isComponentMatch=function(t,e){var n=!0;return e.component&&t.object!==e.component&&(n=!1),e.name&&t.object.name!=e.name&&(n=!1),e.id&&t.object.uniqueId!=e.id&&(n=!1),e.rootNode&&!document.querySelector(e.rootNode)&&(n=!1),n},p.__isStatusMatch=function(t,e){var n=!0;switch(e){case"instantiated":"instantiated"!=t&&"connected"!=t&&"opened"!=t&&"closed"!=t&&(n=!1);break;case"connected":"connected"!=t&&"opening"!=t&&"opened"!=t&&"closed"!=t&&(n=!1);break;default:t!=e&&(n=!1)}return n},p.__waitingList=new n,p.__waitingListIndexName=new Map,p.__waitingListIndexId=new Map,p.__waitingListIndexNone=[],c.inherit(f,HTMLElement),Object.assign(f.prototype,i),Object.assign(f.prototype,a),customElements.define("bm-component",f),Object.defineProperty(f.prototype,"name",{get:function(){return this._settings.get("name")}}),Object.defineProperty(f.prototype,"uniqueId",{get:function(){return this._uniqueId}}),Object.defineProperty(f.prototype,"status",{get:function(){return this._status},set:function(t){this._status=t}}),Object.defineProperty(f.prototype,"settings",{get:function(){return this._settings},configurable:!0}),f.prototype.open=function(e){var n=this,t=(e=Object.assign({},e)).sender||this;return Promise.resolve().then(function(){return n.changeStatus("opening")}).then(function(){if(n._settings.get("autoSetup")){var t=Object.assign({},BITSMIST.v1.Globals.preferences.items);return e.newPreferences=e.newPreferences||t,n.setup(e)}}).then(function(){if(n._settings.get("autoRefresh"))return n.refresh()}).then(function(){return n.trigger("beforeOpen",t,{options:e})}).then(function(){return n.trigger("afterOpen",t,{options:e})}).then(function(){return n.changeStatus("opened")})},f.prototype.close=function(t){var e=this,n=(t=Object.assign({},t)).sender||this;return Promise.resolve().then(function(){return e.changeStatus("closing")}).then(function(){return e.trigger("beforeClose",n)}).then(function(){return e.trigger("afterClose",n)}).then(function(){return e.changeStatus("closed")})},f.prototype.refresh=function(t){var e=this,n=(t=Object.assign({},t)).sender||this;return Promise.resolve().then(function(){return e.trigger("beforeRefresh",n,{options:t})}).then(function(){if(e._settings.get("autoFill"))return e.fill(t)}).then(function(){return e.trigger("doRefresh",n,{options:t})}).then(function(){return e.trigger("afterRefresh",n,{options:t})})},f.prototype.fill=function(t){},f.prototype.setup=function(t){var e=this,n=(t=Object.assign({},t)).sender||this;return Promise.resolve().then(function(){return e.trigger("beforeSetup",n,t)}).then(function(){return e.trigger("doSetup",n,t)}).then(function(){return e.trigger("afterSetup",n,t)})},f.prototype.start=function(){var e=this;return Promise.resolve().then(function(){return e.trigger("beforeStart",e)}).then(function(){return e.changeStatus("starting")}).then(function(){return e.__loadExtraSettings()}).then(function(t){if(t)return e._settings.merge(t),BITSMIST.v1.Globals.organizers.notify("organize","afterStart",e,t)}).then(function(){var t=e.__getSettingsFromAttribute();if(t)return e._settings.merge(t),BITSMIST.v1.Globals.organizers.notify("organize","afterStart",e,t)}).then(function(){return e.changeStatus("started")}).then(function(){return e.trigger("afterStart",e)}).then(function(){if(e._settings.get("autoOpen"))return e.open()})},f.prototype.stop=function(t){var e=this;return Promise.resolve().then(function(){if(e._settings.get("autoClose"))return e.close()}).then(function(){return e.trigger("beforeStop",e)}).then(function(){return e.changeStatus("stopping")}).then(function(){return e.trigger("doStop",e)}).then(function(){return e.changeStatus("stopped")}).then(function(){return e.trigger("afterStop",e)})},f.prototype.addComponent=function(t,e){return s.addComponent(this,t,e)},f.prototype.waitFor=function(t,e){return p.waitFor(this,t,e)},f.prototype.changeStatus=function(t){return p.changeStatus(this,t)},f.prototype.connectedCallback=function(){if("instantiated"==this._status||this._settings.get("autoRestart"))return this.start()},f.prototype.disconnectedCallback=function(){if(this._settings.get("autoStop"))return this.stop()},f.prototype.adoptedCallback=function(){},f.prototype.attributeChangedCallback=function(){},f.prototype._getSettings=function(){return{}},f.prototype.__loadExtraSettings=function(){var t=this.__getPathFromAttribute(),e=t[0],t=t[1];if(t||e)return this.loadSetting(t,e)},f.prototype.__getPathFromAttribute=function(t){var e,n;return t=t||"setting",this.hasAttribute("data-"+t+"href")?(e=(n=u.getFilenameAndPathFromUrl(this.getAttribute("data-"+t+"href")))[0],n=n[1].slice(0,-3)):(e=this.hasAttribute("data-"+t+"path")?this.getAttribute("data-"+t+"path"):"",n=this.hasAttribute("data-"+t+"name")?this.getAttribute("data-"+t+"name"):"",e&&!n&&(n="settings")),[e,n]},f.prototype.__getSettingsFromAttribute=function(){var t,e=this;this.hasAttribute("data-classpath")&&this._settings.set("path",this.getAttribute("data-classpath")),this.hasAttribute("data-classhref")&&(t=u.getFilenameAndPathFromUrl(this.getAttribute("data-classhref")),this._settings.set("path",t[0])),this.hasAttribute("data-templatepath")&&this._settings.set("path",this.getAttribute("data-templatepath")),this.hasAttribute("data-templatename")&&this._settings.set("templateName",this.getAttribute("data-templatename")),this.hasAttribute("data-templatehref")&&(o=u.getFilenameAndPathFromUrl(this.getAttribute("data-templatehref")),this._settings.set("path",o[0]),this._settings.set("templateName",o[1].replace(".html",""))),this.hasAttribute("data-path")&&this._settings.set("path",this.getAttribute("data-path"));var n,o=(this._settings.get("rootNode")?document.querySelector(this._settings.get("rootNode")):this).getAttribute("data-settings");o&&(n=JSON.parse(o),Object.keys(n).forEach(function(t){e._settings.set(t,n[t])}))},h.onDoOrganize=function(t,e,n){var o=n.target,n=n.options.attrs;return h.init(o,n)},h.organize=function(e,t){var n={afterStart:h.onDoOrganize,afterAppend:h.onDoOrganize,afterSpecLoad:h.onDoOrganize,beforeOpen:h.onDoOrganize,afterOpen:h.onDoOrganize,beforeClose:h.onDoOrganize,afterClose:h.onDoOrganize,doRefresh:h.onDoOrganize},o=t.attrs;return o&&Object.keys(o).forEach(function(t){n[t]&&e.addEventHandler(e,t,n[t],{attrs:o[t]},e)}),Promise.resolve()},h.clear=function(t){},h.init=function(n,o){return o&&Object.keys(o).forEach(function(e){"style"===e?Object.keys(o[e]).forEach(function(t){n.style[t]=o[e][t]}):n.setAttribute(e,o[e])}),Promise.resolve()},h.isTarget=function(t){return"*"!=t&&"afterInitComponent"!=t&&"afterSpecLoad"!=t?!1:!0},(t=function(){}).organize=function(e,t){t=t.elements;return t&&Object.keys(t).forEach(function(t){e.setHtmlEventHandlers(t)}),Promise.resolve()},t.clear=function(t){},t.isTarget=function(t){return"*"!=t&&"afterAppend"!=t&&"afterSpecLoad"!=t?!1:!0},(o=function(){}).organize=function(e,t){var n=t.events;return n&&Object.keys(n).forEach(function(t){e.addEventHandler(e,t,n[t])}),Promise.resolve()},o.clear=function(t){},o.isTarget=function(t){return"*"!=t&&"afterInitComponent"!=t&&"afterStart"!=t?!1:!0},(e=function(){}).onInitService=function(t,e,n){var o=n.options.settings,n=n.options.component,r=o.events[e.type].handler,s=o.events[e.type].args,e={};o.className?e.name=o.className:o.rootNode&&(e.rootNode=o.rootNode),e.status="opened",n.waitFor([e]).then(function(){var e;o.className?Object.keys(BITSMIST.v1.Globals.components.items).forEach(function(t){BITSMIST.v1.Globals.components.items[t].object.name==o.className&&(e=BITSMIST.v1.Globals.components.items[t].object)}):e=document.querySelector(services[serviceName].rootNode),e[r].apply(e,s)})},e.organize=function(n,t){var o=this,r=t.services;return r&&Object.keys(r).forEach(function(e){Object.keys(r[e].events).forEach(function(t){n.addEventHandler(n,t,o.onInitService,{component:n,settings:r[e]})})}),Promise.resolve()},e.clear=function(t){},e.isTarget=function(t){return"*"!=t&&"afterInitComponent"!=t&&"afterStart"!=t?!1:!0},(a=function(){}).organize=function(e,t){e._templates=e._templates||{};var n=t.templates;return n&&Object.keys(n).forEach(function(t){e.__getTemplateInfo(t).html=n[t]}),Promise.resolve()},a.clear=function(t){},a.isTarget=function(t){return"*"!=t&&"afterInitComponent"!=t&&"afterStart"!=t?!1:!0},c.inherit(g,f),customElements.define("bm-pad",g),g.prototype.open=function(t){var e=this;return Promise.resolve().then(function(){return e.switchTemplate(e._settings.get("templateName"))}).then(function(){return f.prototype.open.call(e,t)})},g.prototype.openModal=function(n){var o=this;return new Promise(function(t,e){n=Object.assign({},n),o._settings.items=Object.assign(o._settings.items,n),o._isModal=!0,o._modalResult={result:!1},o._modalOptions=n,o._modalPromise={resolve:t,reject:e},o.open()})},g.prototype.close=function(t){var e=this;return Promise.resolve().then(function(){return f.prototype.close.call(e,t)}).then(function(){e._isModal&&e._modalPromise.resolve(e._modalResult)})},g.prototype.switchTemplate=function(t){var n=this,e=this.__getTemplateInfo(t);if(!e.isAppended)return Promise.resolve().then(function(){var t=u.concatPath([n._settings.get("system.appBaseUrl",""),n._settings.get("system.templatePath",""),n._settings.get("path","")]);return n.loadTemplate(e,t)}).then(function(){return n.__applyTemplate(n._settings.get("rootNode"),t,n._settings.get("templateNode"))}).then(function(){var t=u.concatPath([n._settings.get("system.appBaseUrl",""),n._settings.get("system.componentPath","")]),e=n._settings.get("system.splitComponent",!1);n.loadTags(n,t,{splitComponent:e})}).then(function(){return BITSMIST.v1.Globals.organizers.notify("organize","afterAppend",n,n._settings.items)}).then(function(){return n.trigger("afterAppend",n)}).then(function(){n._templates[n._settings.get("templateName")]&&(n._templates[n._settings.get("templateName")].isAppended=!1),n._templates[t].isAppended=!0,n._settings.set("templateName",t)})},g.prototype.clone=function(t){if(t=t||this._settings.get("templateName"),!this._templates[t])throw new ReferenceError("Template not loaded. name="+this.name+", templateName="+t);return this._templates[t].node?document.importNode(this._templates[t].node,!0):this._dupElement(t)},g.prototype._dupElement=function(t){t=t||this._settings.get("templateName");var e=document.createElement("div");return e.innerHTML=this._templates[t].html,e.firstElementChild},g.prototype.__getTemplateInfo=function(t){return this._templates[t]||(this._templates[t]={},this._templates[t].name=t,this._templates[t].html="",this._templates[t].isAppended=!1,this._templates[t].isLoaded=!1),this._templates[t]},g.prototype.__appendToNode=function(t,e,n){if(!t)throw new ReferenceError("Root node does not exist. name="+this.name+", rootNode="+n+", templateName="+e);return this._templates[e].node?(n=this.clone(e),t.insertBefore(n,t.firstChild)):t.insertAdjacentHTML("afterbegin",this._templates[e].html),t.children[0]},g.prototype.__applyTemplate=function(t,e,n){var o;e&&(n&&!this._templates[e].node&&(o=this.__appendToNode(document.querySelector(n),e,n),this._templates[e].node="content"in o?o.content:o),n?this.__appendToNode(this,e,"this"):this.innerHTML=this._templates[e].html)},c.inherit(m,f),customElements.define("bm-tagloader",m),m.prototype.onDOMContentLoaded=function(t,e){var n=u.concatPath([this._settings.get("system.appBaseUrl",""),this._settings.get("system.componentPath","")]),o=this._settings.get("system.splitComponent",!1);this.loadTags(document,n,{splitComponent:o})},window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.Globals=r,window.BITSMIST.v1.Component=f,r.organizers.set("WaitforOrganizer",{object:p,targets:"waitFor"}),r.organizers.set("AttrOrganizer",{object:h,targets:"attrs"}),r.organizers.set("ComponentOrganizer",{object:s,targets:"components"}),r.organizers.set("ElementOrganizer",{object:t,targets:"elements"}),r.organizers.set("EventOrganizer",{object:o,targets:"events"}),r.organizers.set("ServiceOrganizer",{object:e,targets:"services"}),r.organizers.set("TemplateOrganizer",{object:a,targets:"templates"}),window.BITSMIST.v1.Pad=g,window.BITSMIST.v1.Store=n,window.BITSMIST.v1.AjaxUtil=l,window.BITSMIST.v1.ClassUtil=c,window.BITSMIST.v1.Util=u}();
