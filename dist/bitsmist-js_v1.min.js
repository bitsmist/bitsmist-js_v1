!function(){"use strict";var t=function(){};t.safeGet=function(t,e,n){for(var r=n,o=t,s=!0,i=e.split("."),a=0;a<i.length;a++){if("object"!=typeof o||!(i[a]in o)){s=!1;break}o=o[i[a]]}return s&&(r=o),r},t.safeSet=function(e,n,r){for(var o,s=e,i=n.split("."),a=0;a<i.length-1;a++)t.assert("object"==typeof s,"Util.safeSet(): Key already exists. key="+n+", existingKey="+o+", existingValue="+s,TypeError),i[a]in s||(s[i[a]]={}),o=i[a],s=s[i[a]];return t.assert("object"==typeof s,"Util.safeSet(): Key already exists. key="+n+", existingKey="+o+", existingValue="+s,TypeError),s[i[i.length-1]]=r,e},t.safeHas=function(t,e){for(var n=t,r=!0,o=e.split("."),s=0;s<o.length;s++){if("object"!=typeof n||!(o[s]in n)){r=!1;break}n=n[o[s]]}return r},t.concatPath=function(t){for(var e=t[0]||"",n=1;n<t.length;n++)t[n]&&("/"==e.slice(e.length-1)&&"/"==t[n].slice(0,1)?e+=t[n].slice(1):"/"==e.slice(e.length-1)||"/"==t[n].slice(0,1)?e+=t[n]:e?e+="/"+t[n]:e=t[n]);return e},t.deepMerge=function(e,n){return t.assert(e&&"object"==typeof e&&n&&"object"==typeof n,"Util.deepMerge(): Parameters must be an object.",TypeError),Object.keys(n).forEach((function(r){Array.isArray(e[r])?e[r]=e[r].concat(n[r]):!(e.hasOwnProperty(r)&&e[r]&&"object"==typeof e[r]&&n[r]&&"object"==typeof n[r])||e[r]instanceof HTMLElement||n[r]instanceof HTMLElement?e[r]=n[r]:t.deepMerge(e[r],n[r])})),e},t.deepClone=function(e,n){return t.assert(e&&"object"==typeof e&&n&&"object"==typeof n,"Util.deepClone(): Parameters must be an object.",TypeError),Object.keys(n).forEach((function(r){Array.isArray(e[r])?e[r]=e[r].concat(n[r]):!(e.hasOwnProperty(r)&&e[r]&&"object"==typeof e[r]&&n[r]&&"object"==typeof n[r])||e[r]instanceof HTMLElement||n[r]instanceof HTMLElement?Array.isArray(n[r])?e[r]=t.deepCloneArray(n[r]):!n[r]||"object"!=typeof n[r]||n[r]instanceof HTMLElement?e[r]=n[r]:(e[r]={},t.deepClone(e[r],n[r])):t.deepClone(e[r],n[r])})),e},t.deepCloneArray=function(e){t.assert(Array.isArray(e),"Util.deepCloneArray(): Parameter must be an array.",TypeError);for(var n=[],r=0;r<e.length;r++)!e[r]||"object"!=typeof e[r]||e[r]instanceof HTMLElement?n.push(e[r]):n.push(t.deepClone({},e[r]));return n},t.getClassNameFromTagName=function(t){var e=t.split("-");return e[0].charAt(0).toUpperCase()+e[0].slice(1).toLowerCase()+e[1].charAt(0).toUpperCase()+e[1].slice(1).toLowerCase()},t.getTagNameFromClassName=function(e){var n,r=e,o=e.split("."),s=o[o.length-1];for(n=1;n<s.length&&!t.__isUpper(s.substring(n,n+1));n++);return n<s.length&&(r=s.substring(0,n).toLowerCase()+"-"+s.substring(n).toLowerCase()),r},t.getFilenameAndPathFromUrl=function(t){var e=t.lastIndexOf("/");return[t.substr(0,e),t.substr(e+1)]},t.__isUpper=function(t){return t==t.toUpperCase()&&t!=t.toLowerCase()},t.assert=function(t,e,n,r){if(!t){var o=new n(e),s=o.stack.split("\n");throw s.splice(1,1),o.stack=s.join("\n"),o}};var e=function(){};e.newComponent=function(n,r,o,s){s=s||t.getClassNameFromTagName(o);var i=Function("superClass","return function "+e.__validateClassName(s)+"(){ { return Reflect.construct(superClass, [], this.constructor); } }")(n);return e.inherit(i,n),(r=Object.assign({},r)).settings=r.settings?r.settings:{},r.settings.name=s,i.prototype._getSettings=function(){return r},o&&customElements.define(o.toLowerCase(),i),i},e.inherit=function(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.prototype._super=e,Object.setPrototypeOf(t,e)},e.createObject=function(n){for(var r=[],o=arguments.length-1;o-- >0;)r[o]=arguments[o+1];var s=e.getClass(n);return t.assert(s,"ClassUtil.createObject(): Class '"+n+"' is not defined.",ReferenceError),new(Function.prototype.bind.apply(s,[null].concat(r)))},e.getClass=function(t){var n;try{n=Function("return ("+e.__validateClassName(t)+")")()}catch(t){if(!(t instanceof ReferenceError))throw t}return n},e.__validateClassName=function(e){var n=/^[a-zA-Z0-9\-\._]+$/.test(e);return t.assert(n,"ClassUtil.__validateClassName(): Class name '"+e+"' is not valid.",TypeError),e};var n=function(){};n.globalInit=function(t){},n.init=function(t,e,n){},n.organize=function(t,e,n){},n.clear=function(t){},n.isTarget=function(t,e,n){return"*"==e.targetEvents||e.targetEvents.indexOf(t)>-1},n.getEditor=function(){return""};var r=function(e){this._filter,this._options=Object.assign({},e),this.items=t.safeGet(e,"items"),this.filter=t.safeGet(e,"filter",(function(){return!0})),this.merger=t.safeGet(e,"merger",t.deepMerge)},o={items:{configurable:!0},filter:{configurable:!0},merger:{configurable:!0}};o.items.get=function(){return this.clone()},o.items.set=function(t){this._items=Object.assign({},t)},o.filter.get=function(){this._filter},o.filter.set=function(e){t.assert("function"==typeof e,"Store.filter: Filter is not a function. filter="+e,TypeError),this._filter=e},o.merger.get=function(){this._merger},o.merger.set=function(e){t.assert("function"==typeof e,"Store.merger: Merger is not a function. filter="+e,TypeError),this._merger=e},r.prototype.clear=function(){this._items={}},r.prototype.clone=function(){return t.deepClone({},this._items)},r.prototype.merge=function(t,e){e=e||this._merger;for(var n=Array.isArray(t)?t:[t],r=0;r<n.length;r++)n[r]&&"object"==typeof n[r]&&e(this._items,n[r])},r.prototype.get=function(e,n){return t.safeGet(this._items,e,n)},r.prototype.set=function(e,n,r){var o=e?this.get(e):this._items;o&&"object"==typeof o&&n&&"object"==typeof n?t.deepMerge(o,n):t.safeSet(this._items,e,n)},r.prototype.remove=function(t){delete this._items[t]},r.prototype.has=function(e){return t.safeHas(this._items,e)},Object.defineProperties(r.prototype,o);var s=function(e){function n(t,n){e.call(this,t,n),this._targetWords={}}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.prototype.set=function(t,n){(n=Object.assign({},n)).name=n.name?n.name:t,n.targetWords=n.targetWords?n.targetWords:[],n.targetWords=Array.isArray(n.targetWords)?n.targetWords:[n.targetWords],n.targetEvents=n.targetEvents?n.targetEvents:[],n.targetEvents=Array.isArray(n.targetEvents)?n.targetEvents:[n.targetEvents],e.prototype.set.call(this,t,n),n.object.globalInit(n.targetClass);for(var r=0;r<n.targetWords.length;r++)this._targetWords[n.targetWords[r]]=n},n.prototype.getMerger=function(e){return t.safeGet(this._targetWords,e+".object.merger",t.deepmerge)},n.prototype.getOrganizerInfoByTargetWords=function(e){return t.safeGet(this._targetWords,e)},n}(r),i=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.globalInit=function(t){Object.defineProperty(t.prototype,"organizers",{get:function(){return this._organizers}}),t.prototype.addOrganizers=function(t){return n._addOrganizers(this,t)},t.prototype.initOrganizers=function(t){return n._initOrganizers(this,t)},t.prototype.callOrganizers=function(t,e){return n._callOrganizers(this,t,e)},n.__organizers=new s,Object.defineProperty(n,"organizers",{get:function(){return n.__organizers}})},n.organize=function(t,e,r){return n._addOrganizers(e,r)},n.clear=function(t){t._organizers={}},n._addOrganizers=function(e,r){var o={},s=Promise.resolve(),i=r.organizers;return i&&Object.keys(i).forEach((function(r){t.safeGet(i[r],"settings.attach")&&!e._organizers[r]&&n.__organizers.get(r)&&(o[r]=n.__organizers.items[r])})),Object.keys(r).forEach((function(t){var r=n.__organizers.getOrganizerInfoByTargetWords(t);r&&(e._organizers[r.name]||(o[r.name]=r.object))})),n._sortItems(o).forEach((function(o){s=s.then((function(){return e._organizers[o]=Object.assign({},n.__organizers.items[o],t.safeGet(r,"organizers."+o)),e._organizers[o].object.init(e,r)}))})),s},n._initOrganizers=function(t,e){return t._organizers={},n.organize("*",t,e)},n._callOrganizers=function(t,e,r){var o=Promise.resolve();return n._sortItems(t._organizers).forEach((function(n){t._organizers[n].object.isTarget(e,t._organizers[n],t)&&(o=o.then((function(){return t._organizers[n].object.organize(e,t,r)})))})),o},n._sortItems=function(t){return Object.keys(t).sort((function(e,n){return t[e].order-t[n].order}))},n}(n),a=function(){};a.ajaxRequest=function(e){return new Promise((function(n,r){var o=t.safeGet(e,"url"),s=t.safeGet(e,"method"),i=t.safeGet(e,"data",""),a=t.safeGet(e,"headers"),c=t.safeGet(e,"options"),u=new XMLHttpRequest;u.open(s,o,!0),c&&Object.keys(c).forEach((function(t){u[t]=c[t]})),a&&Object.keys(a).forEach((function(t){u.setRequestHeader(t,a[t])})),u.addEventListener("load",(function(){200==u.status||201==u.status?n(u):r(u)})),u.addEventListener("error",(function(){r(u)})),u.send(i)}))},a.loadScript=function(t){return new Promise((function(e,n){var r=t,o=document.createElement("script"),s=document.getElementsByTagName("script")[0];o.async=1,o.onload=o.onreadystatechange=function(t,n){(n||!o.readyState||/loaded|complete/.test(o.readyState))&&(o.onload=o.onreadystatechange=null,o=void 0,n||e())},o.src=r,s.parentNode.insertBefore(o,s)}))};var c=function(e){function n(n){e.call(this,n),this.chain;var r=t.safeGet(n,"chain");r&&this.chain(r)}e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n;var r={items:{configurable:!0},localItems:{configurable:!0}};return r.items.get=function(){return this._chain?t.deepClone(this._chain.clone(),this._items):this.clone()},r.items.set=function(t){this._items=Object.assign({},t)},r.localItems.get=function(){return this.clone()},n.prototype.chain=function(e){t.assert(e instanceof n,"ChainableStore.chain(): Parameter must be a ChainableStore.",TypeError),this._chain=e},n.prototype.get=function(t,e){return this._getChainedItem(this._chain,this,t,e)},n.prototype.set=function(e,n,r){var o=e?this._getLocal(e):this._items;"object"==typeof o?t.deepMerge(o,n):t.safeSet(this._items,e,n)},n.prototype._getLocal=function(e,n){return t.safeGet(this._items,e,n)},n.prototype._getChainedItem=function(t,e,n,r){var o=r;return e&&e.has(n)?o=e._getLocal(n):t&&t.has(n)&&(o=t._getLocal(n)),o},Object.defineProperties(n.prototype,r),n}(r),u=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.globalInit=function(t){Object.defineProperty(t.prototype,"settings",{get:function(){return this._settings}}),n.__globalSettings=new c,Object.defineProperty(n,"globalSettings",{get:function(){return n.__globalSettings}})},n.init=function(t,e){t._settings=new c({items:e}),t.settings.merge(t._getSettings());var r=t.settings.get("settings.name");r&&(t._name=r),t.settings.get("settings.useGlobalSettings")&&t.settings.chain(n.globalSettings)},n.organize=function(t,e,r){return Promise.resolve().then((function(){return n.__loadExternalSettings(e,"setting")})).then((function(t){t&&e.settings.merge(t),n.__loadAttrSettings(e)}))},n.isTarget=function(t,e,n){return"beforeStart"==t},n.loadSetting=function(e,n,r){var o,s=t.concatPath([n,e+"."+(r=r||"js")]);return a.ajaxRequest({url:s,method:"GET"}).then((function(t){switch(r){case"json":try{o=JSON.parse(t.responseText)}catch(t){throw t instanceof SyntaxError?new SyntaxError("Illegal json string. url="+s+", message="+t.message):t}break;case"js":default:o=Function('"use strict";return ('+t.responseText+")")()}return o}))},n.__loadExternalSettings=function(e,r){var o,s;if(e.hasAttribute("bm-"+r+"ref")){var i=t.getFilenameAndPathFromUrl(e.getAttribute("bm-"+r+"ref"));s=i[0],o=i[1].slice(0,-3)}else s=e.hasAttribute("bm-"+r+"path")?e.getAttribute("bm-"+r+"path"):"",o=e.hasAttribute("bm-"+r+"name")?e.getAttribute("bm-"+r+"name"):"",s&&!o&&(o="settings");if(o||s)return n.loadSetting(o,s)},n.__loadAttrSettings=function(e){if(e.getAttribute("bm-autoload")){var n=t.getFilenameAndPathFromUrl(e.getAttribute("bm-autoload"));e.settings.set("system.appBaseUrl",""),e.settings.set("system.templatePath",n[0]),e.settings.set("system.componentPath",n[0]),e.settings.set("settings.path","")}e.hasAttribute("bm-path")&&e.settings.set("settings.path",e.getAttribute("bm-path"));var r=document.querySelector(e.settings.get("settings.rootNode"))?document.querySelector(e.settings.get("settings.rootNode")).getAttribute("bm-settings"):e.getAttribute("bm-settings");if(r){var o={settings:JSON.parse(r)};e.settings.merge(o)}},n}(n);function p(){return Reflect.construct(HTMLElement,[],this.constructor)}function g(){return Reflect.construct(p,[],this.constructor)}e.inherit(p,HTMLElement),p.prototype.connectedCallback=function(){this.isInitialized()||this.start()},p.prototype.disconnectedCallback=function(){this._settings.get("settings.autoStop")&&this.stop()},p.prototype.adoptedCallback=function(){},p.prototype.attributeChangedCallback=function(){},Object.defineProperty(p.prototype,"name",{get:function(){return this._name}}),Object.defineProperty(p.prototype,"uniqueId",{get:function(){return this._uniqueId}}),Object.defineProperty(p.prototype,"rootElement",{get:function(){return this._rootElement}}),p.prototype.start=function(e){var n=this,r={settings:{autoSetup:!0,autoPostStart:!0,autoStop:!0,triggerAppendOnStart:!0,useGlobalSettings:!0},organizers:{OrganizerOrganizer:{settings:{attach:!0}},SettingOrganizer:{settings:{attach:!0}},StateOrganizer:{settings:{attach:!0}}}};return e=e?BITSMIST.v1.Util.deepMerge(r,e):r,this._uniqueId=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16),this._name=this.constructor.name,this._rootElement=t.safeGet(e,"settings.rootElement",this),Promise.resolve().then((function(){return n._initStart(e)})).then((function(){return n._preStart()})).then((function(){if(n._settings.get("settings.autoPostStart"))return n._postStart()}))},p.prototype.stop=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.changeState("stopping")})).then((function(){return e.trigger("beforeStop",n,{options:t})})).then((function(){return e.trigger("doStop",n,{options:t})})).then((function(){return e.trigger("afterStop",n,{options:t})})).then((function(){return e.changeState("stopped")}))},p.prototype.setup=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.trigger("beforeSetup",n,{options:t})})).then((function(){return e.trigger("doSetup",n,{options:t})})).then((function(){return e.trigger("afterSetup",n,{options:t})})).then((function(){}))},p.prototype._injectSettings=function(t){return t},p.prototype._getSettings=function(){return{}},p.prototype._initStart=function(t){var e=this;return Promise.resolve().then((function(){return e._injectSettings(t)})).then((function(t){return u.init(e,t)})).then((function(){return e.initOrganizers(e._settings.items)}))},p.prototype._preStart=function(){var t=this;return Promise.resolve().then((function(){return t.changeState("starting")})).then((function(){return u.organize("beforeStart",t,t._settings.items)})).then((function(){return t.addOrganizers(t._settings.items)})).then((function(){return t.callOrganizers("beforeStart",t._settings.items)})).then((function(e){return t.trigger("beforeStart",t)})).then((function(){var e=t._settings.get("settings.autoSetupOnStart"),n=t._settings.get("settings.autoSetup");if(e||!1!==e&&n)return t.setup(t._settings.items)}))},p.prototype._postStart=function(){var t=this;return Promise.resolve().then((function(){return t.changeState("started")})).then((function(){return t.callOrganizers("afterStart",t._settings.items)})).then((function(){return t.trigger("afterStart",t)})).then((function(){if(t._settings.get("settings.triggerAppendOnStart"))return Promise.resolve().then((function(){return t.callOrganizers("afterAppend",t._settings.items)})).then((function(){return t.trigger("afterAppend",t,t._settings.items)}))}))},customElements.define("bm-component",p),e.inherit(g,p),g.prototype.start=function(t){var e=this,n={settings:{autoClose:!0,autoFill:!0,autoOpen:!0,autoRefresh:!0,autoSetupOnStart:!1,autoPostStart:!1,triggerAppendOnStart:!1},organizers:{AutoloadOrganizer:{settings:{attach:!0}},TemplateOrganizer:{settings:{attach:!0}}}};return t=t?BITSMIST.v1.Util.deepMerge(n,t):n,Promise.resolve().then((function(){return p.prototype.start.call(e,t)})).then((function(){return e.switchTemplate(e._settings.get("settings.templateName"))})).then((function(){return e._postStart()})).then((function(){if(e._settings.get("settings.autoOpen"))return e.open()}))},g.prototype.switchTemplate=function(t,e){var n=this,r=(e=Object.assign({},e)).sender?e.sender:this;return this.isActiveTemplate(t)?Promise.resolve():Promise.resolve().then((function(){return n.addTemplate(t)})).then((function(){return n.applyTemplate(t)})).then((function(){return n.callOrganizers("afterAppend",n._settings.items)})).then((function(){return n.trigger("afterAppend",r,{options:e})})).then((function(){}))},g.prototype.open=function(e){var n=this,r=(e=Object.assign({},e)).sender?e.sender:this;return Promise.resolve().then((function(){return n.changeState("opening")})).then((function(){return n.trigger("beforeOpen",r,{options:e})})).then((function(){var r=t.safeGet(e,"autoSetupOnOpen",n._settings.get("settings.autoSetupOnOpen")),o=t.safeGet(e,"autoSetupOnOpen",n._settings.get("settings.autoSetup"));if(r||!1!==r&&o)return n.setup(e)})).then((function(){if(t.safeGet(e,"autoRefresh",n._settings.get("settings.autoRefresh")))return n.refresh(e)})).then((function(){return n.trigger("doOpen",r,{options:e})})).then((function(){var t=n._settings.get("settings.autoFocus");if(t){var e=!0===t?n:n.querySelector(t);e&&e.focus()}})).then((function(){return n.trigger("afterOpen",r,{options:e})})).then((function(){return n.changeState("opened")}))},g.prototype.openModal=function(t){var e=this;return new Promise((function(n,r){e._isModal=!0,e._modalResult={result:!1},e._modalPromise={resolve:n,reject:r},e.open(t)}))},g.prototype.close=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.changeState("closing")})).then((function(){return e.trigger("beforeClose",n,{options:t})})).then((function(){return e.trigger("doClose",n,{options:t})})).then((function(){return e.trigger("afterClose",n,{options:t})})).then((function(){e._isModal&&e._modalPromise.resolve(e._modalResult)})).then((function(){return e.changeState("closed")}))},g.prototype.refresh=function(e){var n=this,r=(e=Object.assign({},e)).sender?e.sender:this;return Promise.resolve().then((function(){return n.trigger("beforeRefresh",r,{options:e})})).then((function(){return n.trigger("doTarget",r,{options:e})})).then((function(){if(t.safeGet(e,"autoFetch",n._settings.get("settings.autoFetch")))return n.fetch(e)})).then((function(){if(t.safeGet(e,"autoFill",n._settings.get("settings.autoFill")))return n.fill(e)})).then((function(){return n.trigger("doRefresh",r,{options:e})})).then((function(){return n.trigger("afterRefresh",r,{options:e})})).then((function(){}))},g.prototype.fetch=function(t){var e=this,n=(t=Object.assign({},t)).sender?t.sender:this;return Promise.resolve().then((function(){return e.trigger("beforeFetch",n,{options:t})})).then((function(){return e.callOrganizers("doFetch",t)})).then((function(){return e.trigger("doFetch",n,{options:t})})).then((function(){return e.trigger("afterFetch",n,{options:t})})).then((function(){}))},g.prototype.fill=function(t){},g.prototype.clear=function(t){},customElements.define("bm-pad",g);var l=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.globalInit=function(){g.prototype.addTemplate=function(t,e){return n._addTemplate(this,t,e)},g.prototype.applyTemplate=function(t){return n._applyTemplate(this,t)},g.prototype.cloneTemplate=function(t){return n._clone(this,t)},g.prototype.isActiveTemplate=function(t){return n._isActiveTemplate(this,t)}},n.init=function(t,e){t._templates={},t._activeTemplateName="",t.settings.set("settings.templateName",t.settings.get("settings.templateName",t.tagName.toLowerCase())),n.__loadAttrSettings(t)},n.organize=function(t,e,r){var o=[],s=r.templates;return s&&Object.keys(s).forEach((function(r){if("beforeStart"==t)switch(s[r].type){case"html":case"url":o.push(n._addTemplate(e,r))}else if("afterAppend"==t)switch(s[r].type){case"node":o.push(n._addTemplate(e,r))}})),Promise.all(o)},n.clear=function(t){t._templates={}},n._isActiveTemplate=function(t,e){var n=!1;return t._activeTemplateName===e&&(n=!0),n},n._addTemplate=function(t,e,r){var o=t._templates[e]||n.__createTemplateInfo(t,e);return o.isLoaded?Promise.resolve():n.__getTemplate(t,t.settings.get("templates."+e,{}),o)},n._applyTemplate=function(e,r){if(e._activeTemplateName==r)return Promise.resolve();var o=e._templates[r];if(t.assert(o,"TemplateOrganizer._applyTemplate(): Template not loaded. name="+e.name+", templateName="+r,ReferenceError),o.node){var s=n.clone(e,o.name);e.insertBefore(s,e.firstChild)}else e.innerHTML=o.html;e._activeTemplateName=r},n._clone=function(e,n){n=n||e._settings.get("settings.templateName");var r,o=e._templates[n];if(t.assert(o,"TemplateOrganizer._addTemplate(): Template not loaded. name="+e.name+", templateName="+n,ReferenceError),o.node)r=document.importNode(o.node,!0);else{var s=document.createElement("div");s.innerHTML=o.html,r=s.firstElementChild}return r},n.__loadTemplateFile=function(t){return a.ajaxRequest({url:t,method:"GET"}).then((function(t){return t.responseText}))},n.__createTemplateInfo=function(t,e){return t._templates[e]||(t._templates[e]={},t._templates[e].name=e,t._templates[e].html="",t._templates[e].isLoaded=!1),t._templates[e]},n.__storeTemplateNode=function(e,n,r){var o=document.querySelector(r);t.assert(o,"TemplateOrganizer._storeTemplate(): Root node does not exist. name="+e.name+", rootNode="+r+", templateName="+n.name,ReferenceError),o.insertAdjacentHTML("afterbegin",n.html);var s=o.children[0];n.node="content"in s?s.content:s},n.__loadAttrSettings=function(t){},n.__getTemplate=function(e,r,o){var s=Promise.resolve();switch(r.type){case"html":o.html=r.html;break;case"node":o.html=e.querySelector(r.rootNode).innerHTML;break;case"url":default:var i=t.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.templatePath",""),e.settings.get("settings.path","")]),a=t.concatPath([i,o.name+".html"]);s=n.__loadTemplateFile(a).then((function(t){o.html=t}))}return s.then((function(){o.isLoaded=!0}))},n}(n),f=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.globalInit=function(){p.prototype.initEvents=function(t,e,r){n._initEvents(this,t,e,r)},p.prototype.addEventHandler=function(t,e,r,o){n._addEventHandler(this,r,t,e,o)},p.prototype.trigger=function(t,e,r,o){return n._trigger(this,t,e,r,o)},p.prototype.triggerAsync=function(t,e,r,o){return n._triggerAsync(this,t,e,r,o)},p.prototype.getEventHandler=function(t){return n._getEventHandler(this,t)}},n.organize=function(t,e,r){var o=r.events;o&&Object.keys(o).forEach((function(t){n._initEvents(e,t,o[t])}))},n._addEventHandler=function(e,r,o,s,i){r=r||e;var a=n._getEventHandler(e,s);t.assert("function"==typeof a,"EventOrganizer._addEventHandler(): Event handler is not a function. componentName="+e.name+", eventName="+o,TypeError),r.__bm_eventinfo||(r.__bm_eventinfo={component:e,listeners:{},promises:{},statuses:{}});var c=r.__bm_eventinfo.listeners;c[o]||(c[o]=[],r.addEventListener(o,n.__callEventHandler,s.listenerOptions)),c[o].push({handler:a,options:Object.assign({},s.options),bindTo:i,order:u});var u=t.safeGet(s,"order");c[o].sort((function(t,e){return t.order==e.order?0:t.order>e.order?1:-1}))},n._removeEventHandler=function(e,r,o,s){r=r||e;var i=n._getEventHandler(e,s);t.assert("function"==typeof i,"EventOrganizer._removeEventHandler(): Event handler is not a function. componentName="+e.name+", eventName="+o,TypeError);var a=t.safeGet(r,"__bm_eventinfo.listeners."+o);if(a){for(var c=-1,u=0;u<a.length;u++)if(a.handler==i){c=u;break}c>-1&&(r.__bm_eventinfo.listeners=array.splice(c,1))}},n._initEvents=function(t,e,r,o){o=o||t.rootElement,r=r||t.settings.get("events."+e);var s=n.__getTargetElements(t,o,e,r);r.handlers&&Object.keys(r.handlers).forEach((function(e){for(var o=Array.isArray(r.handlers[e])?r.handlers[e]:[r.handlers[e]],i=0;i<o.length;i++)for(var a=t.getEventHandler(o[i]),c=0;c<s.length;c++)n.__isHandlerInstalled(s[c],e,a,t)||t.addEventHandler(e,o[i],s[c])}))},n._trigger=function(e,n,r,o,s){(o=Object.assign({},o)).sender=r,s=s||e;var i=null;try{i=new CustomEvent(n,{detail:o})}catch(t){(i=document.createEvent("CustomEvent")).initCustomEvent(n,!1,!1,o)}return s.dispatchEvent(i),t.safeGet(s,"__bm_eventinfo.promises."+n)||Promise.resolve()},n._triggerAsync=function(t,e,r,o,s){return(o=o||{}).async=!0,n._trigger.call(t,t,e,r,o,s)},n._getEventHandler=function(t,e){var n="object"==typeof e?e.handler:e;return"string"==typeof n&&(n=t[n]),n},n.__getTargetElements=function(t,e,n,r){return r.rootNode?"this"==r.rootNode||r.rootNode==t.tagName.toLowerCase()?[e]:e.querySelectorAll(r.rootNode):"this"==n||n==t.tagName.toLowerCase()?[e]:e.querySelectorAll("#"+n)},n.__isHandlerInstalled=function(e,n,r){var o=!1,s=t.safeGet(e.__bm_eventinfo,"listeners."+n);if(s)for(var i=0;i<s.length;i++)if(s[i].handler===r){o=!0;break}return o},n.__callEventHandler=function(e){var r=this,o=t.safeGet(this,"__bm_eventinfo.listeners."+e.type),s=t.safeGet(e,"detail.sender",this),i=t.safeGet(this,"__bm_eventinfo.component");t.assert("handling"!==t.safeGet(this,"__bm_eventinfo.statuses."+e.type),"EventOrganizer.__callEventHandler(): Event handler is already running. name="+this.tagName+", eventName="+e.type,Error),t.safeSet(this,"__bm_eventinfo.statuses."+e.type,"handling"),0==t.safeGet(e,"detail.async",!1)?this.__bm_eventinfo.promises[e.type]=n.__handle(e,s,i,o).then((function(n){return t.safeSet(r,"__bm_eventinfo.promises."+e.type,null),t.safeSet(r,"__bm_eventinfo.statuses."+e.type,""),n})):(this.__bm_eventinfo.promises[e.type]=n.__handleAsync(e,s,i,o),t.safeSet(this,"__bm_eventinfo.promises."+e.type,null),t.safeSet(this,"__bm_eventinfo.statuses."+e.type,""))},n.__handle=function(t,e,n,r){for(var o=Promise.resolve(),s=[],i=!1,a=function(a){var c={component:n,options:r[a].options?r[a].options:{}};o=o.then((function(o){s.push(o);var i=r[a].bindTo?r[a].bindTo:n;return r[a].handler.call(i,e,t,c)})),i=!(!r[a].options||!r[a].options.stopPropagation)||i},c=0;c<r.length;c++)a(c);return i&&t.stopPropagation(),o.then((function(t){return s.push(t),s}))},n.__handleAsync=function(t,e,n,r){for(var o=!1,s=0;s<r.length;s++){var i={component:n,options:r[s].options?r[s].options:{}},a=r[s].bindTo?r[s].bindTo:n;r[s].handler.call(a,e,t,i),o=!(!r[s].options||!r[s].options.stopPropagation)||o}return o&&t.stopPropagation(),Promise.resolve()},n}(n),d=function(n){function o(){n.apply(this,arguments)}return n&&(o.__proto__=n),o.prototype=Object.create(n&&n.prototype),o.prototype.constructor=o,o.globalInit=function(t){g.prototype.loadTags=o.loadTags,o.__classes=new r},o.init=function(t,e){Object.defineProperty(t,"components",{get:function(){return this._components}}),t.addComponent=function(t,e,n){return o._addComponent(this,t,e,n)},t._components={}},o.organize=function(t,e,n){var r=Promise.resolve(),s=n.molds;s&&Object.keys(s).forEach((function(t){r=r.then((function(){return o._addComponent(e,t,s[t],"opened")}))}));var i=n.components;return i&&Object.keys(i).forEach((function(t){r=r.then((function(){return o._addComponent(e,t,i[t])}))})),r},o.clear=function(t){Object.keys(t.components).forEach((function(e){t.components[e].parentNode.removeChild(t._components[e])})),t._components={}},o._addComponent=function(e,n,r,s){var i=t.concatPath([e.settings.get("system.appBaseUrl",""),e.settings.get("system.componentPath",""),t.safeGet(r,"settings.path","")]),a=t.safeGet(r,"settings.className")||n,c=t.safeGet(r,"settings.tagName")||t.getTagNameFromClassName(a);return Promise.resolve().then((function(){var n={autoLoad:t.safeGet(r,"settings.autoLoad",e.settings.get("system.autoLoad",!0)),splitComponent:t.safeGet(r,"settings.splitComponent",e.settings.get("system.splitComponent",!1))};return o._loadComponent(a,i,r,n,c)})).then((function(){t.safeGet(r,"settings.rootNode")&&!e.components[n]&&(e.components[n]=o.__insertTag(e,c,r))})).then((function(){if(s||t.safeGet(r,"settings.sync")){var n=!0===(s=s||t.safeGet(r,"settings.sync"))?"started":s,o=a.split(".");return e.waitFor([{name:o[o.length-1],state:n}])}}))},o.loadTags=function(e,n,r){var s=[];return e.querySelectorAll("[bm-autoload]:not([bm-autoloaded]),[bm-automorph]:not([bm-autoloaded])").forEach((function(e){e.setAttribute("bm-autoloaded","");var i=e.getAttribute("bm-autoload"),a=e.getAttribute("bm-classname")||t.getClassNameFromTagName(e.tagName),c=e.getAttribute("bm-path")||"",u=!!e.hasAttribute("bm-split")||r.splitComponent,p={settings:{autoMorph:!!e.hasAttribute("bm-automorph")&&(!e.getAttribute("bm-automorph")||e.getAttribute("bm-automorph"))}},g={splitComponent:u,autoLoad:!0};if(i){var l=t.getFilenameAndPathFromUrl(i);c=l[0],".js"==i.slice(-3).toLowerCase()?p.settings.fileName=l[1].substring(0,l[1].length-3):".html"==i.slice(-5).toLowerCase()&&(p.settings.autoMorph=!0)}else c=t.concatPath([n,c]);s.push(o._loadComponent(a,c,p,g,e.tagName))})),Promise.all(s)},o._loadComponent=function(n,r,s,i,a){var c=t.safeGet(s,"settings.autoMorph");if(c){var u=!0===c?BITSMIST.v1.Pad:e.getClass(c);customElements.get(a.toLowerCase())||e.newComponent(u,s,a,n)}else if(i.autoLoad)return o.__autoloadComponent(n,r,s,i)},o.__isLoadedClass=function(t){var n=!1;return("loaded"==o.__classes.get(t,{}).state||e.getClass(t))&&(n=!0),n},o.__autoloadComponent=function(e,n,r,s){var i,a=t.safeGet(r,"settings.tagName")||t.getTagNameFromClassName(e),c=t.safeGet(r,"settings.fileName",a);return o.__isLoadedClass(e)||customElements.get(a)?(o.__classes.set(e,{state:"loaded"}),i=Promise.resolve()):"loading"==o.__classes.get(e,{}).state?i=o.__classes.get(e).promise:(o.__classes.set(e,{state:"loading"}),i=o.__loadComponentScript(c,n,s).then((function(){o.__classes.set(e,{state:"loaded",promise:null})})),o.__classes.set(e,{promise:i})),i},o.__loadComponentScript=function(e,n,r){var o=t.concatPath([n,e+".js"]),s=t.concatPath([n,e+".settings.js"]);return Promise.resolve().then((function(){return a.loadScript(o)})).then((function(){if(r.splitComponent)return a.loadScript(s)})).then((function(){}))},o.__insertTag=function(e,n,r){var o,s=e._rootElement.querySelector(t.safeGet(r,"settings.rootNode"));t.assert(s,"Root node does not exist. name="+e.name+", tagName="+n+", rootNode="+t.safeGet(r,"settings.rootNode"),ReferenceError);var i=t.safeGet(r,"settings.tag")?t.safeGet(r,"settings.tag"):"<"+n+"></"+n+">";return t.safeGet(r,"settings.overwrite")?(s.outerHTML=i,o=s):(s.insertAdjacentHTML("afterbegin",i),o=s.children[0]),o._injectSettings=function(e){var n=Object.assign({},o._super.prototype._injectSettings.call(o,e));return t.deepMerge(n,r)},o},o}(n),m=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.globalInit=function(){var t=this;document.addEventListener("DOMContentLoaded",(function(){BITSMIST.v1.settings.get("organizers.AutoloadOrganizer.settings.autoLoadOnStartup",!0)&&t.load(document.body,BITSMIST.v1.settings)}))},n.organize=function(t,e,r){return n.load(e.rootElement,e.settings)},n.load=function(e,n){var r=t.concatPath([n.get("system.appBaseUrl",""),n.get("system.componentPath","")]),o=n.get("system.splitComponent",!1);return d.loadTags(e,r,{splitComponent:o})},n}(n),_=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),n.prototype=Object.create(e&&e.prototype),n.prototype.constructor=n,n.globalInit=function(){Object.defineProperty(p.prototype,"state",{get:function(){return this._state},set:function(t){this._state=t}}),p.prototype.changeState=function(t){return n._changeState(this,t)},p.prototype.isInitialized=function(){return n._isInitialized(this)},p.prototype.waitFor=function(t,e){return n._waitFor(this,t,e)},p.prototype.suspend=function(t){return n._suspend(this,t)},n.__components=new r,n.__waitingList=new r,n.__waitingListIndexName=new Map,n.__waitingListIndexId=new Map,n.__waitingListIndexNone=[],p.prototype.resume=function(t){return n._resume(this,t)},n.waitFor=function(t,e){return n._waitFor(null,t,e)}},n.init=function(t,e){t._state="",n.__loadAttrSettings(t)},n.organize=function(t,e,r){var o=Promise.resolve(),s=r.waitFor;return s&&s[t]&&(o=n._waitFor(e,s[t],e.settings.get("system.waitforTimeout"))),o},n.clear=function(){this.__waitingList.clear()},n._waitFor=function(t,e,r){var o;r=r||1e4;var s={waiter:t,waitlist:e.slice()};return n.__isAllReady(s)?o=Promise.resolve():(o=new Promise((function(n,o){s.resolve=n,s.reject=o,setTimeout((function(){o("StateOrganizer._waitFor(): Timed out after "+r+" milliseconds waiting for "+JSON.stringify(e)+", name="+(t&&t.name)+".")}),r)})),s.promise=o,n.__addToWaitingList(s,t)),o},n._waitForSingle=function(t,e,r){var o=n.__components.get(t.uniqueId),s={id:t.uniqueId,state:e};return n.__isReady(s,o)?Promise.resolve():n.waitFor(t,[s],r)},n._changeState=function(e,r){t.assert(n.__isTransitionable(e.state,r),"StateOrganizer._changeState(): Illegal transition. name="+e.name+", fromState="+e.state+", toState="+r+", id="+e.id,Error),e.state=r,n.__components.set(e.uniqueId,{object:e,state:r}),n.__processWaitingList(e,r)},n._suspend=function(t,e){var n={},r=new Promise((function(t,e){n.resolve=t,n.reject=e}));return n.promise=r,t._suspend[e]=n,r},n._resume=function(t,e){t._suspend[e].resolve()},n._isInitialized=function(t){var e=!1;return t.state&&"starting"!=t.state&&"stopping"!=t.state&&"stopped"!=t.state&&(e=!0),e},n.__isTransitionable=function(t,e){var n=!0;return t&&"ing"==t.slice(-3)&&("stopping"==t&&"stopped"!=e||"starting"==t&&"started"!=e||"opening"==t&&"opened"!=e&&"opening"!=e||"closing"==t&&"closed"!=e||"stopping"==t&&"stopped"!=e&&"closing"!=e)&&(n=!1),n},n.__processWaitingList=function(t,e){var r=n.__waitingListIndexName.get(t.name+"."+e);n.__processIndex(r);var o=n.__waitingListIndexId.get(t.uniqueId+"."+e);n.__processIndex(o),n.__processIndex(n.__waitingListIndexNone)},n.__processIndex=function(t){if(t)for(var e=0;e<t.length;e++){var r=t[e];r&&(n.__waitingList.get(r),n.__isAllReady(n.__waitingList.get(r))&&(n.__waitingList.get(r).resolve(),n.__waitingList.remove(r),t[e]=null))}},n.__addToWaitingList=function(t,e){var r=(new Date).getTime().toString(16)+Math.floor(100*Math.random()).toString(16);n.__waitingList.set(r,t);for(var o=t.waitlist,s=0;s<o.length;s++)o[s].state=o[s].state||"started",o[s].id?n.__addToIndex(n.__waitingListIndexId,o[s].id+"."+o[s].state,r):o[s].name?n.__addToIndex(n.__waitingListIndexName,o[s].name+"."+o[s].state,r):n.__waitingListIndexNone.push(r)},n.__addToIndex=function(t,e,n){t.get(e)||t.set(e,[]),t.get(e).push(n)},n.__getComponentInfo=function(t){var e;if(t.id)e=n.__components.get(t.id);else if(t.name)Object.keys(n.__components.items).forEach((function(r){t.name==n.__components.get(r).object.name&&(e=n.__components.get(r))}));else if(t.rootNode){var r=document.querySelector(t.rootNode);r&&r.uniqueId&&(e=n.__components.get(r.uniqueId))}return e},n.__isAllReady=function(t){for(var e=!0,r=t.waitlist,o=0;o<r.length;o++){var s=!1,i=this.__getComponentInfo(r[o]);if(i&&n.__isReady(r[o],i)&&(s=!0),!s){e=!1;break}}return e},n.__isReady=function(t,e){var r=n.__isComponentMatch(e,t);return r&&(r=n.__isStateMatch(e.state,t.state)),r},n.__isComponentMatch=function(t,e){var n=!0;return e.component&&t.object!==e.component&&(n=!1),e.name&&t.object.name!=e.name&&(n=!1),e.id&&t.object.uniqueId!=e.id&&(n=!1),e.rootNode&&!document.querySelector(e.rootNode)&&(n=!1),n},n.__isStateMatch=function(t,e){var n=!0;switch(e){case"started":"opening"!=t&&"opened"!=t&&"closing"!=t&&"closed"!=t&&"started"!=t&&(n=!1);break;default:t!=e&&(n=!1)}return n},n.__loadAttrSettings=function(t){if(t.hasAttribute("bm-waitfor")){var e={name:t.getAttribute("bm-waitfor"),state:"started"};t.settings.merge({waitFor:[e]})}if(t.hasAttribute("bm-waitfornode")){var n={rootNode:t.getAttribute("bm-waitfornode"),state:"started"};t.settings.merge({waitFor:[n]})}},n}(n);function h(){return Reflect.construct(HTMLElement,[],this.constructor)}function v(){return Reflect.construct(HTMLElement,[],this.constructor)}e.inherit(h,p),h.prototype._getSettings=function(){return{settings:{name:"SettingManager",autoSetup:!1}}},customElements.define("bm-setting",h),e.inherit(v,p),v.prototype.start=function(t){var e=this,n={settings:{name:"TagLoader"}};return t=t?BITSMIST.v1.Util.deepMerge(n,t):n,BITSMIST.v1.Component.prototype.start.call(this,t).then((function(){"loading"!==document.readyState?m.load(document.body,e.settings):document.addEventListener("DOMContentLoaded",(function(){m.load(document.body,e.settings)}))}))},customElements.define("bm-tagloader",v),window.BITSMIST=window.BITSMIST||{},window.BITSMIST.v1=window.BITSMIST.v1||{},window.BITSMIST.v1.Component=p,window.BITSMIST.v1.Organizer=n,window.BITSMIST.v1.OrganizerOrganizer=i,i.globalInit(p),window.BITSMIST.v1.SettingOrganizer=u,u.globalInit(p),window.BITSMIST.v1.settings=u.globalSettings,i.organizers.set("TemplateOrganizer",{object:l,targetWords:"templates",targetEvents:["beforeStart","afterAppend"],order:1e3}),window.BITSMIST.v1.TemplateOrganizer=l,i.organizers.set("EventOrganizer",{object:f,targetWords:"events",targetEvents:["beforeStart","afterAppend"],order:2e3}),window.BITSMIST.v1.EventOrganizer=f,i.organizers.set("AutoloadOrganizer",{object:m,targetEvents:["afterAppend"],order:3e3}),window.BITSMIST.v1.AutoloadOrganizer=m,i.organizers.set("ComponentOrganizer",{object:d,targetWords:"components",targetEvents:["afterAppend","afterSpecLoad"],order:4e3}),window.BITSMIST.v1.ComponentOrganizer=d,i.organizers.set("StateOrganizer",{object:_,targetWords:"waitFor",targetEvents:"*",order:5e3}),window.BITSMIST.v1.StateOrganizer=_,window.BITSMIST.v1.Pad=g,window.BITSMIST.v1.Store=r,window.BITSMIST.v1.OrganizerStore=s,window.BITSMIST.v1.ChainableStore=c,window.BITSMIST.v1.AjaxUtil=a,window.BITSMIST.v1.ClassUtil=e,window.BITSMIST.v1.Util=t}();
